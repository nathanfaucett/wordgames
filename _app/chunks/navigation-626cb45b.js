import{L as p,a1 as g,a2 as h,C as E,O as v,a3 as c}from"./vendor-10429b53.js";import{p as P,a as b}from"./p2p-3dfc5f61.js";import{_ as y,r as L}from"./singletons-e82519e2.js";const m=E(null);function S(){return{byId:{}}}function U(e){return{id:e,name:"Unknown",team:1}}const O=new p.EventEmitter,M=g(m,e=>e?e.get():S()),$=g(M,e=>e.byId[b()]);function I(){const e=v(m);return e?Promise.resolve(e):new Promise(t=>O.once("state",t))}P.on("room",e=>{const t=new h("users",e,S());t.on("update",()=>m.set(t)),O.emit("state",t),m.set(t);const n=e.getPeer().getId();t.change(r=>{r.byId[n]||(r.byId[n]=U(n))})});const j=y(()=>import("./easy-d1c5d374.js"),[]),x=y(()=>import("./medium-73eb433f.js"),[]),A=y(()=>import("./hard-ac810e77.js"),[]);async function R(e){switch(e){case i.Easy:return j.then(({default:t})=>t);case i.Medium:return x.then(({default:t})=>t);case i.Hard:return A.then(({default:t})=>t);default:return Promise.all([j,x,A]).then(([{default:t},{default:n},{default:r}])=>t.concat(n,r))}}async function l(e,t){return e.fromArray(await R(t)).unwrapOr("unknown")}const f=E(null),G=60;var i;(function(e){e.Easy="easy",e.Medium="medium",e.Hard="hard",e.All="all"})(i||(i={}));function T(){return{seed:Date.now(),started:!1,words:i.Medium,turn:"",word:"",timer:0,team1:0,team2:0}}const k=new p.EventEmitter,q=g(f,e=>(e==null?void 0:e.get())||T());function u(){const e=v(f);return e?Promise.resolve(e):new Promise(t=>k.once("state",t))}async function z(){const[e,t]=await Promise.all([u(),I()]),n=e.get(),r=t.get(),s=new c(n.seed),o=await l(s,n.words);e.change(a=>{a.started=!0,a.turn=s.fromArray(Object.keys(r.byId)).unwrapOr(b()),a.word=o,a.seed=s.nextInt()})}async function B(){const[e,t]=await Promise.all([u(),I()]),n=e.get(),r=t.get(),s=new c(n.seed),o=await l(s,n.words),a=Object.keys(r.byId).sort(),_=a.indexOf(n.turn),D=_===a.length-1?a[0]:a[_+1];e.change(w=>{w.word=o,w.seed=s.nextInt(),w.turn=D})}async function J(){const e=await u(),t=e.get(),n=new c(t.seed),r=await l(n,t.words);e.change(s=>{s.word=r,s.seed=n.nextInt()}),V()}async function K(){const e=await u(),t=e.get(),n=new c(t.seed),r=await l(n,t.words);e.change(s=>{s.word=r,s.seed=n.nextInt()})}let d;async function V(){if(d!=null)return;const e=await u();e.change(t=>{t.timer=G}),d=setInterval(()=>{e.change(t=>{t.timer>0?t.timer--:H()})},1e3)}async function H(){if(d==null)return;const[e,t]=await Promise.all([u(),I()]),n=e.get(),r=t.get(),s=r.byId[n.turn];e.change(o=>{s.team===1?o.team2++:o.team1++,o.timer=0}),clearInterval(d),d=null}P.on("room",e=>{const t=new h("game",e,T());t.on("update",()=>f.set(t)),k.emit("state",t),f.set(t)});const N=W;async function W(e,t){return L.goto(e,t,[])}export{i as W,q as a,$ as b,I as c,N as d,U as e,V as f,u as g,K as h,J as i,B as n,z as s,M as u};
