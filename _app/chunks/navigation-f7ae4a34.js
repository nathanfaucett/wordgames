import{L as e,a1 as t,a2 as n,C as a,O as s,a3 as r}from"./vendor-30d0dc21.js";import{p as o,a as c}from"./p2p-ac9564ed.js";import{_ as i,r as d}from"./singletons-e82519e2.js";const u=a(null);function m(e){return{id:e,name:"Unknown",team:1}}const l=new e.EventEmitter,w=t(u,(e=>e?e.get():{byId:{}})),f=t(w,(e=>e.byId[c()]));function y(){const e=s(u);return e?Promise.resolve(e):new Promise((e=>l.once("state",e)))}o.on("room",(e=>{const t=new n("users",e,{byId:{}});t.on("update",(()=>u.set(t))),l.emit("state",t),u.set(t);const a=e.getPeer().getId();t.change((e=>{e.byId[a]||(e.byId[a]=m(a))}))}));const g=i((()=>import("./easy-d1c5d374.js")),[]),h=i((()=>import("./medium-73eb433f.js")),[]),I=i((()=>import("./hard-ac810e77.js")),[]);async function _(e,t){return e.fromArray(await async function(e){switch(e){case E.Easy:return g.then((({default:e})=>e));case E.Medium:return h.then((({default:e})=>e));case E.Hard:return I.then((({default:e})=>e));default:return Promise.all([g,h,I]).then((([{default:e},{default:t},{default:n}])=>e.concat(t,n)))}}(t)).unwrapOr("unknown")}const p=a(null);var E,b;function P(){return{seed:Date.now(),started:!1,words:E.Medium,turn:"",word:"",timer:60,team1:0,team2:0}}(b=E||(E={})).Easy="easy",b.Medium="medium",b.Hard="hard",b.All="all";const v=new e.EventEmitter,O=t(p,(e=>(null==e?void 0:e.get())||P()));function j(){const e=s(p);return e?Promise.resolve(e):new Promise((e=>v.once("state",e)))}async function A(){const[e,t]=await Promise.all([j(),y()]),n=e.get(),a=t.get(),s=new r(n.seed),o=await _(s,n.words);e.change((e=>{e.started=!0,e.turn=s.fromArray(Object.keys(a.byId)).unwrapOr(c()),e.word=o,e.seed=s.nextInt()}))}async function x(){const[e,t]=await Promise.all([j(),y()]),n=e.get(),a=t.get(),s=new r(n.seed),o=await _(s,n.words),c=Object.keys(a.byId).sort(),i=c.indexOf(n.turn),d=i===c.length-1?c[0]:c[i+1];e.change((e=>{e.word=o,e.seed=s.nextInt(),e.turn=d}))}async function k(){const e=await j(),t=e.get(),n=new r(t.seed),a=await _(n,t.words);e.change((e=>{e.word=a,e.seed=n.nextInt()}))}let D;async function L(){if(null!=D)return;const e=await j();e.change((e=>{e.timer=60})),D=setInterval((()=>{e.change((e=>{e.timer>0?e.timer--:async function(){if(null==D)return;const e=await j(),t=s(f);e.change((e=>{t.id===e.turn&&(1===t.team?e.team2++:e.team1++),e.timer=0})),clearInterval(D),D=null}()}))}),1e3)}o.on("room",(e=>{const t=new n("game",e,P());t.on("update",(()=>p.set(t))),v.emit("state",t),p.set(t)}));const M=async function(e,t){return d.goto(e,t,[])};export{E as W,O as a,f as b,y as c,M as d,m as e,L as f,j as g,k as h,x as n,A as s,w as u};
