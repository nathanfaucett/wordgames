var df=Object.defineProperty;var pf=(t,e,n)=>e in t?df(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Y=(t,e,n)=>(pf(t,typeof e!="symbol"?e+"":e,n),n);function it(){}function gf(t,e){for(const n in e)t[n]=e[n];return t}function Ws(t){return t()}function Js(){return Object.create(null)}function Dt(t){t.forEach(Ws)}function Xs(t){return typeof t=="function"}function mf(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function bf(t){return Object.keys(t).length===0}function Wr(t,...e){if(t==null)return it;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function Xg(t){let e;return Wr(t,n=>e=n)(),e}function Qg(t,e,n){t.$$.on_destroy.push(Wr(e,n))}function em(t,e,n,r){if(t){const i=Qs(t,e,n,r);return t[0](i)}}function Qs(t,e,n,r){return t[1]&&r?gf(n.ctx.slice(),t[1](r(e))):n.ctx}function tm(t,e,n,r){if(t[2]&&r){const i=t[2](r(n));if(e.dirty===void 0)return i;if(typeof i=="object"){const s=[],a=Math.max(e.dirty.length,i.length);for(let o=0;o<a;o+=1)s[o]=e.dirty[o]|i[o];return s}return e.dirty|i}return e.dirty}function nm(t,e,n,r,i,s){if(i){const a=Qs(e,n,r,s);t.p(a,i)}}function rm(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let r=0;r<n;r++)e[r]=-1;return e}return-1}let qn=!1;function _f(){qn=!0}function yf(){qn=!1}function wf(t,e,n,r){for(;t<e;){const i=t+(e-t>>1);n(i)<=r?t=i+1:e=i}return t}function vf(t){if(t.hydrate_init)return;t.hydrate_init=!0;let e=t.childNodes;if(t.nodeName==="HEAD"){const c=[];for(let l=0;l<e.length;l++){const f=e[l];f.claim_order!==void 0&&c.push(f)}e=c}const n=new Int32Array(e.length+1),r=new Int32Array(e.length);n[0]=-1;let i=0;for(let c=0;c<e.length;c++){const l=e[c].claim_order,f=(i>0&&e[n[i]].claim_order<=l?i+1:wf(1,i,p=>e[n[p]].claim_order,l))-1;r[c]=n[f]+1;const d=f+1;n[d]=c,i=Math.max(d,i)}const s=[],a=[];let o=e.length-1;for(let c=n[i]+1;c!=0;c=r[c-1]){for(s.push(e[c-1]);o>=c;o--)a.push(e[o]);o--}for(;o>=0;o--)a.push(e[o]);s.reverse(),a.sort((c,l)=>c.claim_order-l.claim_order);for(let c=0,l=0;c<a.length;c++){for(;l<s.length&&a[c].claim_order>=s[l].claim_order;)l++;const f=l<s.length?s[l]:null;t.insertBefore(a[c],f)}}function xf(t,e){if(qn){for(vf(t),(t.actual_end_child===void 0||t.actual_end_child!==null&&t.actual_end_child.parentElement!==t)&&(t.actual_end_child=t.firstChild);t.actual_end_child!==null&&t.actual_end_child.claim_order===void 0;)t.actual_end_child=t.actual_end_child.nextSibling;e!==t.actual_end_child?(e.claim_order!==void 0||e.parentNode!==t)&&t.insertBefore(e,t.actual_end_child):t.actual_end_child=e.nextSibling}else(e.parentNode!==t||e.nextSibling!==null)&&t.appendChild(e)}function im(t,e,n){qn&&!n?xf(t,e):(e.parentNode!==t||e.nextSibling!=n)&&t.insertBefore(e,n||null)}function If(t){t.parentNode.removeChild(t)}function sm(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function Ef(t){return document.createElement(t)}function Jr(t){return document.createTextNode(t)}function om(){return Jr(" ")}function am(){return Jr("")}function lm(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function cm(t){return function(e){return e.preventDefault(),t.call(this,e)}}function fm(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Of(t){return Array.from(t.childNodes)}function Af(t){t.claim_info===void 0&&(t.claim_info={last_index:0,total_claimed:0})}function eo(t,e,n,r,i=!1){Af(t);const s=(()=>{for(let a=t.claim_info.last_index;a<t.length;a++){const o=t[a];if(e(o)){const c=n(o);return c===void 0?t.splice(a,1):t[a]=c,i||(t.claim_info.last_index=a),o}}for(let a=t.claim_info.last_index-1;a>=0;a--){const o=t[a];if(e(o)){const c=n(o);return c===void 0?t.splice(a,1):t[a]=c,i?c===void 0&&t.claim_info.last_index--:t.claim_info.last_index=a,o}}return r()})();return s.claim_order=t.claim_info.total_claimed,t.claim_info.total_claimed+=1,s}function Cf(t,e,n,r){return eo(t,i=>i.nodeName===e,i=>{const s=[];for(let a=0;a<i.attributes.length;a++){const o=i.attributes[a];n[o.name]||s.push(o.name)}s.forEach(a=>i.removeAttribute(a))},()=>r(e))}function um(t,e,n){return Cf(t,e,n,Ef)}function Rf(t,e){return eo(t,n=>n.nodeType===3,n=>{const r=""+e;if(n.data.startsWith(r)){if(n.data.length!==r.length)return n.splitText(r.length)}else n.data=r},()=>Jr(e),!0)}function hm(t){return Rf(t," ")}function dm(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function pm(t,e){t.value=e==null?"":e}function gm(t,e){for(let n=0;n<t.options.length;n+=1){const r=t.options[n];if(r.__value===e){r.selected=!0;return}}t.selectedIndex=-1}function mm(t,e,n){t.classList[n?"add":"remove"](e)}let Gn;function Kn(t){Gn=t}function Xr(){if(!Gn)throw new Error("Function called outside component initialization");return Gn}function bm(t){Xr().$$.on_mount.push(t)}function _m(t){Xr().$$.after_update.push(t)}function ym(t,e){Xr().$$.context.set(t,e)}function wm(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(r=>r.call(this,e))}const hn=[],to=[],Yn=[],no=[],Tf=Promise.resolve();let Qr=!1;function kf(){Qr||(Qr=!0,Tf.then(ro))}function ei(t){Yn.push(t)}let ti=!1;const ni=new Set;function ro(){if(!ti){ti=!0;do{for(let t=0;t<hn.length;t+=1){const e=hn[t];Kn(e),Sf(e.$$)}for(Kn(null),hn.length=0;to.length;)to.pop()();for(let t=0;t<Yn.length;t+=1){const e=Yn[t];ni.has(e)||(ni.add(e),e())}Yn.length=0}while(hn.length);for(;no.length;)no.pop()();Qr=!1,ti=!1,ni.clear()}}function Sf(t){if(t.fragment!==null){t.update(),Dt(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ei)}}const Wn=new Set;let _t;function vm(){_t={r:0,c:[],p:_t}}function xm(){_t.r||Dt(_t.c),_t=_t.p}function Nf(t,e){t&&t.i&&(Wn.delete(t),t.i(e))}function Im(t,e,n,r){if(t&&t.o){if(Wn.has(t))return;Wn.add(t),_t.c.push(()=>{Wn.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}function Em(t,e){const n={},r={},i={$$scope:1};let s=t.length;for(;s--;){const a=t[s],o=e[s];if(o){for(const c in a)c in o||(r[c]=1);for(const c in o)i[c]||(n[c]=o[c],i[c]=1);t[s]=o}else for(const c in a)i[c]=1}for(const a in r)a in n||(n[a]=void 0);return n}function Om(t){return typeof t=="object"&&t!==null?t:{}}function Am(t){t&&t.c()}function Cm(t,e){t&&t.l(e)}function $f(t,e,n,r){const{fragment:i,on_mount:s,on_destroy:a,after_update:o}=t.$$;i&&i.m(e,n),r||ei(()=>{const c=s.map(Ws).filter(Xs);a?a.push(...c):Dt(c),t.$$.on_mount=[]}),o.forEach(ei)}function Df(t,e){const n=t.$$;n.fragment!==null&&(Dt(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function jf(t,e){t.$$.dirty[0]===-1&&(hn.push(t),kf(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Rm(t,e,n,r,i,s,a,o=[-1]){const c=Gn;Kn(t);const l=t.$$={fragment:null,ctx:null,props:s,update:it,not_equal:i,bound:Js(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Js(),dirty:o,skip_bound:!1,root:e.target||c.$$.root};a&&a(l.root);let f=!1;if(l.ctx=n?n(t,e.props||{},(d,p,...u)=>{const b=u.length?u[0]:p;return l.ctx&&i(l.ctx[d],l.ctx[d]=b)&&(!l.skip_bound&&l.bound[d]&&l.bound[d](b),f&&jf(t,d)),p}):[],l.update(),f=!0,Dt(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){_f();const d=Of(e.target);l.fragment&&l.fragment.l(d),d.forEach(If)}else l.fragment&&l.fragment.c();e.intro&&Nf(t.$$.fragment),$f(t,e.target,e.anchor,e.customElement),yf(),ro()}Kn(c)}class Tm{$destroy(){Df(this,1),this.$destroy=it}$on(e,n){const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(n),()=>{const i=r.indexOf(n);i!==-1&&r.splice(i,1)}}$set(e){this.$$set&&!bf(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const jt=[];function Bf(t,e){return{subscribe:Lf(t,e).subscribe}}function Lf(t,e=it){let n;const r=new Set;function i(o){if(mf(t,o)&&(t=o,n)){const c=!jt.length;for(const l of r)l[1](),jt.push(l,t);if(c){for(let l=0;l<jt.length;l+=2)jt[l][0](jt[l+1]);jt.length=0}}}function s(o){i(o(t))}function a(o,c=it){const l=[o,c];return r.add(l),r.size===1&&(n=e(i)||it),o(t),()=>{r.delete(l),r.size===0&&(n(),n=null)}}return{set:i,update:s,subscribe:a}}function km(t,e,n){const r=!Array.isArray(t),i=r?[t]:t,s=e.length<2;return Bf(n,a=>{let o=!1;const c=[];let l=0,f=it;const d=()=>{if(l)return;f();const u=e(r?c[0]:c,a);s?a(u):f=Xs(u)?u:it},p=i.map((u,b)=>Wr(u,O=>{c[b]=O,l&=~(1<<b),o&&d()},()=>{l|=1<<b}));return o=!0,d(),function(){Dt(p),f()}})}var dn=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Jn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bt={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(c,l,f){this.fn=c,this.context=l,this.once=f||!1}function s(c,l,f,d,p){if(typeof f!="function")throw new TypeError("The listener must be a function");var u=new i(f,d||c,p),b=n?n+l:l;return c._events[b]?c._events[b].fn?c._events[b]=[c._events[b],u]:c._events[b].push(u):(c._events[b]=u,c._eventsCount++),c}function a(c,l){--c._eventsCount==0?c._events=new r:delete c._events[l]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],f,d;if(this._eventsCount===0)return l;for(d in f=this._events)e.call(f,d)&&l.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(f)):l},o.prototype.listeners=function(l){var f=n?n+l:l,d=this._events[f];if(!d)return[];if(d.fn)return[d.fn];for(var p=0,u=d.length,b=new Array(u);p<u;p++)b[p]=d[p].fn;return b},o.prototype.listenerCount=function(l){var f=n?n+l:l,d=this._events[f];return d?d.fn?1:d.length:0},o.prototype.emit=function(l,f,d,p,u,b){var O=n?n+l:l;if(!this._events[O])return!1;var E=this._events[O],v=arguments.length,k,A;if(E.fn){switch(E.once&&this.removeListener(l,E.fn,void 0,!0),v){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,f),!0;case 3:return E.fn.call(E.context,f,d),!0;case 4:return E.fn.call(E.context,f,d,p),!0;case 5:return E.fn.call(E.context,f,d,p,u),!0;case 6:return E.fn.call(E.context,f,d,p,u,b),!0}for(A=1,k=new Array(v-1);A<v;A++)k[A-1]=arguments[A];E.fn.apply(E.context,k)}else{var I=E.length,y;for(A=0;A<I;A++)switch(E[A].once&&this.removeListener(l,E[A].fn,void 0,!0),v){case 1:E[A].fn.call(E[A].context);break;case 2:E[A].fn.call(E[A].context,f);break;case 3:E[A].fn.call(E[A].context,f,d);break;case 4:E[A].fn.call(E[A].context,f,d,p);break;default:if(!k)for(y=1,k=new Array(v-1);y<v;y++)k[y-1]=arguments[y];E[A].fn.apply(E[A].context,k)}}return!0},o.prototype.on=function(l,f,d){return s(this,l,f,d,!1)},o.prototype.once=function(l,f,d){return s(this,l,f,d,!0)},o.prototype.removeListener=function(l,f,d,p){var u=n?n+l:l;if(!this._events[u])return this;if(!f)return a(this,u),this;var b=this._events[u];if(b.fn)b.fn===f&&(!p||b.once)&&(!d||b.context===d)&&a(this,u);else{for(var O=0,E=[],v=b.length;O<v;O++)(b[O].fn!==f||p&&!b[O].once||d&&b[O].context!==d)&&E.push(b[O]);E.length?this._events[u]=E.length===1?E[0]:E:a(this,u)}return this},o.prototype.removeAllListeners=function(l){var f;return l?(f=n?n+l:l,this._events[f]&&a(this,f)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=n,o.EventEmitter=o,t.exports=o})(Bt);var Sm=Bt.exports;class Vf extends Bt.exports.EventEmitter{}const Lt=new Vf;typeof window=="object"?window.addEventListener("beforeunload",()=>Lt.emit("close")):typeof process=="object"&&(process.once("SIGINT",()=>{process.exit(130)}),process.once("SIGTERM",()=>{process.exit(143)}),process.on("exit",()=>{Lt.emit("close")}));var Q;(function(t){t.Open="open",t.Close="close",t.Error="error",t.ConnectionError="connection-error",t.Connection="connection",t.Disconnection="disconnection",t.Message="data"})(Q||(Q={}));class st extends Bt.exports.EventEmitter{constructor(e,n={}){super();Y(this,"peer");Y(this,"peers",{});Y(this,"reconnectTimeoutMS",6e4);Y(this,"onError",e=>{this.emit(Q.Error,e)});Y(this,"onDataConnection",async e=>{const n=e.peer;e.on("data",i=>this.emit(Q.Message,n,i));const r=()=>{delete this.peers[n],this.emit(Q.Disconnection,n)};e.on("close",r),e.on("error",i=>{switch(r(),this.emit(Q.ConnectionError,i,n),i.type){case"network":case"peer-unvailable":case"server-error":case"socket-closed":case"socket-error":let s=1e3;const a=()=>{this.connect(n).catch(()=>{s<this.reconnectTimeoutMS&&(s*=2,setTimeout(a,s))})};setTimeout(a,s)}}),this.peers[n]=e,this.emit(Q.Connection,n)});Y(this,"waitForDataConnection",async e=>new Promise((n,r)=>{if(e.open)this.onDataConnection(e),n(e);else{const i=()=>{e.off("open",i),e.off("error",s),this.onDataConnection(e),n(e)},s=a=>{e.off("open",i),e.off("error",s),r(a)};e.on("open",i),e.on("error",s)}}));Y(this,"close",()=>(Lt.off("close",this.close),this.peers={},this.peer.destroy(),this.emit(Q.Close),this));this.peer=e,n&&typeof n.reconnectTimeoutMS=="number"&&n.reconnectTimeoutMS>=0&&(this.reconnectTimeoutMS=n.reconnectTimeoutMS),this.peer.on("error",this.onError),this.peer.on("connection",this.waitForDataConnection),this.emit(Q.Open),Lt.once("close",this.close)}static waitForPeer(e){return new Promise((n,r)=>{if(e.open)n(e);else{const i=()=>{e.off("open",i),e.off("error",s),n(e)},s=a=>{e.off("open",i),e.off("error",s),r(a)};e.on("open",i),e.on("error",s),(e.destroyed||e.disconnected)&&e.reconnect()}})}static async create(e,n={}){return new st(await st.waitForPeer(e),n)}async open(){return await st.waitForPeer(this.peer),this}getId(){return this.peer.id}isOpen(){return!!this.peer.open}getInternal(){return this.peer}getReconnectTimeoutMS(){return this.reconnectTimeoutMS}connect(e){const n=this.getPeer(e);return n?Promise.resolve(n):this.waitForDataConnection(this.peer.connect(e))}disconnect(e){var n;return(n=this.getPeer(e))==null||n.close(),delete this.peers[e],this}isConnected(e){const n=this.peer.connections[e];return n&&n.length>0}getPeer(e){return this.peers[e]}getPeerIds(){return Object.keys(this.peers)}getPeers(){return Object.values(this.peers)}send(e,n){var r;return(r=this.getPeer(e))==null||r.send(n),this}broadcast(e,n=[]){for(const r of this.getPeers().filter(i=>!n.includes(i.peer)))r.send(e);return this}}function io(t,e,n){return{from:t,type:e,payload:n}}function Uf(t){return t!==null&&typeof t=="object"&&"type"in t}function Ce(t,e){return Uf(t)&&t.type===e}var xe;(function(t){t.Message="message",t.Boardcast="boardcast",t.Peers="peers",t.PeerConnect="peer-connect",t.PeerDisconnect="peer-disconnect"})(xe||(xe={}));const ri="internal-room-message";function pn(t,e,n,r){return io(e,ri,io(t,n,r))}var Xn;(function(t){t.StatusChange="status-change"})(Xn||(Xn={}));class Mf extends Bt.exports.EventEmitter{constructor(e,n,r={}){super();Y(this,"roomId");Y(this,"peer");Y(this,"server");Y(this,"client");Y(this,"peers",{});Y(this,"reconnectTimeoutMS",100);Y(this,"syncMS",1e3);Y(this,"closed",!1);Y(this,"close",()=>(this.closed=!0,Lt.off("close",this.close),this.onServeClose(),this.onJoinClose(),this.peer.off(Q.Message,this.onPeerData),this.emit(Q.Close),this));Y(this,"onPeerData",(e,n)=>{if(Ce(n,ri)){const r=n.payload;if(Ce(r,xe.Message)&&r.payload.to===this.peer.getId())this.peer.emit(Q.Message,r.from,r.payload.message),this.emit(Q.Message,r.from,r.payload.message);else if(Ce(r,xe.Boardcast))this.peer.emit(Q.Message,r.from,r.payload),this.emit(Q.Message,r.from,r.payload);else if(Ce(r,xe.Peers))for(const i of r.payload)this.internalConnect(i);else Ce(r,xe.PeerConnect)?this.internalConnect(r.payload):Ce(r,xe.PeerDisconnect)&&this.internalDisconnect(r.payload)}});Y(this,"onJoinError",e=>{switch(this.onJoinClose(),e.type){case"network":case"server-error":case"socket-closed":case"socket-error":setTimeout(this.join,this.reconnectTimeoutMS);break;case"peer-unvailable":this.serve();break}this.emit(Q.Error,e)});Y(this,"onJoinClose",()=>{this.peer.disconnect(this.roomId),this.client=void 0;for(const e of this.getPeers())this.internalDisconnect(e);return this.peers={},this.closed||this.serve(),this});Y(this,"onServeError",e=>{switch(this.onServeClose(),e.type){case"network":case"server-error":case"socket-closed":case"socket-error":setTimeout(this.serve,this.reconnectTimeoutMS);break;case"unavailable-id":this.join();break}this.emit(Q.Error,e)});Y(this,"onServeClose",()=>{var e;(e=this.server)==null||e.close(),this.server=void 0;for(const n of this.getPeers())this.internalDisconnect(n);return this.peers={},this});Y(this,"serve",async()=>{if(!this.server)try{const e=Object.getPrototypeOf(this.peer.getInternal()).constructor,n=new e(this.roomId,this.peer.getInternal().options),r=new st(n,{reconnectTimeoutMS:this.peer.getReconnectTimeoutMS()});r.on(Q.Connection,async i=>{this.internalConnect(i),r.send(i,pn(this.peer.getId(),this.roomId,xe.Peers,r.getPeerIds())),r.broadcast(pn(this.peer.getId(),this.roomId,xe.PeerConnect,i),[i])}),r.on(Q.Disconnection,i=>{r.broadcast(pn(this.peer.getId(),this.roomId,xe.PeerDisconnect,i)),this.internalDisconnect(i)}),r.on(Q.Message,(i,s)=>{if(Ce(s,ri)){const a=s.payload;Ce(a,xe.Message)?r.send(a.payload.to,s):Ce(a,xe.Boardcast)&&r.broadcast(s)}}),r.on(Q.Error,this.onServeError),await st.waitForPeer(n),this.server=r,await this.join(!1),this.emit(Xn.StatusChange,"server"),this.emit(Q.Open)}catch(e){this.onServeError(e)}return this});this.roomId=n,this.peer=e,this.peer.on(Q.Message,this.onPeerData),r&&(typeof r.reconnectTimeoutMS=="number"&&r.reconnectTimeoutMS>=0&&(this.reconnectTimeoutMS=r.reconnectTimeoutMS),typeof r.syncMS=="number"&&r.syncMS>=0&&(this.syncMS=r.syncMS)),Lt.once("close",this.close)}isOpen(){var e;return(e=this.peer.getPeer(this.roomId))==null?void 0:e.open}isServer(){return!!this.server}isClient(){return!this.isServer()}async connect(){return this.closed&&(this.closed=!1),this.serve()}getRoomId(){return this.roomId}getPeer(){return this.peer}getPeers(){return Object.keys(this.peers)}send(e,n,r){var i;return(i=this.client)==null||i.send(pn(this.peer.getId(),this.roomId,xe.Message,{to:e,message:{from:this.peer.getId(),type:n,payload:r}})),this}broadcast(e,n){var r;return(r=this.client)==null||r.send(pn(this.peer.getId(),this.roomId,xe.Boardcast,{from:this.peer.getId(),type:e,payload:n})),this}internalConnect(e){this.peers[e]=Date.now(),this.emit(Q.Connection,e)}internalDisconnect(e){this.emit(Q.Disconnection,e),delete this.peers[e]}async join(e=!0){if(!this.client)try{const n=this.peer.getInternal().connect(this.roomId);n.on("error",this.onJoinError),n.on("close",this.onJoinClose),await this.peer.waitForDataConnection(n),this.client=n,e&&(this.emit(Xn.StatusChange,"client"),this.emit(Q.Open))}catch(n){this.onJoinError(n)}return this}}class so extends st{constructor(){super(...arguments);Y(this,"rooms",{})}static async create(e,n={}){return new so(await st.waitForPeer(e),n)}getRoom(e){const n=this.rooms[e];if(n)return n;{const r=new Mf(this,e);return this.rooms[e]=r,r}}async connectToRoom(e){const n=this.getRoom(e);return n.isOpen()?n:n.connect()}disconnectFromRoom(e){const n=this.getRoom(e);return n&&(n.close(),delete this.rooms[e]),this}}var oo={exports:{}},Qn={exports:{}},ao=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(ao){var lo=new Uint8Array(16);Qn.exports=function(){return ao(lo),lo}}else{var co=new Array(16);Qn.exports=function(){for(var e=0,n;e<16;e++)(e&3)==0&&(n=Math.random()*4294967296),co[e]=n>>>((e&3)<<3)&255;return co}}var fo=[];for(var er=0;er<256;++er)fo[er]=(er+256).toString(16).substr(1);function Pf(t,e){var n=e||0,r=fo;return[r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],"-",r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]],r[t[n++]]].join("")}var uo=Pf,Hf=Qn.exports,Ff=uo,ho,ii,si=0,oi=0;function zf(t,e,n){var r=e&&n||0,i=e||[];t=t||{};var s=t.node||ho,a=t.clockseq!==void 0?t.clockseq:ii;if(s==null||a==null){var o=Hf();s==null&&(s=ho=[o[0]|1,o[1],o[2],o[3],o[4],o[5]]),a==null&&(a=ii=(o[6]<<8|o[7])&16383)}var c=t.msecs!==void 0?t.msecs:new Date().getTime(),l=t.nsecs!==void 0?t.nsecs:oi+1,f=c-si+(l-oi)/1e4;if(f<0&&t.clockseq===void 0&&(a=a+1&16383),(f<0||c>si)&&t.nsecs===void 0&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");si=c,oi=l,ii=a,c+=122192928e5;var d=((c&268435455)*1e4+l)%4294967296;i[r++]=d>>>24&255,i[r++]=d>>>16&255,i[r++]=d>>>8&255,i[r++]=d&255;var p=c/4294967296*1e4&268435455;i[r++]=p>>>8&255,i[r++]=p&255,i[r++]=p>>>24&15|16,i[r++]=p>>>16&255,i[r++]=a>>>8|128,i[r++]=a&255;for(var u=0;u<6;++u)i[r+u]=s[u];return e||Ff(i)}var Zf=zf,qf=Qn.exports,Gf=uo;function Kf(t,e,n){var r=e&&n||0;typeof t=="string"&&(e=t==="binary"?new Array(16):null,t=null),t=t||{};var i=t.random||(t.rng||qf)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e)for(var s=0;s<16;++s)e[r+s]=i[s];return e||Gf(i)}var Yf=Kf,Wf=Zf,po=Yf,ai=po;ai.v1=Wf;ai.v4=po;var Jf=ai;const{v4:Xf}=Jf;function go(){return Xf().replace(/-/g,"")}let li=go;function ci(){return li()}ci.setFactory=t=>{li=t};ci.reset=()=>{li=go};var fi=ci;const Qf=Symbol("_options"),eu=Symbol("_cache"),tu=Symbol("_state"),nu=Symbol("_objectId"),ru=Symbol("_conflicts"),iu=Symbol("_change"),su=Symbol("_elemIds");var ot={OPTIONS:Qf,CACHE:eu,STATE:tu,OBJECT_ID:nu,CONFLICTS:ru,CHANGE:iu,ELEM_IDS:su};function mo(t){return typeof t=="object"&&t!==null}function ou(t){if(!mo(t))return{};let e={};for(let n of Object.keys(t))e[n]=t[n];return e}function au(t){const e=/^(\d+)@(.*)$/.exec(t||"");if(!e)throw new RangeError(`Not a valid opId: ${t}`);return{counter:parseInt(e[1],10),actorId:e[2]}}function lu(t,e){if(!(t instanceof Uint8Array)||!(e instanceof Uint8Array))throw new TypeError("equalBytes can only compare Uint8Arrays");if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}function cu(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=null;return e}var Be={isObject:mo,copyObject:ou,parseOpId:au,equalBytes:lu,createArrayOfNulls:cu};const{OBJECT_ID:yt}=ot,{isObject:fu}=Be;class ui{constructor(e){if(typeof e=="string"){const n=[...e].map(r=>({value:r}));return gn(void 0,n)}else if(Array.isArray(e)){const n=e.map(r=>({value:r}));return gn(void 0,n)}else{if(e===void 0)return gn(void 0,[]);throw new TypeError(`Unsupported initial value for Text: ${e}`)}}get length(){return this.elems.length}get(e){const n=this.elems[e].value;if(this.context&&fu(n)){const r=n[yt],i=this.path.concat([{key:e,objectId:r}]);return this.context.instantiateObject(i,r)}else return n}getElemId(e){return this.elems[e].elemId}[Symbol.iterator](){let e=this.elems,n=-1;return{next(){return n+=1,n<e.length?{done:!1,value:e[n].value}:{done:!0}}}}toString(){let e="";for(const n of this.elems)typeof n.value=="string"&&(e+=n.value);return e}toSpans(){let e=[],n="";for(const r of this.elems)typeof r.value=="string"?n+=r.value:(n.length>0&&(e.push(n),n=""),e.push(r.value));return n.length>0&&e.push(n),e}toJSON(){return this.toString()}getWriteable(e,n){if(!this[yt])throw new RangeError("getWriteable() requires the objectId to be set");const r=gn(this[yt],this.elems);return r.context=e,r.path=n,r}set(e,n){if(this.context)this.context.setListIndex(this.path,e,n);else if(!this[yt])this.elems[e].value=n;else throw new TypeError("Automerge.Text object cannot be modified outside of a change block");return this}insertAt(e,...n){if(this.context)this.context.splice(this.path,e,0,n);else if(!this[yt])this.elems.splice(e,0,...n.map(r=>({value:r})));else throw new TypeError("Automerge.Text object cannot be modified outside of a change block");return this}deleteAt(e,n=1){if(this.context)this.context.splice(this.path,e,n,[]);else if(!this[yt])this.elems.splice(e,n);else throw new TypeError("Automerge.Text object cannot be modified outside of a change block");return this}}for(let t of["concat","every","filter","find","findIndex","forEach","includes","indexOf","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString"])ui.prototype[t]=function(...e){return[...this][t](...e)};function gn(t,e){const n=Object.create(ui.prototype);return n[yt]=t,n.elems=e,n}var tr={Text:ui,instantiateText:gn};const{OBJECT_ID:wt,CONFLICTS:uu}=ot,{isObject:nr,copyObject:bo}=Be;function hi(t,e,n){for(let r of t)if(e[r]!==n[r]){if(typeof e[r]=="number"&&typeof n[r]=="number")return e[r]-n[r];{const i=""+e[r],s=""+n[r];if(i===s)continue;return i<s?-1:1}}return 0}class di{constructor(){this.entries=Object.freeze({}),this.opIds=Object.freeze({}),Object.freeze(this)}byId(e){return this.entries[e]}get ids(){return Object.keys(this.entries).filter(e=>{const n=this.entries[e];return nr(n)&&n.id===e})}get count(){return this.ids.length}get rows(){return this.ids.map(e=>this.byId(e))}filter(e,n){return this.rows.filter(e,n)}find(e,n){return this.rows.find(e,n)}map(e,n){return this.rows.map(e,n)}sort(e){if(typeof e=="function")return this.rows.sort(e);if(typeof e=="string")return this.rows.sort((n,r)=>hi([e],n,r));if(Array.isArray(e))return this.rows.sort((n,r)=>hi(e,n,r));if(e===void 0)return this.rows.sort((n,r)=>hi(["id"],n,r));throw new TypeError(`Unsupported sorting argument: ${e}`)}[Symbol.iterator](){let e=this.rows,n=-1;return{next(){return n+=1,n<e.length?{done:!1,value:e[n]}:{done:!0}}}}_clone(){if(!this[wt])throw new RangeError("clone() requires the objectId to be set");return _o(this[wt],bo(this.entries),bo(this.opIds))}_set(e,n,r){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");nr(n)&&!Array.isArray(n)&&Object.defineProperty(n,"id",{value:e,enumerable:!0}),this.entries[e]=n,this.opIds[e]=r}remove(e){if(Object.isFrozen(this.entries))throw new Error("A table can only be modified in a change function");delete this.entries[e],delete this.opIds[e]}_freeze(){Object.freeze(this.entries),Object.freeze(this.opIds),Object.freeze(this)}getWriteable(e,n){if(!this[wt])throw new RangeError("getWriteable() requires the objectId to be set");const r=Object.create(hu.prototype);return r[wt]=this[wt],r.context=e,r.entries=this.entries,r.opIds=this.opIds,r.path=n,r}toJSON(){const e={};for(let n of this.ids)e[n]=this.byId(n);return e}}class hu extends di{byId(e){if(nr(this.entries[e])&&this.entries[e].id===e){const n=this.entries[e][wt],r=this.path.concat([{key:e,objectId:n}]);return this.context.instantiateObject(r,n,["id"])}}add(e){return this.context.addTableRow(this.path,e)}remove(e){if(nr(this.entries[e])&&this.entries[e].id===e)this.context.deleteTableRow(this.path,e,this.opIds[e]);else throw new RangeError(`There is no row with ID ${e} in this table`)}}function _o(t,e,n){const r=Object.create(di.prototype);if(!t)throw new RangeError("instantiateTable requires an objectId to be given");return r[wt]=t,r[uu]=Object.freeze({}),r.entries=e||{},r.opIds=n||{},r}var rr={Table:di,instantiateTable:_o};class yo{constructor(e){this.value=e||0,Object.freeze(this)}valueOf(){return this.value}toString(){return this.valueOf().toString()}toJSON(){return this.value}}class du extends yo{increment(e){return e=typeof e=="number"?e:1,this.context.increment(this.path,this.key,e),this.value+=e,this.value}decrement(e){return this.increment(typeof e=="number"?-e:-1)}}function pu(t,e,n,r,i){const s=Object.create(du.prototype);return s.value=t,s.context=e,s.path=n,s.objectId=r,s.key=i,s}var pi={Counter:yo,getWriteableCounter:pu};const{isObject:gu,copyObject:wo,parseOpId:ir}=Be,{OBJECT_ID:mn,CONFLICTS:vt,ELEM_IDS:sr}=ot,{instantiateText:mu}=tr,{instantiateTable:bu}=rr,{Counter:_u}=pi;function Ke(t,e,n){return t.objectId?(e&&e[mn]!==t.objectId&&(e=void 0),xo(t,e,n)):t.datatype==="timestamp"?new Date(t.value):t.datatype==="counter"?new _u(t.value):t.value}function yu(t,e){const n=/^(\d+)@(.*)$/,r=n.test(t)?ir(t):{counter:0,actorId:t},i=n.test(e)?ir(e):{counter:0,actorId:e};return r.counter<i.counter?-1:r.counter>i.counter?1:r.actorId<i.actorId?-1:r.actorId>i.actorId?1:0}function wu(t,e,n,r){if(!!t)for(let i of Object.keys(t)){const s={},a=Object.keys(t[i]).sort(yu).reverse();for(let o of a){const c=t[i][o];n[i]&&n[i][o]?s[o]=Ke(c,n[i][o],r):s[o]=Ke(c,void 0,r)}a.length===0?(delete e[i],delete n[i]):(e[i]=s[a[0]],n[i]=s)}}function vo(t,e){const n=wo(t),r=wo(t?t[vt]:void 0);return Object.defineProperty(n,mn,{value:e}),Object.defineProperty(n,vt,{value:r}),n}function vu(t,e,n){const r=t.objectId;n[r]||(n[r]=vo(e,r));const i=n[r];return wu(t.props,i,i[vt],n),i}function xu(t,e,n){const r=t.objectId;n[r]||(n[r]=e?e._clone():bu(r));const i=n[r];for(let s of Object.keys(t.props||{})){const a=Object.keys(t.props[s]);if(a.length===0)i.remove(s);else if(a.length===1){const o=t.props[s][a[0]];i._set(s,Ke(o,i.byId(s),n),a[0])}else throw new RangeError("Conflicts are not supported on properties of a table")}return i}function Iu(t,e){const n=t?t.slice():[],r=t&&t[vt]?t[vt].slice():[],i=t&&t[sr]?t[sr].slice():[];return Object.defineProperty(n,mn,{value:e}),Object.defineProperty(n,vt,{value:r}),Object.defineProperty(n,sr,{value:i}),n}function Eu(t,e,n){const r=t.objectId;n[r]||(n[r]=Iu(e,r));const i=n[r],s=i[vt],a=i[sr];for(let o=0;o<t.edits.length;o++){const c=t.edits[o];if(c.action==="insert"||c.action==="update"){const l=s[c.index]&&s[c.index][c.opId];let f=Ke(c.value,l,n),d={[c.opId]:f};for(;o<t.edits.length-1&&t.edits[o+1].index===c.index&&t.edits[o+1].action==="update";){o++;const p=t.edits[o],u=s[p.index]&&s[p.index][p.opId];f=Ke(p.value,u,n),d[p.opId]=f}c.action==="insert"?(i.splice(c.index,0,f),s.splice(c.index,0,d),a.splice(c.index,0,c.elemId)):(i[c.index]=f,s[c.index]=d)}else if(c.action==="multi-insert"){const l=ir(c.elemId),f=[],d=[],p=[],u=c.datatype;c.values.forEach((b,O)=>{const E=`${l.counter+O}@${l.actorId}`;b=Ke({value:b,datatype:u},void 0,n),d.push(b),p.push({[E]:{value:b,datatype:u,type:"value"}}),f.push(E)}),i.splice(c.index,0,...d),s.splice(c.index,0,...p),a.splice(c.index,0,...f)}else c.action==="remove"&&(i.splice(c.index,c.count),s.splice(c.index,c.count),a.splice(c.index,c.count))}return i}function Ou(t,e,n){const r=t.objectId;let i;n[r]?i=n[r].elems:e?i=e.elems.slice():i=[];for(const s of t.edits)if(s.action==="insert"){const a=Ke(s.value,void 0,n),o={elemId:s.elemId,pred:[s.opId],value:a};i.splice(s.index,0,o)}else if(s.action==="multi-insert"){const a=ir(s.elemId),o=s.datatype,c=s.values.map((l,f)=>{l=Ke({datatype:o,value:l},void 0,n);const d=`${a.counter+f}@${a.actorId}`;return{elemId:d,pred:[d],value:l}});i.splice(s.index,0,...c)}else if(s.action==="update"){const a=i[s.index].elemId,o=Ke(s.value,i[s.index].value,n);i[s.index]={elemId:a,pred:[s.opId],value:o}}else s.action==="remove"&&i.splice(s.index,s.count);return n[r]=mu(r,i),n[r]}function xo(t,e,n){if(gu(e)&&(!t.props||Object.keys(t.props).length===0)&&(!t.edits||t.edits.length===0)&&!n[t.objectId])return e;if(t.type==="map")return vu(t,e,n);if(t.type==="table")return xu(t,e,n);if(t.type==="list")return Eu(t,e,n);if(t.type==="text")return Ou(t,e,n);throw new TypeError(`Unknown object type: ${t.type}`)}function Au(t){if(t[mn]!=="_root")throw new RangeError(`Not the root object: ${t[mn]}`);return vo(t,"_root")}var Io={interpretPatch:xo,cloneRootObject:Au};const{OBJECT_ID:xt,CHANGE:or,STATE:Cu}=ot,{createArrayOfNulls:Ru}=Be,{Text:Tu}=tr,{Table:ku}=rr;function Le(t){if(typeof t=="string"&&/^[0-9]+$/.test(t)&&(t=parseInt(t,10)),typeof t!="number")throw new TypeError("A list index must be a number, but you passed "+JSON.stringify(t));if(t<0||isNaN(t)||t===1/0||t===-1/0)throw new RangeError("A list index must be positive, but you passed "+t);return t}function Su(t,e,n){const r={deleteAt(i,s){return t.splice(n,Le(i),s||1,[]),this},fill(i,s,a){let o=t.getObject(e);for(let c=Le(s||0);c<Le(a||o.length);c++)t.setListIndex(n,c,i);return this},indexOf(i,s=0){const a=i[xt];if(a){const o=t.getObject(e);for(let c=s;c<o.length;c++)if(o[c][xt]===a)return c;return-1}else return t.getObject(e).indexOf(i,s)},insertAt(i,...s){return t.splice(n,Le(i),0,s),this},pop(){let i=t.getObject(e);if(i.length==0)return;const s=t.getObjectField(n,e,i.length-1);return t.splice(n,i.length-1,1,[]),s},push(...i){let s=t.getObject(e);return t.splice(n,s.length,0,i),t.getObject(e).length},shift(){if(t.getObject(e).length==0)return;const s=t.getObjectField(n,e,0);return t.splice(n,0,1,[]),s},splice(i,s,...a){let o=t.getObject(e);i=Le(i),(s===void 0||s>o.length-i)&&(s=o.length-i);const c=[];for(let l=0;l<s;l++)c.push(t.getObjectField(n,e,i+l));return t.splice(n,i,s,a),c},unshift(...i){return t.splice(n,0,0,i),t.getObject(e).length}};for(let i of["entries","keys","values"]){let s=t.getObject(e);r[i]=()=>s[i]()}for(let i of["concat","every","filter","find","findIndex","forEach","includes","join","lastIndexOf","map","reduce","reduceRight","slice","some","toLocaleString","toString"])r[i]=(...s)=>t.getObject(e).map((o,c)=>t.getObjectField(n,e,c))[i](...s);return r}const Nu={get(t,e){const{context:n,objectId:r,path:i}=t;return e===xt?r:e===or?n:e===Cu?{actorId:n.actorId}:n.getObjectField(i,r,e)},set(t,e,n){const{context:r,path:i,readonly:s}=t;if(Array.isArray(s)&&s.indexOf(e)>=0)throw new RangeError(`Object property "${e}" cannot be modified`);return r.setMapKey(i,e,n),!0},deleteProperty(t,e){const{context:n,path:r,readonly:i}=t;if(Array.isArray(i)&&i.indexOf(e)>=0)throw new RangeError(`Object property "${e}" cannot be modified`);return n.deleteMapKey(r,e),!0},has(t,e){const{context:n,objectId:r}=t;return[xt,or].includes(e)||e in n.getObject(r)},getOwnPropertyDescriptor(t,e){const{context:n,objectId:r}=t,i=n.getObject(r);if(e in i)return{configurable:!0,enumerable:!0,value:n.getObjectField(r,e)}},ownKeys(t){const{context:e,objectId:n}=t;return Object.keys(e.getObject(n))}},$u={get(t,e){const[n,r,i]=t;return e===Symbol.iterator?n.getObject(r)[Symbol.iterator]:e===xt?r:e===or?n:e==="length"?n.getObject(r).length:typeof e=="string"&&/^[0-9]+$/.test(e)?n.getObjectField(i,r,Le(e)):Su(n,r,i)[e]},set(t,e,n){const[r,i,s]=t;if(e==="length"){if(typeof n!="number")throw new RangeError("Invalid array length");const a=r.getObject(i).length;a>n?r.splice(s,n,a-n,[]):r.splice(s,a,0,Ru(n-a))}else r.setListIndex(s,Le(e),n);return!0},deleteProperty(t,e){const[n,,r]=t;return n.splice(r,Le(e),1,[]),!0},has(t,e){const[n,r]=t;return typeof e=="string"&&/^[0-9]+$/.test(e)?Le(e)<n.getObject(r).length:["length",xt,or].includes(e)},getOwnPropertyDescriptor(t,e){const[n,r]=t,i=n.getObject(r);if(e==="length")return{writable:!0,value:i.length};if(e===xt)return{configurable:!1,enumerable:!1,value:r};if(typeof e=="string"&&/^[0-9]+$/.test(e)){const s=Le(e);if(s<i.length)return{configurable:!0,enumerable:!0,value:n.getObjectField(r,s)}}},ownKeys(t){const[e,n]=t,r=e.getObject(n);let i=["length"];for(let s of Object.keys(r))i.push(s);return i}};function Eo(t,e,n,r){return new Proxy({context:t,objectId:e,path:n,readonly:r},Nu)}function Du(t,e,n){return new Proxy([t,e,n],$u)}function ju(t,e,n){const r=this.getObject(e);return Array.isArray(r)?Du(this,e,t):r instanceof Tu||r instanceof ku?r.getWriteable(this,t):Eo(this,e,t,n)}function Bu(t){return t.instantiateObject=ju,Eo(t,"_root",[])}var Lu={rootObjectProxy:Bu};class Vu{constructor(e){if(!(Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER))throw new RangeError(`Value ${e} cannot be a uint`);this.value=e,Object.freeze(this)}}class Uu{constructor(e){if(!(Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=0))throw new RangeError(`Value ${e} cannot be a uint`);this.value=e,Object.freeze(this)}}class Mu{constructor(e){if(typeof e!="number")throw new RangeError(`Value ${e} cannot be a float64`);this.value=e||0,Object.freeze(this)}}var Oo={Int:Vu,Uint:Uu,Float64:Mu};const{CACHE:Pu,OBJECT_ID:ar,CONFLICTS:It,ELEM_IDS:Ao,STATE:Hu}=ot,{interpretPatch:Fu}=Io,{Text:bn}=tr,{Table:_n}=rr,{Counter:at,getWriteableCounter:zu}=pi,{Int:gi,Uint:mi,Float64:bi}=Oo,{isObject:yn,parseOpId:Co,createArrayOfNulls:Zu}=Be,qu=fi;class Gu{constructor(e,n,r){this.actorId=n,this.nextOpNum=e[Hu].maxOp+1,this.cache=e[Pu],this.updated={},this.ops=[],this.applyPatch=r||Fu}addOp(e){this.ops.push(e),e.action==="set"&&e.values?this.nextOpNum+=e.values.length:e.action==="del"&&e.multiOp?this.nextOpNum+=e.multiOp:this.nextOpNum+=1}nextOpId(){return`${this.nextOpNum}@${this.actorId}`}getValueDescription(e){if(!["object","boolean","number","string"].includes(typeof e))throw new TypeError(`Unsupported type of value: ${typeof e}`);if(yn(e)){if(e instanceof Date)return{type:"value",value:e.getTime(),datatype:"timestamp"};if(e instanceof gi)return{type:"value",value:e.value,datatype:"int"};if(e instanceof mi)return{type:"value",value:e.value,datatype:"uint"};if(e instanceof bi)return{type:"value",value:e.value,datatype:"float64"};if(e instanceof at)return{type:"value",value:e.value,datatype:"counter"};{const n=e[ar],r=this.getObjectType(n);if(!n)throw new RangeError(`Object ${JSON.stringify(e)} has no objectId`);return r==="list"||r==="text"?{objectId:n,type:r,edits:[]}:{objectId:n,type:r,props:{}}}}else return typeof e=="number"?Number.isInteger(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER?{type:"value",value:e,datatype:"int"}:{type:"value",value:e,datatype:"float64"}:{type:"value",value:e}}getValuesDescriptions(e,n,r){if(n instanceof _n){const i=n.byId(r);return i?{[r]:this.getValueDescription(i)}:{}}else if(n instanceof bn){const i=n.get(r),s=n.getElemId(r);return i?{[s]:this.getValueDescription(i)}:{}}else{const i=n[It][r],s={};if(!i)throw new RangeError(`No children at key ${r} of path ${JSON.stringify(e)}`);for(let a of Object.keys(i))s[a]=this.getValueDescription(i[a]);return s}}getPropertyValue(e,n,r){return e instanceof _n?e.byId(n):e instanceof bn?e.get(n):e[It][n][r]}getSubpatch(e,n){if(n.length==0)return e;let r=e,i=this.getObject("_root");for(let s of n){let a=this.getValuesDescriptions(n,i,s.key);if(r.props)r.props[s.key]||(r.props[s.key]=a);else if(r.edits)for(const c of Object.keys(a))r.edits.push({action:"update",index:s.key,opId:c,value:a[c]});let o=null;for(let c of Object.keys(a))a[c].objectId===s.objectId&&(o=c);if(!o)throw new RangeError(`Cannot find path object with objectId ${s.objectId}`);r=a[o],i=this.getPropertyValue(i,s.key,o)}return r}getObject(e){const n=this.updated[e]||this.cache[e];if(!n)throw new RangeError(`Target object does not exist: ${e}`);return n}getObjectType(e){if(e==="_root")return"map";const n=this.getObject(e);return n instanceof bn?"text":n instanceof _n?"table":Array.isArray(n)?"list":"map"}getObjectField(e,n,r){if(!["string","number"].includes(typeof r))return;const i=this.getObject(n);if(i[r]instanceof at)return zu(i[r].value,this,e,n,r);if(yn(i[r])){const s=i[r][ar],a=e.concat([{key:r,objectId:s}]);return this.instantiateObject(a,s)}else return i[r]}createNestedObjects(e,n,r,i,s,a){if(r[ar])throw new RangeError("Cannot create a reference to an existing document object");const o=this.nextOpId();if(r instanceof bn){this.addOp(a?{action:"makeText",obj:e,elemId:a,insert:i,pred:s}:{action:"makeText",obj:e,key:n,insert:i,pred:s});const c={objectId:o,type:"text",edits:[]};return this.insertListItems(c,0,[...r],!0),c}else if(r instanceof _n){if(r.count>0)throw new RangeError("Assigning a non-empty Table object is not supported");return this.addOp(a?{action:"makeTable",obj:e,elemId:a,insert:i,pred:s}:{action:"makeTable",obj:e,key:n,insert:i,pred:s}),{objectId:o,type:"table",props:{}}}else if(Array.isArray(r)){this.addOp(a?{action:"makeList",obj:e,elemId:a,insert:i,pred:s}:{action:"makeList",obj:e,key:n,insert:i,pred:s});const c={objectId:o,type:"list",edits:[]};return this.insertListItems(c,0,r,!0),c}else{this.addOp(a?{action:"makeMap",obj:e,elemId:a,insert:i,pred:s}:{action:"makeMap",obj:e,key:n,insert:i,pred:s});let c={};for(let l of Object.keys(r).sort()){const f=this.nextOpId(),d=this.setValue(o,l,r[l],!1,[]);c[l]={[f]:d}}return{objectId:o,type:"map",props:c}}}setValue(e,n,r,i,s,a){if(!e)throw new RangeError("setValue needs an objectId");if(n==="")throw new RangeError("The key of a map entry must not be an empty string");if(yn(r)&&!(r instanceof Date)&&!(r instanceof at)&&!(r instanceof gi)&&!(r instanceof mi)&&!(r instanceof bi))return this.createNestedObjects(e,n,r,i,s,a);{const o=this.getValueDescription(r),c={action:"set",obj:e,insert:i,value:o.value,pred:s};return a?c.elemId=a:c.key=n,o.datatype&&(c.datatype=o.datatype),this.addOp(c),o}}applyAtPath(e,n){let r={objectId:"_root",type:"map",props:{}};n(this.getSubpatch(r,e)),this.applyPatch(r,this.cache._root,this.updated)}setMapKey(e,n,r){if(typeof n!="string")throw new RangeError(`The key of a map entry must be a string, not ${typeof n}`);const i=e.length===0?"_root":e[e.length-1].objectId,s=this.getObject(i);if(s[n]instanceof at)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(s[n]!==r||Object.keys(s[It][n]||{}).length>1||r===void 0)&&this.applyAtPath(e,a=>{const o=wn(s,n),c=this.nextOpId(),l=this.setValue(i,n,r,!1,o);a.props[n]={[c]:l}})}deleteMapKey(e,n){const r=e.length===0?"_root":e[e.length-1].objectId,i=this.getObject(r);if(i[n]!==void 0){const s=wn(i,n);this.addOp({action:"del",obj:r,key:n,insert:!1,pred:s}),this.applyAtPath(e,a=>{a.props[n]={}})}}insertListItems(e,n,r,i){const s=i?[]:this.getObject(e.objectId);if(n<0||n>s.length)throw new RangeError(`List index ${n} is out of bounds for list of length ${s.length}`);if(r.length===0)return;let a=lr(s,n,!0);const o=r.every(f=>typeof f=="string"||typeof f=="number"||typeof f=="boolean"||f===null||yn(f)&&(f instanceof Date||f instanceof at||f instanceof gi||f instanceof mi||f instanceof bi)),c=o?r.map(f=>this.getValueDescription(f)):[],l=c.every(f=>f.datatype===c[0].datatype);if(o&&l&&r.length>1){const f=this.nextOpId(),d=c[0].datatype,p=c.map(O=>O.value),u={action:"set",obj:e.objectId,elemId:a,insert:!0,values:p,pred:[]},b={action:"multi-insert",elemId:f,index:n,values:p};d&&(u.datatype=d,b.datatype=d),this.addOp(u),e.edits.push(b)}else for(let f=0;f<r.length;f++){let d=this.nextOpId();const p=this.setValue(e.objectId,n+f,r[f],!0,[],a);a=d,e.edits.push({action:"insert",index:n+f,elemId:a,opId:a,value:p})}}setListIndex(e,n,r){const i=e.length===0?"_root":e[e.length-1].objectId,s=this.getObject(i);if(n>=s.length){const a=Zu(n-s.length);return a.push(r),this.splice(e,s.length,0,a)}if(s[n]instanceof at)throw new RangeError("Cannot overwrite a Counter object; use .increment() or .decrement() to change its value.");(s[n]!==r||Object.keys(s[It][n]||{}).length>1||r===void 0)&&this.applyAtPath(e,a=>{const o=wn(s,n),c=this.nextOpId(),l=this.setValue(i,n,r,!1,o,lr(s,n));a.edits.push({action:"update",index:n,opId:c,value:l})})}splice(e,n,r,i){const s=e.length===0?"_root":e[e.length-1].objectId;let a=this.getObject(s);if(n<0||r<0||n>a.length-r)throw new RangeError(`${r} deletions starting at index ${n} are out of bounds for list of length ${a.length}`);if(r===0&&i.length===0)return;let o={diffs:{objectId:"_root",type:"map",props:{}}},c=this.getSubpatch(o.diffs,e);if(r>0){let l,f,d;for(let p=0;p<r;p++){if(this.getObjectField(e,s,n+p)instanceof at)throw new TypeError("Unsupported operation: deleting a counter from a list");const u=lr(a,n+p),b=Co(u),O=wn(a,n+p),E=O.length===1?Co(O[0]):void 0;l&&f&&d&&E&&f.actorId===b.actorId&&f.counter+1===b.counter&&d.actorId===E.actorId&&d.counter+1===E.counter?l.multiOp=(l.multiOp||1)+1:(l&&this.addOp(l),l={action:"del",obj:s,elemId:u,insert:!1,pred:O}),f=b,d=E}this.addOp(l),c.edits.push({action:"remove",index:n,count:r})}i.length>0&&this.insertListItems(c,n,i,!1),this.applyPatch(o.diffs,this.cache._root,this.updated)}addTableRow(e,n){if(!yn(n)||Array.isArray(n))throw new TypeError("A table row must be an object");if(n[ar])throw new TypeError("Cannot reuse an existing object as table row");if(n.id)throw new TypeError('A table row must not have an "id" property; it is generated automatically');const r=qu(),i=this.setValue(e[e.length-1].objectId,r,n,!1,[]);return this.applyAtPath(e,s=>{s.props[r]={[i.objectId]:i}}),r}deleteTableRow(e,n,r){const i=e[e.length-1].objectId;this.getObject(i).byId(n)&&(this.addOp({action:"del",obj:i,key:n,insert:!1,pred:[r]}),this.applyAtPath(e,a=>{a.props[n]={}}))}increment(e,n,r){const i=e.length===0?"_root":e[e.length-1].objectId,s=this.getObject(i);if(!(s[n]instanceof at))throw new TypeError("Only counter values can be incremented");const a=this.getObjectType(i),o=s[n].value+r,c=this.nextOpId(),l=wn(s,n);if(a==="list"||a==="text"){const f=lr(s,n,!1);this.addOp({action:"inc",obj:i,elemId:f,value:r,insert:!1,pred:l})}else this.addOp({action:"inc",obj:i,key:n,value:r,insert:!1,pred:l});this.applyAtPath(e,f=>{a==="list"||a==="text"?f.edits.push({action:"update",index:n,opId:c,value:{value:o,datatype:"counter"}}):f.props[n]={[c]:{value:o,datatype:"counter"}}})}}function wn(t,e){return t instanceof _n?[t.opIds[e]]:t instanceof bn?t.elems[e].pred:t[It]?t[It][e]?Object.keys(t[It][e]):[]:[]}function lr(t,e,n=!1){if(n){if(e===0)return"_head";e-=1}if(t[Ao])return t[Ao][e];if(t.getElemId)return t.getElemId(e);throw new RangeError(`Cannot find elemId at list index ${e}`)}var Ku={Context:Gu};const{OBJECT_ID:Yu,CONFLICTS:ve}=ot;class Wu{constructor(){this.observers={}}patchCallback(e,n,r,i,s){this._objectUpdate(e.diffs,n,r,i,s)}_objectUpdate(e,n,r,i,s){if(!!e.objectId){if(this.observers[e.objectId])for(let a of this.observers[e.objectId])a(e,n,r,i,s);if(e.type==="map"&&e.props)for(const a of Object.keys(e.props))for(const o of Object.keys(e.props[a]))this._objectUpdate(e.props[a][o],n&&n[ve]&&n[ve][a]&&n[ve][a][o],r&&r[ve]&&r[ve][a]&&r[ve][a][o],i,s);else if(e.type==="table"&&e.props)for(const a of Object.keys(e.props))for(const o of Object.keys(e.props[a]))this._objectUpdate(e.props[a][o],n&&n.byId(a),r&&r.byId(a),i,s);else if(e.type==="list"&&e.edits){let a=0;for(const o of e.edits)o.action==="insert"?(a-=1,this._objectUpdate(o.value,void 0,r&&r[ve]&&r[ve][o.index]&&r[ve][o.index][o.elemId],i,s)):o.action==="multi-insert"?a-=o.values.length:o.action==="update"?this._objectUpdate(o.value,n&&n[ve]&&n[ve][o.index+a]&&n[ve][o.index+a][o.opId],r&&r[ve]&&r[ve][o.index]&&r[ve][o.index][o.opId],i,s):o.action==="remove"&&(a+=o.count)}else if(e.type==="text"&&e.edits){let a=0;for(const o of e.edits)o.action==="insert"?(a-=1,this._objectUpdate(o.value,void 0,r&&r.get(o.index),i,s)):o.action==="multi-insert"?a-=o.values.length:o.action==="update"?this._objectUpdate(o.value,n&&n.get(o.index+a),r&&r.get(o.index),i,s):o.action==="remove"&&(a+=o.count)}}}observe(e,n){const r=e[Yu];if(!r)throw new TypeError("The observed object must be part of an Automerge document");this.observers[r]||(this.observers[r]=[]),this.observers[r].push(n)}}var Ju={Observable:Wu};const{OPTIONS:Ve,CACHE:Vt,STATE:Ue,OBJECT_ID:Ut,CONFLICTS:Mt,CHANGE:Ro,ELEM_IDS:Xu}=ot,{isObject:_i,copyObject:yi}=Be,Qu=fi,{interpretPatch:eh,cloneRootObject:th}=Io,{rootObjectProxy:nh}=Lu,{Context:To}=Ku,{Text:wi}=tr,{Table:ko}=rr,{Counter:rh}=pi,{Float64:ih,Int:sh,Uint:oh}=Oo,{Observable:ah}=Ju;function So(t){if(typeof t!="string")throw new TypeError(`Unsupported type of actorId: ${typeof t}`);if(!/^[0-9a-f]+$/.test(t))throw new RangeError("actorId must consist only of lowercase hex digits");if(t.length%2!=0)throw new RangeError("actorId must consist of an even number of digits")}function cr(t,e,n){let r=e._root;if(r||(r=th(t[Vt]._root),e._root=r),Object.defineProperty(r,Ve,{value:t[Ve]}),Object.defineProperty(r,Vt,{value:e}),Object.defineProperty(r,Ue,{value:n}),t[Ve].freeze)for(let i of Object.keys(e))e[i]instanceof ko?e[i]._freeze():e[i]instanceof wi?(Object.freeze(e[i].elems),Object.freeze(e[i])):(Object.freeze(e[i]),Object.freeze(e[i][Mt]));for(let i of Object.keys(t[Vt]))e[i]||(e[i]=t[Vt][i]);return t[Ve].freeze&&Object.freeze(e),r}function No(t,e,n){const r=Pt(t);if(!r)throw new Error("Actor ID must be initialized with setActorId() before making a change");const i=yi(t[Ue]);i.seq+=1;const s={actor:r,seq:i.seq,startOp:i.maxOp+1,deps:i.deps,time:n&&typeof n.time=="number"?n.time:Math.round(new Date().getTime()/1e3),message:n&&typeof n.message=="string"?n.message:"",ops:e.ops};if(t[Ve].backend){const[a,o,c]=t[Ve].backend.applyLocalChange(i.backendState,s);i.backendState=a,i.lastLocalChange=c;const l=vi(t,o,i,!0),f=n&&n.patchCallback||t[Ve].patchCallback;return f&&f(o,t,l,!0,[c]),[l,s]}else{const a={actor:r,seq:s.seq,before:t};return i.requests=i.requests.concat([a]),i.maxOp=i.maxOp+lh(s.ops),i.deps=[],[cr(t,e?e.updated:{},i),s]}}function lh(t){let e=0;for(const n of t)n.action==="set"&&n.values?e+=n.values.length:e+=1;return e}function ch(t){return t[Ue]&&t[Ue].lastLocalChange?t[Ue].lastLocalChange:null}function vi(t,e,n,r){const i=Pt(t),s={};if(eh(e.diffs,t,s),r){if(!e.clock)throw new RangeError("patch is missing clock field");e.clock[i]&&e.clock[i]>n.seq&&(n.seq=e.clock[i]),n.clock=e.clock,n.deps=e.deps,n.maxOp=Math.max(n.maxOp,e.maxOp)}return cr(t,s,n)}function $o(t){if(typeof t=="string")t={actorId:t};else if(typeof t=="undefined")t={};else if(!_i(t))throw new TypeError(`Unsupported value for init() options: ${t}`);if(t.deferActorId||(t.actorId===void 0&&(t.actorId=Qu()),So(t.actorId)),t.observable){const i=t.patchCallback,s=t.observable;t.patchCallback=(a,o,c,l,f)=>{i&&i(a,o,c,l,f),s.patchCallback(a,o,c,l,f)}}const e={},n={_root:e},r={seq:0,maxOp:0,requests:[],clock:{},deps:[]};return t.backend&&(r.backendState=t.backend.init(),r.lastLocalChange=null),Object.defineProperty(e,Ut,{value:"_root"}),Object.defineProperty(e,Ve,{value:Object.freeze(t)}),Object.defineProperty(e,Mt,{value:Object.freeze({})}),Object.defineProperty(e,Vt,{value:Object.freeze(n)}),Object.defineProperty(e,Ue,{value:Object.freeze(r)}),Object.freeze(e)}function fh(t,e){return Do($o(e),"Initialization",n=>Object.assign(n,t))}function Do(t,e,n){if(t[Ut]!=="_root")throw new TypeError("The first argument to Automerge.change must be the document root");if(t[Ro])throw new TypeError("Calls to Automerge.change cannot be nested");if(typeof e=="function"&&n===void 0&&([e,n]=[n,e]),typeof e=="string"&&(e={message:e}),e!==void 0&&!_i(e))throw new TypeError("Unsupported type of options");const r=Pt(t);if(!r)throw new Error("Actor ID must be initialized with setActorId() before making a change");const i=new To(t,r);return n(nh(i)),Object.keys(i.updated).length===0?[t,null]:No(t,i,e)}function uh(t,e){if(t[Ut]!=="_root")throw new TypeError("The first argument to Automerge.emptyChange must be the document root");if(typeof e=="string"&&(e={message:e}),e!==void 0&&!_i(e))throw new TypeError("Unsupported type of options");const n=Pt(t);if(!n)throw new Error("Actor ID must be initialized with setActorId() before making a change");return No(t,new To(t,n),e)}function hh(t,e,n=void 0){if(t[Ut]!=="_root")throw new TypeError("The first argument to Frontend.applyPatch must be the document root");const r=yi(t[Ue]);if(t[Ve].backend){if(!n)throw new RangeError("applyPatch must be called with the updated backend state");return r.backendState=n,vi(t,e,r,!0)}let i;if(r.requests.length>0)if(i=r.requests[0].before,e.actor===Pt(t)){if(r.requests[0].seq!==e.seq)throw new RangeError(`Mismatched sequence number: patch ${e.seq} does not match next request ${r.requests[0].seq}`);r.requests=r.requests.slice(1)}else r.requests=r.requests.slice();else i=t,r.requests=[];let s=vi(i,e,r,!0);return r.requests.length===0?s:(r.requests[0]=yi(r.requests[0]),r.requests[0].before=s,cr(t,{},r))}function dh(t){return t[Ut]}function ph(t,e){if(t[Ro])throw new TypeError("Cannot use getObjectById in a change callback");return t[Vt][e]}function Pt(t){return t[Ue].actorId||t[Ve].actorId}function gh(t,e){So(e);const n=Object.assign({},t[Ue],{actorId:e});return cr(t,{},n)}function mh(t,e){if(t[Mt]&&t[Mt][e]&&Object.keys(t[Mt][e]).length>1)return t[Mt][e]}function bh(t,e=null,n="first"){if(t[Ut]!=="_root"){const r=Array.isArray(t)?". Note: Automerge.applyChanges now returns an array.":"";throw e?new TypeError(`The ${n} argument to Automerge.${e} must be the document root${r}`):new TypeError(`Argument is not an Automerge document root${r}`)}return t[Ue].backendState}function _h(t){return t instanceof wi?t.elems.map(e=>e.elemId):t[Xu]}var yh={init:$o,from:fh,change:Do,emptyChange:uh,applyPatch:hh,getObjectId:dh,getObjectById:ph,getActorId:Pt,setActorId:gh,getConflicts:mh,getLastLocalChange:ch,getBackendState:bh,getElementIds:_h,Text:wi,Table:ko,Counter:rh,Observable:ah,Float64:ih,Int:sh,Uint:oh},Me={},Ht={},Pe={},Ft={};const wh=4,jo=0,Bo=1,vh=2;function zt(t){let e=t.length;for(;--e>=0;)t[e]=0}const xh=0,Lo=1,Ih=2,Eh=3,Oh=258,xi=29,vn=256,xn=vn+1+xi,Zt=30,Ii=19,Vo=2*xn+1,Et=15,Ei=16,Ah=7,Oi=256,Uo=16,Mo=17,Po=18,Ai=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Ch=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ho=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Rh=512,Ye=new Array((xn+2)*2);zt(Ye);const In=new Array(Zt*2);zt(In);const En=new Array(Rh);zt(En);const On=new Array(Oh-Eh+1);zt(On);const Ci=new Array(xi);zt(Ci);const ur=new Array(Zt);zt(ur);function Ri(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let Fo,zo,Zo;function Ti(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}const qo=t=>t<256?En[t]:En[256+(t>>>7)],An=(t,e)=>{t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255},Ie=(t,e,n)=>{t.bi_valid>Ei-n?(t.bi_buf|=e<<t.bi_valid&65535,An(t,t.bi_buf),t.bi_buf=e>>Ei-t.bi_valid,t.bi_valid+=n-Ei):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},He=(t,e,n)=>{Ie(t,n[e*2],n[e*2+1])},Go=(t,e)=>{let n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1},Th=t=>{t.bi_valid===16?(An(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)},kh=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,f,d,p,u,b,O=0;for(p=0;p<=Et;p++)t.bl_count[p]=0;for(n[t.heap[t.heap_max]*2+1]=0,l=t.heap_max+1;l<Vo;l++)f=t.heap[l],p=n[n[f*2+1]*2+1]+1,p>c&&(p=c,O++),n[f*2+1]=p,!(f>r)&&(t.bl_count[p]++,u=0,f>=o&&(u=a[f-o]),b=n[f*2],t.opt_len+=b*(p+u),s&&(t.static_len+=b*(i[f*2+1]+u)));if(O!==0){do{for(p=c-1;t.bl_count[p]===0;)p--;t.bl_count[p]--,t.bl_count[p+1]+=2,t.bl_count[c]--,O-=2}while(O>0);for(p=c;p!==0;p--)for(f=t.bl_count[p];f!==0;)d=t.heap[--l],!(d>r)&&(n[d*2+1]!==p&&(t.opt_len+=(p-n[d*2+1])*n[d*2],n[d*2+1]=p),f--)}},Ko=(t,e,n)=>{const r=new Array(Et+1);let i=0,s,a;for(s=1;s<=Et;s++)r[s]=i=i+n[s-1]<<1;for(a=0;a<=e;a++){let o=t[a*2+1];o!==0&&(t[a*2]=Go(r[o]++,o))}},Sh=()=>{let t,e,n,r,i;const s=new Array(Et+1);for(n=0,r=0;r<xi-1;r++)for(Ci[r]=n,t=0;t<1<<Ai[r];t++)On[n++]=r;for(On[n-1]=r,i=0,r=0;r<16;r++)for(ur[r]=i,t=0;t<1<<fr[r];t++)En[i++]=r;for(i>>=7;r<Zt;r++)for(ur[r]=i<<7,t=0;t<1<<fr[r]-7;t++)En[256+i++]=r;for(e=0;e<=Et;e++)s[e]=0;for(t=0;t<=143;)Ye[t*2+1]=8,t++,s[8]++;for(;t<=255;)Ye[t*2+1]=9,t++,s[9]++;for(;t<=279;)Ye[t*2+1]=7,t++,s[7]++;for(;t<=287;)Ye[t*2+1]=8,t++,s[8]++;for(Ko(Ye,xn+1,s),t=0;t<Zt;t++)In[t*2+1]=5,In[t*2]=Go(t,5);Fo=new Ri(Ye,Ai,vn+1,xn,Et),zo=new Ri(In,fr,0,Zt,Et),Zo=new Ri(new Array(0),Ch,0,Ii,Ah)},Yo=t=>{let e;for(e=0;e<xn;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Zt;e++)t.dyn_dtree[e*2]=0;for(e=0;e<Ii;e++)t.bl_tree[e*2]=0;t.dyn_ltree[Oi*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0},Wo=t=>{t.bi_valid>8?An(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},Nh=(t,e,n,r)=>{Wo(t),r&&(An(t,n),An(t,~n)),t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},Jo=(t,e,n,r)=>{const i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},ki=(t,e,n)=>{const r=t.heap[n];let i=n<<1;for(;i<=t.heap_len&&(i<t.heap_len&&Jo(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!Jo(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r},Xo=(t,e,n)=>{let r,i,s=0,a,o;if(t.last_lit!==0)do r=t.pending_buf[t.d_buf+s*2]<<8|t.pending_buf[t.d_buf+s*2+1],i=t.pending_buf[t.l_buf+s],s++,r===0?He(t,i,e):(a=On[i],He(t,a+vn+1,e),o=Ai[a],o!==0&&(i-=Ci[a],Ie(t,i,o)),r--,a=qo(r),He(t,a,n),o=fr[a],o!==0&&(r-=ur[a],Ie(t,r,o)));while(s<t.last_lit);He(t,Oi,e)},Si=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let a,o,c=-1,l;for(t.heap_len=0,t.heap_max=Vo,a=0;a<s;a++)n[a*2]!==0?(t.heap[++t.heap_len]=c=a,t.depth[a]=0):n[a*2+1]=0;for(;t.heap_len<2;)l=t.heap[++t.heap_len]=c<2?++c:0,n[l*2]=1,t.depth[l]=0,t.opt_len--,i&&(t.static_len-=r[l*2+1]);for(e.max_code=c,a=t.heap_len>>1;a>=1;a--)ki(t,n,a);l=s;do a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],ki(t,n,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,n[l*2]=n[a*2]+n[o*2],t.depth[l]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,n[a*2+1]=n[o*2+1]=l,t.heap[1]=l++,ki(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],kh(t,e),Ko(n,c,t.bl_count)},Qo=(t,e,n)=>{let r,i=-1,s,a=e[0*2+1],o=0,c=7,l=4;for(a===0&&(c=138,l=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=a,a=e[(r+1)*2+1],!(++o<c&&s===a)&&(o<l?t.bl_tree[s*2]+=o:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Uo*2]++):o<=10?t.bl_tree[Mo*2]++:t.bl_tree[Po*2]++,o=0,i=s,a===0?(c=138,l=3):s===a?(c=6,l=3):(c=7,l=4))},ea=(t,e,n)=>{let r,i=-1,s,a=e[0*2+1],o=0,c=7,l=4;for(a===0&&(c=138,l=3),r=0;r<=n;r++)if(s=a,a=e[(r+1)*2+1],!(++o<c&&s===a)){if(o<l)do He(t,s,t.bl_tree);while(--o!=0);else s!==0?(s!==i&&(He(t,s,t.bl_tree),o--),He(t,Uo,t.bl_tree),Ie(t,o-3,2)):o<=10?(He(t,Mo,t.bl_tree),Ie(t,o-3,3)):(He(t,Po,t.bl_tree),Ie(t,o-11,7));o=0,i=s,a===0?(c=138,l=3):s===a?(c=6,l=3):(c=7,l=4)}},$h=t=>{let e;for(Qo(t,t.dyn_ltree,t.l_desc.max_code),Qo(t,t.dyn_dtree,t.d_desc.max_code),Si(t,t.bl_desc),e=Ii-1;e>=3&&t.bl_tree[Ho[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e},Dh=(t,e,n,r)=>{let i;for(Ie(t,e-257,5),Ie(t,n-1,5),Ie(t,r-4,4),i=0;i<r;i++)Ie(t,t.bl_tree[Ho[i]*2+1],3);ea(t,t.dyn_ltree,e-1),ea(t,t.dyn_dtree,n-1)},jh=t=>{let e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return jo;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return Bo;for(n=32;n<vn;n++)if(t.dyn_ltree[n*2]!==0)return Bo;return jo};let ta=!1;const Bh=t=>{ta||(Sh(),ta=!0),t.l_desc=new Ti(t.dyn_ltree,Fo),t.d_desc=new Ti(t.dyn_dtree,zo),t.bl_desc=new Ti(t.bl_tree,Zo),t.bi_buf=0,t.bi_valid=0,Yo(t)},na=(t,e,n,r)=>{Ie(t,(xh<<1)+(r?1:0),3),Nh(t,e,n,!0)},Lh=t=>{Ie(t,Lo<<1,3),He(t,Oi,Ye),Th(t)},Vh=(t,e,n,r)=>{let i,s,a=0;t.level>0?(t.strm.data_type===vh&&(t.strm.data_type=jh(t)),Si(t,t.l_desc),Si(t,t.d_desc),a=$h(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?na(t,e,n,r):t.strategy===wh||s===i?(Ie(t,(Lo<<1)+(r?1:0),3),Xo(t,Ye,In)):(Ie(t,(Ih<<1)+(r?1:0),3),Dh(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),Xo(t,t.dyn_ltree,t.dyn_dtree)),Yo(t),r&&Wo(t)},Uh=(t,e,n)=>(t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=n&255,t.last_lit++,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(On[n]+vn+1)*2]++,t.dyn_dtree[qo(e)*2]++),t.last_lit===t.lit_bufsize-1);Ft._tr_init=Bh;Ft._tr_stored_block=na;Ft._tr_flush_block=Vh;Ft._tr_tally=Uh;Ft._tr_align=Lh;const Mh=(t,e,n,r)=>{let i=t&65535|0,s=t>>>16&65535|0,a=0;for(;n!==0;){a=n>2e3?2e3:n,n-=a;do i=i+e[r++]|0,s=s+i|0;while(--a);i%=65521,s%=65521}return i|s<<16|0};var ra=Mh;const Ph=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e},Hh=new Uint32Array(Ph()),Fh=(t,e,n,r)=>{const i=Hh,s=r+n;t^=-1;for(let a=r;a<s;a++)t=t>>>8^i[(t^e[a])&255];return t^-1};var ia=Fh,Ni={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ot={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:zh,_tr_stored_block:Zh,_tr_flush_block:qh,_tr_tally:lt,_tr_align:Gh}=Ft,sa=ra,ct=ia,Kh=Ni,{Z_NO_FLUSH:At,Z_PARTIAL_FLUSH:Yh,Z_FULL_FLUSH:Wh,Z_FINISH:ft,Z_BLOCK:oa,Z_OK:Fe,Z_STREAM_END:aa,Z_STREAM_ERROR:Re,Z_DATA_ERROR:Jh,Z_BUF_ERROR:$i,Z_DEFAULT_COMPRESSION:Xh,Z_FILTERED:Qh,Z_HUFFMAN_ONLY:hr,Z_RLE:ed,Z_FIXED:td,Z_DEFAULT_STRATEGY:nd,Z_UNKNOWN:rd,Z_DEFLATED:dr}=Ot,id=9,sd=15,od=8,ad=29,ld=256,Di=ld+1+ad,cd=30,fd=19,ud=2*Di+1,hd=15,G=3,ut=258,ke=ut+G+1,dd=32,pr=42,ji=69,gr=73,mr=91,br=103,Ct=113,Cn=666,le=1,Rn=2,Rt=3,qt=4,pd=3,ht=(t,e)=>(t.msg=Kh[e],e),la=t=>(t<<1)-(t>4?9:0),dt=t=>{let e=t.length;for(;--e>=0;)t[e]=0};let gd=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask,pt=gd;const gt=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))},he=(t,e)=>{qh(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,gt(t.strm)},X=(t,e)=>{t.pending_buf[t.pending++]=e},Tn=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255},md=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),t.state.wrap===1?t.adler=sa(t.adler,e,i,n):t.state.wrap===2&&(t.adler=ct(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},ca=(t,e)=>{let n=t.max_chain_length,r=t.strstart,i,s,a=t.prev_length,o=t.nice_match;const c=t.strstart>t.w_size-ke?t.strstart-(t.w_size-ke):0,l=t.window,f=t.w_mask,d=t.prev,p=t.strstart+ut;let u=l[r+a-1],b=l[r+a];t.prev_length>=t.good_match&&(n>>=2),o>t.lookahead&&(o=t.lookahead);do if(i=e,!(l[i+a]!==b||l[i+a-1]!==u||l[i]!==l[r]||l[++i]!==l[r+1])){r+=2,i++;do;while(l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&l[++r]===l[++i]&&r<p);if(s=ut-(p-r),r=p-ut,s>a){if(t.match_start=e,a=s,s>=o)break;u=l[r+a-1],b=l[r+a]}}while((e=d[e&f])>c&&--n!=0);return a<=t.lookahead?a:t.lookahead},Tt=t=>{const e=t.w_size;let n,r,i,s,a;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-ke)){t.window.set(t.window.subarray(e,e+e),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=t.hash_size,n=r;do i=t.head[--n],t.head[n]=i>=e?i-e:0;while(--r);r=e,n=r;do i=t.prev[--n],t.prev[n]=i>=e?i-e:0;while(--r);s+=e}if(t.strm.avail_in===0)break;if(r=md(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=r,t.lookahead+t.insert>=G)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=pt(t,t.ins_h,t.window[a+1]);t.insert&&(t.ins_h=pt(t,t.ins_h,t.window[a+G-1]),t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<G)););}while(t.lookahead<ke&&t.strm.avail_in!==0)},bd=(t,e)=>{let n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(Tt(t),t.lookahead===0&&e===At)return le;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;const r=t.block_start+n;if((t.strstart===0||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,he(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-ke&&(he(t,!1),t.strm.avail_out===0))return le}return t.insert=0,e===ft?(he(t,!0),t.strm.avail_out===0?Rt:qt):(t.strstart>t.block_start&&(he(t,!1),t.strm.avail_out===0),le)},Bi=(t,e)=>{let n,r;for(;;){if(t.lookahead<ke){if(Tt(t),t.lookahead<ke&&e===At)return le;if(t.lookahead===0)break}if(n=0,t.lookahead>=G&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+G-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-ke&&(t.match_length=ca(t,n)),t.match_length>=G)if(r=lt(t,t.strstart-t.match_start,t.match_length-G),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=G){t.match_length--;do t.strstart++,t.ins_h=pt(t,t.ins_h,t.window[t.strstart+G-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!=0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=pt(t,t.ins_h,t.window[t.strstart+1]);else r=lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(he(t,!1),t.strm.avail_out===0))return le}return t.insert=t.strstart<G-1?t.strstart:G-1,e===ft?(he(t,!0),t.strm.avail_out===0?Rt:qt):t.last_lit&&(he(t,!1),t.strm.avail_out===0)?le:Rn},Gt=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<ke){if(Tt(t),t.lookahead<ke&&e===At)return le;if(t.lookahead===0)break}if(n=0,t.lookahead>=G&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+G-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=G-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-ke&&(t.match_length=ca(t,n),t.match_length<=5&&(t.strategy===Qh||t.match_length===G&&t.strstart-t.match_start>4096)&&(t.match_length=G-1)),t.prev_length>=G&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-G,r=lt(t,t.strstart-1-t.prev_match,t.prev_length-G),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=pt(t,t.ins_h,t.window[t.strstart+G-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!=0);if(t.match_available=0,t.match_length=G-1,t.strstart++,r&&(he(t,!1),t.strm.avail_out===0))return le}else if(t.match_available){if(r=lt(t,0,t.window[t.strstart-1]),r&&he(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return le}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=lt(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<G-1?t.strstart:G-1,e===ft?(he(t,!0),t.strm.avail_out===0?Rt:qt):t.last_lit&&(he(t,!1),t.strm.avail_out===0)?le:Rn},_d=(t,e)=>{let n,r,i,s;const a=t.window;for(;;){if(t.lookahead<=ut){if(Tt(t),t.lookahead<=ut&&e===At)return le;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=G&&t.strstart>0&&(i=t.strstart-1,r=a[i],r===a[++i]&&r===a[++i]&&r===a[++i])){s=t.strstart+ut;do;while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);t.match_length=ut-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=G?(n=lt(t,1,t.match_length-G),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(he(t,!1),t.strm.avail_out===0))return le}return t.insert=0,e===ft?(he(t,!0),t.strm.avail_out===0?Rt:qt):t.last_lit&&(he(t,!1),t.strm.avail_out===0)?le:Rn},yd=(t,e)=>{let n;for(;;){if(t.lookahead===0&&(Tt(t),t.lookahead===0)){if(e===At)return le;break}if(t.match_length=0,n=lt(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(he(t,!1),t.strm.avail_out===0))return le}return t.insert=0,e===ft?(he(t,!0),t.strm.avail_out===0?Rt:qt):t.last_lit&&(he(t,!1),t.strm.avail_out===0)?le:Rn};function ze(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const kn=[new ze(0,0,0,0,bd),new ze(4,4,8,4,Bi),new ze(4,5,16,8,Bi),new ze(4,6,32,32,Bi),new ze(4,4,16,16,Gt),new ze(8,16,32,32,Gt),new ze(8,16,128,128,Gt),new ze(8,32,128,256,Gt),new ze(32,128,258,1024,Gt),new ze(32,258,258,4096,Gt)],wd=t=>{t.window_size=2*t.w_size,dt(t.head),t.max_lazy_match=kn[t.level].max_lazy,t.good_match=kn[t.level].good_length,t.nice_match=kn[t.level].nice_length,t.max_chain_length=kn[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=G-1,t.match_available=0,t.ins_h=0};function vd(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=dr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(ud*2),this.dyn_dtree=new Uint16Array((2*cd+1)*2),this.bl_tree=new Uint16Array((2*fd+1)*2),dt(this.dyn_ltree),dt(this.dyn_dtree),dt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(hd+1),this.heap=new Uint16Array(2*Di+1),dt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*Di+1),dt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const fa=t=>{if(!t||!t.state)return ht(t,Re);t.total_in=t.total_out=0,t.data_type=rd;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?pr:Ct,t.adler=e.wrap===2?0:1,e.last_flush=At,zh(e),Fe},ua=t=>{const e=fa(t);return e===Fe&&wd(t.state),e},xd=(t,e)=>!t||!t.state||t.state.wrap!==2?Re:(t.state.gzhead=e,Fe),ha=(t,e,n,r,i,s)=>{if(!t)return Re;let a=1;if(e===Xh&&(e=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>id||n!==dr||r<8||r>15||e<0||e>9||s<0||s>td)return ht(t,Re);r===8&&(r=9);const o=new vd;return t.state=o,o.strm=t,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+G-1)/G),o.window=new Uint8Array(o.w_size*2),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=o.lit_bufsize*4,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=(1+2)*o.lit_bufsize,o.level=e,o.strategy=s,o.method=n,ua(t)},Id=(t,e)=>ha(t,e,dr,sd,od,nd),Ed=(t,e)=>{let n,r;if(!t||!t.state||e>oa||e<0)return t?ht(t,Re):Re;const i=t.state;if(!t.output||!t.input&&t.avail_in!==0||i.status===Cn&&e!==ft)return ht(t,t.avail_out===0?$i:Re);i.strm=t;const s=i.last_flush;if(i.last_flush=e,i.status===pr)if(i.wrap===2)t.adler=0,X(i,31),X(i,139),X(i,8),i.gzhead?(X(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),X(i,i.gzhead.time&255),X(i,i.gzhead.time>>8&255),X(i,i.gzhead.time>>16&255),X(i,i.gzhead.time>>24&255),X(i,i.level===9?2:i.strategy>=hr||i.level<2?4:0),X(i,i.gzhead.os&255),i.gzhead.extra&&i.gzhead.extra.length&&(X(i,i.gzhead.extra.length&255),X(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=ct(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=ji):(X(i,0),X(i,0),X(i,0),X(i,0),X(i,0),X(i,i.level===9?2:i.strategy>=hr||i.level<2?4:0),X(i,pd),i.status=Ct);else{let a=dr+(i.w_bits-8<<4)<<8,o=-1;i.strategy>=hr||i.level<2?o=0:i.level<6?o=1:i.level===6?o=2:o=3,a|=o<<6,i.strstart!==0&&(a|=dd),a+=31-a%31,i.status=Ct,Tn(i,a),i.strstart!==0&&(Tn(i,t.adler>>>16),Tn(i,t.adler&65535)),t.adler=1}if(i.status===ji)if(i.gzhead.extra){for(n=i.pending;i.gzindex<(i.gzhead.extra.length&65535)&&!(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),gt(t),n=i.pending,i.pending===i.pending_buf_size));)X(i,i.gzhead.extra[i.gzindex]&255),i.gzindex++;i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=gr)}else i.status=gr;if(i.status===gr)if(i.gzhead.name){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),gt(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}i.gzindex<i.gzhead.name.length?r=i.gzhead.name.charCodeAt(i.gzindex++)&255:r=0,X(i,r)}while(r!==0);i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),r===0&&(i.gzindex=0,i.status=mr)}else i.status=mr;if(i.status===mr)if(i.gzhead.comment){n=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),gt(t),n=i.pending,i.pending===i.pending_buf_size)){r=1;break}i.gzindex<i.gzhead.comment.length?r=i.gzhead.comment.charCodeAt(i.gzindex++)&255:r=0,X(i,r)}while(r!==0);i.gzhead.hcrc&&i.pending>n&&(t.adler=ct(t.adler,i.pending_buf,i.pending-n,n)),r===0&&(i.status=br)}else i.status=br;if(i.status===br&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&gt(t),i.pending+2<=i.pending_buf_size&&(X(i,t.adler&255),X(i,t.adler>>8&255),t.adler=0,i.status=Ct)):i.status=Ct),i.pending!==0){if(gt(t),t.avail_out===0)return i.last_flush=-1,Fe}else if(t.avail_in===0&&la(e)<=la(s)&&e!==ft)return ht(t,$i);if(i.status===Cn&&t.avail_in!==0)return ht(t,$i);if(t.avail_in!==0||i.lookahead!==0||e!==At&&i.status!==Cn){let a=i.strategy===hr?yd(i,e):i.strategy===ed?_d(i,e):kn[i.level].func(i,e);if((a===Rt||a===qt)&&(i.status=Cn),a===le||a===Rt)return t.avail_out===0&&(i.last_flush=-1),Fe;if(a===Rn&&(e===Yh?Gh(i):e!==oa&&(Zh(i,0,0,!1),e===Wh&&(dt(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),gt(t),t.avail_out===0))return i.last_flush=-1,Fe}return e!==ft?Fe:i.wrap<=0?aa:(i.wrap===2?(X(i,t.adler&255),X(i,t.adler>>8&255),X(i,t.adler>>16&255),X(i,t.adler>>24&255),X(i,t.total_in&255),X(i,t.total_in>>8&255),X(i,t.total_in>>16&255),X(i,t.total_in>>24&255)):(Tn(i,t.adler>>>16),Tn(i,t.adler&65535)),gt(t),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?Fe:aa)},Od=t=>{if(!t||!t.state)return Re;const e=t.state.status;return e!==pr&&e!==ji&&e!==gr&&e!==mr&&e!==br&&e!==Ct&&e!==Cn?ht(t,Re):(t.state=null,e===Ct?ht(t,Jh):Fe)},Ad=(t,e)=>{let n=e.length;if(!t||!t.state)return Re;const r=t.state,i=r.wrap;if(i===2||i===1&&r.status!==pr||r.lookahead)return Re;if(i===1&&(t.adler=sa(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){i===0&&(dt(r.head),r.strstart=0,r.block_start=0,r.insert=0);let c=new Uint8Array(r.w_size);c.set(e.subarray(n-r.w_size,n),0),e=c,n=r.w_size}const s=t.avail_in,a=t.next_in,o=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,Tt(r);r.lookahead>=G;){let c=r.strstart,l=r.lookahead-(G-1);do r.ins_h=pt(r,r.ins_h,r.window[c+G-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++;while(--l);r.strstart=c,r.lookahead=G-1,Tt(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=G-1,r.match_available=0,t.next_in=a,t.input=o,t.avail_in=s,r.wrap=i,Fe};Pe.deflateInit=Id;Pe.deflateInit2=ha;Pe.deflateReset=ua;Pe.deflateResetKeep=fa;Pe.deflateSetHeader=xd;Pe.deflate=Ed;Pe.deflateEnd=Od;Pe.deflateSetDictionary=Ad;Pe.deflateInfo="pako deflate (from Nodeca project)";var _r={};const Cd=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);_r.assign=function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(!!n){if(typeof n!="object")throw new TypeError(n+"must be non-object");for(const r in n)Cd(n,r)&&(t[r]=n[r])}}return t};_r.flattenChunks=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let a=t[r];n.set(a,i),i+=a.length}return n};var Sn={};let da=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){da=!1}const Nn=new Uint8Array(256);for(let t=0;t<256;t++)Nn[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Nn[254]=Nn[254]=1;Sn.string2buf=t=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(t);let e,n,r,i,s,a=t.length,o=0;for(i=0;i<a;i++)n=t.charCodeAt(i),(n&64512)==55296&&i+1<a&&(r=t.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(o),s=0,i=0;s<o;i++)n=t.charCodeAt(i),(n&64512)==55296&&i+1<a&&(r=t.charCodeAt(i+1),(r&64512)==56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};const Rd=(t,e)=>{if(e<65534&&t.subarray&&da)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};Sn.buf2string=(t,e)=>{const n=e||t.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(t.subarray(0,e));let r,i;const s=new Array(n*2);for(i=0,r=0;r<n;){let a=t[r++];if(a<128){s[i++]=a;continue}let o=Nn[a];if(o>4){s[i++]=65533,r+=o-1;continue}for(a&=o===2?31:o===3?15:7;o>1&&r<n;)a=a<<6|t[r++]&63,o--;if(o>1){s[i++]=65533;continue}a<65536?s[i++]=a:(a-=65536,s[i++]=55296|a>>10&1023,s[i++]=56320|a&1023)}return Rd(s,i)};Sn.utf8border=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;for(;n>=0&&(t[n]&192)==128;)n--;return n<0||n===0?e:n+Nn[t[n]]>e?n:e};function Td(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var pa=Td;const $n=Pe,ga=_r,ma=Sn,Li=Ni,kd=pa,ba=Object.prototype.toString,{Z_NO_FLUSH:Sd,Z_SYNC_FLUSH:Nd,Z_FULL_FLUSH:$d,Z_FINISH:Dd,Z_OK:yr,Z_STREAM_END:jd,Z_DEFAULT_COMPRESSION:Bd,Z_DEFAULT_STRATEGY:Ld,Z_DEFLATED:Vd}=Ot;function Dn(t){this.options=ga.assign({level:Bd,method:Vd,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ld},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kd,this.strm.avail_out=0;let n=$n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==yr)throw new Error(Li[n]);if(e.header&&$n.deflateSetHeader(this.strm,e.header),e.dictionary){let r;if(typeof e.dictionary=="string"?r=ma.string2buf(e.dictionary):ba.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=$n.deflateSetDictionary(this.strm,r),n!==yr)throw new Error(Li[n]);this._dict_set=!0}}Dn.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(e===~~e?s=e:s=e===!0?Dd:Sd,typeof t=="string"?n.input=ma.string2buf(t):ba.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){if(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===Nd||s===$d)&&n.avail_out<=6){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(i=$n.deflate(n,s),i===jd)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=$n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===yr;if(n.avail_out===0){this.onData(n.output);continue}if(s>0&&n.next_out>0){this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;continue}if(n.avail_in===0)break}return!0};Dn.prototype.onData=function(t){this.chunks.push(t)};Dn.prototype.onEnd=function(t){t===yr&&(this.result=ga.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Vi(t,e){const n=new Dn(e);if(n.push(t,!0),n.err)throw n.msg||Li[n.err];return n.result}function Ud(t,e){return e=e||{},e.raw=!0,Vi(t,e)}function Md(t,e){return e=e||{},e.gzip=!0,Vi(t,e)}Ht.Deflate=Dn;Ht.deflate=Vi;Ht.deflateRaw=Ud;Ht.gzip=Md;Ht.constants=Ot;var Kt={},Se={};const wr=30,Pd=12;var Hd=function(e,n){let r,i,s,a,o,c,l,f,d,p,u,b,O,E,v,k,A,I,y,S,C,N,$,j;const R=e.state;r=e.next_in,$=e.input,i=r+(e.avail_in-5),s=e.next_out,j=e.output,a=s-(n-e.avail_out),o=s+(e.avail_out-257),c=R.dmax,l=R.wsize,f=R.whave,d=R.wnext,p=R.window,u=R.hold,b=R.bits,O=R.lencode,E=R.distcode,v=(1<<R.lenbits)-1,k=(1<<R.distbits)-1;e:do{b<15&&(u+=$[r++]<<b,b+=8,u+=$[r++]<<b,b+=8),A=O[u&v];t:for(;;){if(I=A>>>24,u>>>=I,b-=I,I=A>>>16&255,I===0)j[s++]=A&65535;else if(I&16){y=A&65535,I&=15,I&&(b<I&&(u+=$[r++]<<b,b+=8),y+=u&(1<<I)-1,u>>>=I,b-=I),b<15&&(u+=$[r++]<<b,b+=8,u+=$[r++]<<b,b+=8),A=E[u&k];n:for(;;){if(I=A>>>24,u>>>=I,b-=I,I=A>>>16&255,I&16){if(S=A&65535,I&=15,b<I&&(u+=$[r++]<<b,b+=8,b<I&&(u+=$[r++]<<b,b+=8)),S+=u&(1<<I)-1,S>c){e.msg="invalid distance too far back",R.mode=wr;break e}if(u>>>=I,b-=I,I=s-a,S>I){if(I=S-I,I>f&&R.sane){e.msg="invalid distance too far back",R.mode=wr;break e}if(C=0,N=p,d===0){if(C+=l-I,I<y){y-=I;do j[s++]=p[C++];while(--I);C=s-S,N=j}}else if(d<I){if(C+=l+d-I,I-=d,I<y){y-=I;do j[s++]=p[C++];while(--I);if(C=0,d<y){I=d,y-=I;do j[s++]=p[C++];while(--I);C=s-S,N=j}}}else if(C+=d-I,I<y){y-=I;do j[s++]=p[C++];while(--I);C=s-S,N=j}for(;y>2;)j[s++]=N[C++],j[s++]=N[C++],j[s++]=N[C++],y-=3;y&&(j[s++]=N[C++],y>1&&(j[s++]=N[C++]))}else{C=s-S;do j[s++]=j[C++],j[s++]=j[C++],j[s++]=j[C++],y-=3;while(y>2);y&&(j[s++]=j[C++],y>1&&(j[s++]=j[C++]))}}else if((I&64)==0){A=E[(A&65535)+(u&(1<<I)-1)];continue n}else{e.msg="invalid distance code",R.mode=wr;break e}break}}else if((I&64)==0){A=O[(A&65535)+(u&(1<<I)-1)];continue t}else if(I&32){R.mode=Pd;break e}else{e.msg="invalid literal/length code",R.mode=wr;break e}break}}while(r<i&&s<o);y=b>>3,r-=y,b-=y<<3,u&=(1<<b)-1,e.next_in=r,e.next_out=s,e.avail_in=r<i?5+(i-r):5-(r-i),e.avail_out=s<o?257+(o-s):257-(s-o),R.hold=u,R.bits=b};const Yt=15,_a=852,ya=592,wa=0,Ui=1,va=2,Fd=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),zd=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Zd=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),qd=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Gd=(t,e,n,r,i,s,a,o)=>{const c=o.bits;let l=0,f=0,d=0,p=0,u=0,b=0,O=0,E=0,v=0,k=0,A,I,y,S,C,N=null,$=0,j;const R=new Uint16Array(Yt+1),M=new Uint16Array(Yt+1);let P=null,U=0,F,z,J;for(l=0;l<=Yt;l++)R[l]=0;for(f=0;f<r;f++)R[e[n+f]]++;for(u=c,p=Yt;p>=1&&R[p]===0;p--);if(u>p&&(u=p),p===0)return i[s++]=1<<24|64<<16|0,i[s++]=1<<24|64<<16|0,o.bits=1,0;for(d=1;d<p&&R[d]===0;d++);for(u<d&&(u=d),E=1,l=1;l<=Yt;l++)if(E<<=1,E-=R[l],E<0)return-1;if(E>0&&(t===wa||p!==1))return-1;for(M[1]=0,l=1;l<Yt;l++)M[l+1]=M[l]+R[l];for(f=0;f<r;f++)e[n+f]!==0&&(a[M[e[n+f]]++]=f);if(t===wa?(N=P=a,j=19):t===Ui?(N=Fd,$-=257,P=zd,U-=257,j=256):(N=Zd,P=qd,j=-1),k=0,f=0,l=d,C=s,b=u,O=0,y=-1,v=1<<u,S=v-1,t===Ui&&v>_a||t===va&&v>ya)return 1;for(;;){F=l-O,a[f]<j?(z=0,J=a[f]):a[f]>j?(z=P[U+a[f]],J=N[$+a[f]]):(z=32+64,J=0),A=1<<l-O,I=1<<b,d=I;do I-=A,i[C+(k>>O)+I]=F<<24|z<<16|J|0;while(I!==0);for(A=1<<l-1;k&A;)A>>=1;if(A!==0?(k&=A-1,k+=A):k=0,f++,--R[l]==0){if(l===p)break;l=e[n+a[f]]}if(l>u&&(k&S)!==y){for(O===0&&(O=u),C+=d,b=l-O,E=1<<b;b+O<p&&(E-=R[b+O],!(E<=0));)b++,E<<=1;if(v+=1<<b,t===Ui&&v>_a||t===va&&v>ya)return 1;y=k&S,i[y]=u<<24|b<<16|C-s|0}}return k!==0&&(i[C+k]=l-O<<24|64<<16|0),o.bits=u,0};var Kd=Gd;const Mi=ra,Ze=ia,Yd=Hd,jn=Kd,Wd=0,xa=1,Ia=2,{Z_FINISH:Ea,Z_BLOCK:Jd,Z_TREES:vr,Z_OK:kt,Z_STREAM_END:Xd,Z_NEED_DICT:Qd,Z_STREAM_ERROR:Te,Z_DATA_ERROR:Oa,Z_MEM_ERROR:Aa,Z_BUF_ERROR:ep,Z_DEFLATED:Ca}=Ot,Ra=1,Ta=2,ka=3,Sa=4,Na=5,$a=6,Da=7,ja=8,Ba=9,La=10,xr=11,We=12,Pi=13,Va=14,Hi=15,Ua=16,Ma=17,Pa=18,Ha=19,Ir=20,Er=21,Fa=22,za=23,Za=24,qa=25,Ga=26,Fi=27,Ka=28,Ya=29,se=30,Wa=31,tp=32,np=852,rp=592,ip=15,sp=ip,Ja=t=>(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24);function op(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Xa=t=>{if(!t||!t.state)return Te;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=Ra,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(np),e.distcode=e.distdyn=new Int32Array(rp),e.sane=1,e.back=-1,kt},Qa=t=>{if(!t||!t.state)return Te;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,Xa(t)},el=(t,e)=>{let n;if(!t||!t.state)return Te;const r=t.state;return e<0?(n=0,e=-e):(n=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15)?Te:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,Qa(t))},tl=(t,e)=>{if(!t)return Te;const n=new op;t.state=n,n.window=null;const r=el(t,e);return r!==kt&&(t.state=null),r},ap=t=>tl(t,sp);let nl=!0,zi,Zi;const lp=t=>{if(nl){zi=new Int32Array(512),Zi=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(jn(xa,t.lens,0,288,zi,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;jn(Ia,t.lens,0,32,Zi,0,t.work,{bits:5}),nl=!1}t.lencode=zi,t.lenbits=9,t.distcode=Zi,t.distbits=5},rl=(t,e,n,r)=>{let i;const s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},cp=(t,e)=>{let n,r,i,s,a,o,c,l,f,d,p,u,b,O,E=0,v,k,A,I,y,S,C,N;const $=new Uint8Array(4);let j,R;const M=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return Te;n=t.state,n.mode===We&&(n.mode=Pi),a=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,o=t.avail_in,l=n.hold,f=n.bits,d=o,p=c,N=kt;e:for(;;)switch(n.mode){case Ra:if(n.wrap===0){n.mode=Pi;break}for(;f<16;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(n.wrap&2&&l===35615){n.check=0,$[0]=l&255,$[1]=l>>>8&255,n.check=Ze(n.check,$,2,0),l=0,f=0,n.mode=Ta;break}if(n.flags=0,n.head&&(n.head.done=!1),!(n.wrap&1)||(((l&255)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=se;break}if((l&15)!==Ca){t.msg="unknown compression method",n.mode=se;break}if(l>>>=4,f-=4,C=(l&15)+8,n.wbits===0)n.wbits=C;else if(C>n.wbits){t.msg="invalid window size",n.mode=se;break}n.dmax=1<<n.wbits,t.adler=n.check=1,n.mode=l&512?La:We,l=0,f=0;break;case Ta:for(;f<16;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(n.flags=l,(n.flags&255)!==Ca){t.msg="unknown compression method",n.mode=se;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=se;break}n.head&&(n.head.text=l>>8&1),n.flags&512&&($[0]=l&255,$[1]=l>>>8&255,n.check=Ze(n.check,$,2,0)),l=0,f=0,n.mode=ka;case ka:for(;f<32;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.head&&(n.head.time=l),n.flags&512&&($[0]=l&255,$[1]=l>>>8&255,$[2]=l>>>16&255,$[3]=l>>>24&255,n.check=Ze(n.check,$,4,0)),l=0,f=0,n.mode=Sa;case Sa:for(;f<16;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.head&&(n.head.xflags=l&255,n.head.os=l>>8),n.flags&512&&($[0]=l&255,$[1]=l>>>8&255,n.check=Ze(n.check,$,2,0)),l=0,f=0,n.mode=Na;case Na:if(n.flags&1024){for(;f<16;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.length=l,n.head&&(n.head.extra_len=l),n.flags&512&&($[0]=l&255,$[1]=l>>>8&255,n.check=Ze(n.check,$,2,0)),l=0,f=0}else n.head&&(n.head.extra=null);n.mode=$a;case $a:if(n.flags&1024&&(u=n.length,u>o&&(u=o),u&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+u),C)),n.flags&512&&(n.check=Ze(n.check,r,u,s)),o-=u,s+=u,n.length-=u),n.length))break e;n.length=0,n.mode=Da;case Da:if(n.flags&2048){if(o===0)break e;u=0;do C=r[s+u++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C));while(C&&u<o);if(n.flags&512&&(n.check=Ze(n.check,r,u,s)),o-=u,s+=u,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=ja;case ja:if(n.flags&4096){if(o===0)break e;u=0;do C=r[s+u++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C));while(C&&u<o);if(n.flags&512&&(n.check=Ze(n.check,r,u,s)),o-=u,s+=u,C)break e}else n.head&&(n.head.comment=null);n.mode=Ba;case Ba:if(n.flags&512){for(;f<16;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(l!==(n.check&65535)){t.msg="header crc mismatch",n.mode=se;break}l=0,f=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=We;break;case La:for(;f<32;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}t.adler=n.check=Ja(l),l=0,f=0,n.mode=xr;case xr:if(n.havedict===0)return t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=o,n.hold=l,n.bits=f,Qd;t.adler=n.check=1,n.mode=We;case We:if(e===Jd||e===vr)break e;case Pi:if(n.last){l>>>=f&7,f-=f&7,n.mode=Fi;break}for(;f<3;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}switch(n.last=l&1,l>>>=1,f-=1,l&3){case 0:n.mode=Va;break;case 1:if(lp(n),n.mode=Ir,e===vr){l>>>=2,f-=2;break e}break;case 2:n.mode=Ma;break;case 3:t.msg="invalid block type",n.mode=se}l>>>=2,f-=2;break;case Va:for(l>>>=f&7,f-=f&7;f<32;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if((l&65535)!=(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=se;break}if(n.length=l&65535,l=0,f=0,n.mode=Hi,e===vr)break e;case Hi:n.mode=Ua;case Ua:if(u=n.length,u){if(u>o&&(u=o),u>c&&(u=c),u===0)break e;i.set(r.subarray(s,s+u),a),o-=u,s+=u,c-=u,a+=u,n.length-=u;break}n.mode=We;break;case Ma:for(;f<14;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(n.nlen=(l&31)+257,l>>>=5,f-=5,n.ndist=(l&31)+1,l>>>=5,f-=5,n.ncode=(l&15)+4,l>>>=4,f-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=se;break}n.have=0,n.mode=Pa;case Pa:for(;n.have<n.ncode;){for(;f<3;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.lens[M[n.have++]]=l&7,l>>>=3,f-=3}for(;n.have<19;)n.lens[M[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,j={bits:n.lenbits},N=jn(Wd,n.lens,0,19,n.lencode,0,n.work,j),n.lenbits=j.bits,N){t.msg="invalid code lengths set",n.mode=se;break}n.have=0,n.mode=Ha;case Ha:for(;n.have<n.nlen+n.ndist;){for(;E=n.lencode[l&(1<<n.lenbits)-1],v=E>>>24,k=E>>>16&255,A=E&65535,!(v<=f);){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(A<16)l>>>=v,f-=v,n.lens[n.have++]=A;else{if(A===16){for(R=v+2;f<R;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(l>>>=v,f-=v,n.have===0){t.msg="invalid bit length repeat",n.mode=se;break}C=n.lens[n.have-1],u=3+(l&3),l>>>=2,f-=2}else if(A===17){for(R=v+3;f<R;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}l>>>=v,f-=v,C=0,u=3+(l&7),l>>>=3,f-=3}else{for(R=v+7;f<R;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}l>>>=v,f-=v,C=0,u=11+(l&127),l>>>=7,f-=7}if(n.have+u>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=se;break}for(;u--;)n.lens[n.have++]=C}}if(n.mode===se)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=se;break}if(n.lenbits=9,j={bits:n.lenbits},N=jn(xa,n.lens,0,n.nlen,n.lencode,0,n.work,j),n.lenbits=j.bits,N){t.msg="invalid literal/lengths set",n.mode=se;break}if(n.distbits=6,n.distcode=n.distdyn,j={bits:n.distbits},N=jn(Ia,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,j),n.distbits=j.bits,N){t.msg="invalid distances set",n.mode=se;break}if(n.mode=Ir,e===vr)break e;case Ir:n.mode=Er;case Er:if(o>=6&&c>=258){t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=o,n.hold=l,n.bits=f,Yd(t,p),a=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,o=t.avail_in,l=n.hold,f=n.bits,n.mode===We&&(n.back=-1);break}for(n.back=0;E=n.lencode[l&(1<<n.lenbits)-1],v=E>>>24,k=E>>>16&255,A=E&65535,!(v<=f);){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(k&&(k&240)==0){for(I=v,y=k,S=A;E=n.lencode[S+((l&(1<<I+y)-1)>>I)],v=E>>>24,k=E>>>16&255,A=E&65535,!(I+v<=f);){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}l>>>=I,f-=I,n.back+=I}if(l>>>=v,f-=v,n.back+=v,n.length=A,k===0){n.mode=Ga;break}if(k&32){n.back=-1,n.mode=We;break}if(k&64){t.msg="invalid literal/length code",n.mode=se;break}n.extra=k&15,n.mode=Fa;case Fa:if(n.extra){for(R=n.extra;f<R;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,f-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=za;case za:for(;E=n.distcode[l&(1<<n.distbits)-1],v=E>>>24,k=E>>>16&255,A=E&65535,!(v<=f);){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if((k&240)==0){for(I=v,y=k,S=A;E=n.distcode[S+((l&(1<<I+y)-1)>>I)],v=E>>>24,k=E>>>16&255,A=E&65535,!(I+v<=f);){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}l>>>=I,f-=I,n.back+=I}if(l>>>=v,f-=v,n.back+=v,k&64){t.msg="invalid distance code",n.mode=se;break}n.offset=A,n.extra=k&15,n.mode=Za;case Za:if(n.extra){for(R=n.extra;f<R;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,f-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=se;break}n.mode=qa;case qa:if(c===0)break e;if(u=p-c,n.offset>u){if(u=n.offset-u,u>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=se;break}u>n.wnext?(u-=n.wnext,b=n.wsize-u):b=n.wnext-u,u>n.length&&(u=n.length),O=n.window}else O=i,b=a-n.offset,u=n.length;u>c&&(u=c),c-=u,n.length-=u;do i[a++]=O[b++];while(--u);n.length===0&&(n.mode=Er);break;case Ga:if(c===0)break e;i[a++]=n.length,c--,n.mode=Er;break;case Fi:if(n.wrap){for(;f<32;){if(o===0)break e;o--,l|=r[s++]<<f,f+=8}if(p-=c,t.total_out+=p,n.total+=p,p&&(t.adler=n.check=n.flags?Ze(n.check,i,p,a-p):Mi(n.check,i,p,a-p)),p=c,(n.flags?l:Ja(l))!==n.check){t.msg="incorrect data check",n.mode=se;break}l=0,f=0}n.mode=Ka;case Ka:if(n.wrap&&n.flags){for(;f<32;){if(o===0)break e;o--,l+=r[s++]<<f,f+=8}if(l!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=se;break}l=0,f=0}n.mode=Ya;case Ya:N=Xd;break e;case se:N=Oa;break e;case Wa:return Aa;case tp:default:return Te}return t.next_out=a,t.avail_out=c,t.next_in=s,t.avail_in=o,n.hold=l,n.bits=f,(n.wsize||p!==t.avail_out&&n.mode<se&&(n.mode<Fi||e!==Ea))&&rl(t,t.output,t.next_out,p-t.avail_out),d-=t.avail_in,p-=t.avail_out,t.total_in+=d,t.total_out+=p,n.total+=p,n.wrap&&p&&(t.adler=n.check=n.flags?Ze(n.check,i,p,t.next_out-p):Mi(n.check,i,p,t.next_out-p)),t.data_type=n.bits+(n.last?64:0)+(n.mode===We?128:0)+(n.mode===Ir||n.mode===Hi?256:0),(d===0&&p===0||e===Ea)&&N===kt&&(N=ep),N},fp=t=>{if(!t||!t.state)return Te;let e=t.state;return e.window&&(e.window=null),t.state=null,kt},up=(t,e)=>{if(!t||!t.state)return Te;const n=t.state;return(n.wrap&2)==0?Te:(n.head=e,e.done=!1,kt)},hp=(t,e)=>{const n=e.length;let r,i,s;return!t||!t.state||(r=t.state,r.wrap!==0&&r.mode!==xr)?Te:r.mode===xr&&(i=1,i=Mi(i,e,n,0),i!==r.check)?Oa:(s=rl(t,e,n,n),s?(r.mode=Wa,Aa):(r.havedict=1,kt))};Se.inflateReset=Qa;Se.inflateReset2=el;Se.inflateResetKeep=Xa;Se.inflateInit=ap;Se.inflateInit2=tl;Se.inflate=cp;Se.inflateEnd=fp;Se.inflateGetHeader=up;Se.inflateSetDictionary=hp;Se.inflateInfo="pako inflate (from Nodeca project)";function dp(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var pp=dp;const Je=Se,il=_r,qi=Sn,Gi=Ni,gp=pa,mp=pp,sl=Object.prototype.toString,{Z_NO_FLUSH:bp,Z_FINISH:_p,Z_OK:Bn,Z_STREAM_END:Ki,Z_NEED_DICT:Yi,Z_STREAM_ERROR:yp,Z_DATA_ERROR:ol,Z_MEM_ERROR:wp}=Ot;function Ln(t){this.options=il.assign({chunkSize:1024*64,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15)==0&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new gp,this.strm.avail_out=0;let n=Je.inflateInit2(this.strm,e.windowBits);if(n!==Bn)throw new Error(Gi[n]);if(this.header=new mp,Je.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=qi.string2buf(e.dictionary):sl.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Je.inflateSetDictionary(this.strm,e.dictionary),n!==Bn)))throw new Error(Gi[n])}Ln.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,a,o;if(this.ended)return!1;for(e===~~e?a=e:a=e===!0?_p:bp,sl.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(n.avail_out===0&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=Je.inflate(n,a),s===Yi&&i&&(s=Je.inflateSetDictionary(n,i),s===Bn?s=Je.inflate(n,a):s===ol&&(s=Yi));n.avail_in>0&&s===Ki&&n.state.wrap>0&&t[n.next_in]!==0;)Je.inflateReset(n),s=Je.inflate(n,a);switch(s){case yp:case ol:case Yi:case wp:return this.onEnd(s),this.ended=!0,!1}if(o=n.avail_out,n.next_out&&(n.avail_out===0||s===Ki))if(this.options.to==="string"){let c=qi.utf8border(n.output,n.next_out),l=n.next_out-c,f=qi.buf2string(n.output,c);n.next_out=l,n.avail_out=r-l,l&&n.output.set(n.output.subarray(c,c+l),0),this.onData(f)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(!(s===Bn&&o===0)){if(s===Ki)return s=Je.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(n.avail_in===0)break}}return!0};Ln.prototype.onData=function(t){this.chunks.push(t)};Ln.prototype.onEnd=function(t){t===Bn&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=il.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function Wi(t,e){const n=new Ln(e);if(n.push(t),n.err)throw n.msg||Gi[n.err];return n.result}function vp(t,e){return e=e||{},e.raw=!0,Wi(t,e)}Kt.Inflate=Ln;Kt.inflate=Wi;Kt.inflateRaw=vp;Kt.ungzip=Wi;Kt.constants=Ot;const{Deflate:xp,deflate:Ip,deflateRaw:Ep,gzip:Op}=Ht,{Inflate:Ap,inflate:Cp,inflateRaw:Rp,ungzip:Tp}=Kt,kp=Ot;Me.Deflate=xp;Me.deflate=Ip;Me.deflateRaw=Ep;Me.gzip=Op;Me.Inflate=Ap;Me.inflate=Cp;Me.inflateRaw=Rp;Me.ungzip=Tp;Me.constants=kp;const Sp=new TextEncoder,Np=new TextDecoder("utf-8");function Ji(t){return Sp.encode(t)}function Xi(t){return Np.decode(t)}function al(t){if(typeof t!="string")throw new TypeError("value is not a string");if(!/^([0-9a-f][0-9a-f])*$/.test(t))throw new RangeError("value is not hexadecimal");return t===""?new Uint8Array(0):new Uint8Array(t.match(/../g).map(e=>parseInt(e,16)))}const ll=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],cl=new Array(256);for(let t=0;t<256;t++)cl[t]=`${ll[t>>>4&15]}${ll[t&15]}`;function fl(t){let e="",n=t.byteLength;for(let r=0;r<n;r++)e+=cl[t[r]];return e}class Qi{constructor(){this.buf=new Uint8Array(16),this.offset=0}get buffer(){return this.finish(),this.buf.subarray(0,this.offset)}grow(e=0){let n=this.buf.byteLength*4;for(;n<e;)n*=2;const r=new Uint8Array(n);return r.set(this.buf,0),this.buf=r,this}appendByte(e){this.offset>=this.buf.byteLength&&this.grow(),this.buf[this.offset]=e,this.offset+=1}appendUint32(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<0||e>4294967295)throw new RangeError("number out of range");const n=Math.max(1,Math.ceil((32-Math.clz32(e))/7));this.offset+n>this.buf.byteLength&&this.grow();for(let r=0;r<n;r++)this.buf[this.offset+r]=e&127|(r===n-1?0:128),e>>>=7;return this.offset+=n,n}appendInt32(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<-2147483648||e>2147483647)throw new RangeError("number out of range");const n=Math.ceil((33-Math.clz32(e>=0?e:-e-1))/7);this.offset+n>this.buf.byteLength&&this.grow();for(let r=0;r<n;r++)this.buf[this.offset+r]=e&127|(r===n-1?0:128),e>>=7;return this.offset+=n,n}appendUint53(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<0||e>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");const n=Math.floor(e/4294967296),r=(e&4294967295)>>>0;return this.appendUint64(n,r)}appendInt53(e){if(!Number.isInteger(e))throw new RangeError("value is not an integer");if(e<Number.MIN_SAFE_INTEGER||e>Number.MAX_SAFE_INTEGER)throw new RangeError("number out of range");const n=Math.floor(e/4294967296),r=(e&4294967295)>>>0;return this.appendInt64(n,r)}appendUint64(e,n){if(!Number.isInteger(e)||!Number.isInteger(n))throw new RangeError("value is not an integer");if(e<0||e>4294967295||n<0||n>4294967295)throw new RangeError("number out of range");if(e===0)return this.appendUint32(n);const r=Math.ceil((64-Math.clz32(e))/7);this.offset+r>this.buf.byteLength&&this.grow();for(let i=0;i<4;i++)this.buf[this.offset+i]=n&127|128,n>>>=7;this.buf[this.offset+4]=n&15|(e&7)<<4|(r===5?0:128),e>>>=3;for(let i=5;i<r;i++)this.buf[this.offset+i]=e&127|(i===r-1?0:128),e>>>=7;return this.offset+=r,r}appendInt64(e,n){if(!Number.isInteger(e)||!Number.isInteger(n))throw new RangeError("value is not an integer");if(e<-2147483648||e>2147483647||n<-2147483648||n>4294967295)throw new RangeError("number out of range");if(n>>>=0,e===0&&n<=2147483647)return this.appendInt32(n);if(e===-1&&n>=2147483648)return this.appendInt32(n-4294967296);const r=Math.ceil((65-Math.clz32(e>=0?e:-e-1))/7);this.offset+r>this.buf.byteLength&&this.grow();for(let i=0;i<4;i++)this.buf[this.offset+i]=n&127|128,n>>>=7;this.buf[this.offset+4]=n&15|(e&7)<<4|(r===5?0:128),e>>=3;for(let i=5;i<r;i++)this.buf[this.offset+i]=e&127|(i===r-1?0:128),e>>=7;return this.offset+=r,r}appendRawBytes(e){return this.offset+e.byteLength>this.buf.byteLength&&this.grow(this.offset+e.byteLength),this.buf.set(e,this.offset),this.offset+=e.byteLength,e.byteLength}appendRawString(e){if(typeof e!="string")throw new TypeError("value is not a string");return this.appendRawBytes(Ji(e))}appendPrefixedBytes(e){return this.appendUint53(e.byteLength),this.appendRawBytes(e),this}appendPrefixedString(e){if(typeof e!="string")throw new TypeError("value is not a string");return this.appendPrefixedBytes(Ji(e)),this}appendHexString(e){return this.appendPrefixedBytes(al(e)),this}finish(){}}class es{constructor(e){if(!(e instanceof Uint8Array))throw new TypeError(`Not a byte array: ${e}`);this.buf=e,this.offset=0}get done(){return this.offset===this.buf.byteLength}reset(){this.offset=0}skip(e){if(this.offset+e>this.buf.byteLength)throw new RangeError("cannot skip beyond end of buffer");this.offset+=e}readByte(){return this.offset+=1,this.buf[this.offset-1]}readUint32(){let e=0,n=0;for(;this.offset<this.buf.byteLength;){const r=this.buf[this.offset];if(n===28&&(r&240)!=0)throw new RangeError("number out of range");if(e=(e|(r&127)<<n)>>>0,n+=7,this.offset++,(r&128)==0)return e}throw new RangeError("buffer ended with incomplete number")}readInt32(){let e=0,n=0;for(;this.offset<this.buf.byteLength;){const r=this.buf[this.offset];if(n===28&&(r&128)!=0||n===28&&(r&64)==0&&(r&56)!=0||n===28&&(r&64)!=0&&(r&56)!=56)throw new RangeError("number out of range");if(e|=(r&127)<<n,n+=7,this.offset++,(r&128)==0)return(r&64)==0||n>28?e:e|-1<<n}throw new RangeError("buffer ended with incomplete number")}readUint53(){const{low32:e,high32:n}=this.readUint64();if(n<0||n>2097151)throw new RangeError("number out of range");return n*4294967296+e}readInt53(){const{low32:e,high32:n}=this.readInt64();if(n<-2097152||n===-2097152&&e===0||n>2097151)throw new RangeError("number out of range");return n*4294967296+e}readUint64(){let e=0,n=0,r=0;for(;this.offset<this.buf.byteLength&&r<=28;){const i=this.buf[this.offset];if(e=(e|(i&127)<<r)>>>0,r===28&&(n=(i&112)>>>4),r+=7,this.offset++,(i&128)==0)return{high32:n,low32:e}}for(r=3;this.offset<this.buf.byteLength;){const i=this.buf[this.offset];if(r===31&&(i&254)!=0)throw new RangeError("number out of range");if(n=(n|(i&127)<<r)>>>0,r+=7,this.offset++,(i&128)==0)return{high32:n,low32:e}}throw new RangeError("buffer ended with incomplete number")}readInt64(){let e=0,n=0,r=0;for(;this.offset<this.buf.byteLength&&r<=28;){const i=this.buf[this.offset];if(e=(e|(i&127)<<r)>>>0,r===28&&(n=(i&112)>>>4),r+=7,this.offset++,(i&128)==0)return(i&64)!=0&&(r<32&&(e=(e|-1<<r)>>>0),n|=-1<<Math.max(r-32,0)),{high32:n,low32:e}}for(r=3;this.offset<this.buf.byteLength;){const i=this.buf[this.offset];if(r===31&&i!==0&&i!==127)throw new RangeError("number out of range");if(n|=(i&127)<<r,r+=7,this.offset++,(i&128)==0)return(i&64)!=0&&r<32&&(n|=-1<<r),{high32:n,low32:e}}throw new RangeError("buffer ended with incomplete number")}readRawBytes(e){const n=this.offset;if(n+e>this.buf.byteLength)throw new RangeError("subarray exceeds buffer size");return this.offset+=e,this.buf.subarray(n,this.offset)}readRawString(e){return Xi(this.readRawBytes(e))}readPrefixedBytes(){return this.readRawBytes(this.readUint53())}readPrefixedString(){return Xi(this.readPrefixedBytes())}readHexString(){return fl(this.readPrefixedBytes())}}class ul extends Qi{constructor(e){super();this.type=e,this.state="empty",this.lastValue=void 0,this.count=0,this.literal=[]}appendValue(e,n=1){this._appendValue(e,n)}_appendValue(e,n=1){n<=0||(this.state==="empty"?(this.state=e===null?"nulls":n===1?"loneValue":"repetition",this.lastValue=e,this.count=n):this.state==="loneValue"?e===null?(this.flush(),this.state="nulls",this.count=n):e===this.lastValue?(this.state="repetition",this.count=1+n):n>1?(this.flush(),this.state="repetition",this.count=n,this.lastValue=e):(this.state="literal",this.literal=[this.lastValue],this.lastValue=e):this.state==="repetition"?e===null?(this.flush(),this.state="nulls",this.count=n):e===this.lastValue?this.count+=n:n>1?(this.flush(),this.state="repetition",this.count=n,this.lastValue=e):(this.flush(),this.state="loneValue",this.lastValue=e):this.state==="literal"?e===null?(this.literal.push(this.lastValue),this.flush(),this.state="nulls",this.count=n):e===this.lastValue?(this.flush(),this.state="repetition",this.count=1+n):n>1?(this.literal.push(this.lastValue),this.flush(),this.state="repetition",this.count=n,this.lastValue=e):(this.literal.push(this.lastValue),this.lastValue=e):this.state==="nulls"&&(e===null?this.count+=n:n>1?(this.flush(),this.state="repetition",this.count=n,this.lastValue=e):(this.flush(),this.state="loneValue",this.lastValue=e)))}copyFrom(e,n={}){const{count:r,sumValues:i,sumShift:s}=n;if(!(e instanceof ts)||e.type!==this.type)throw new TypeError("incompatible type of decoder");let a=typeof r=="number"?r:Number.MAX_SAFE_INTEGER,o=0,c=0;if(r&&a>0&&e.done)throw new RangeError(`cannot copy ${r} values`);if(a===0||e.done)return i?{nonNullValues:o,sum:c}:{nonNullValues:o};let l=e.readValue();if(l===null){const d=Math.min(e.count+1,a);if(a-=d,e.count-=d-1,this.appendValue(null,d),r&&a>0&&e.done)throw new RangeError(`cannot copy ${r} values`);if(a===0||e.done)return i?{nonNullValues:o,sum:c}:{nonNullValues:o};if(l=e.readValue(),l===null)throw new RangeError("null run must be followed by non-null value")}if(this.appendValue(l),a--,o++,i&&(c+=s?l>>>s:l),r&&a>0&&e.done)throw new RangeError(`cannot copy ${r} values`);if(a===0||e.done)return i?{nonNullValues:o,sum:c}:{nonNullValues:o};let f=e.count>0;for(;a>0&&!e.done;){f||e.readRecord();const d=Math.min(e.count,a);if(e.count-=d,e.state==="literal"){o+=d;for(let p=0;p<d;p++){if(e.done)throw new RangeError("incomplete literal");const u=e.readRawValue();if(u===e.lastValue)throw new RangeError("Repetition of values is not allowed in literal");e.lastValue=u,this._appendValue(u),i&&(c+=s?u>>>s:u)}}else if(e.state==="repetition"){o+=d,i&&(c+=d*(s?e.lastValue>>>s:e.lastValue));const p=e.lastValue;if(this._appendValue(p),d>1){if(this._appendValue(p),this.state!=="repetition")throw new RangeError(`Unexpected state ${this.state}`);this.count+=d-2}}else if(e.state==="nulls"){if(this._appendValue(null),this.state!=="nulls")throw new RangeError(`Unexpected state ${this.state}`);this.count+=d-1}f=!1,a-=d}if(r&&a>0&&e.done)throw new RangeError(`cannot copy ${r} values`);return i?{nonNullValues:o,sum:c}:{nonNullValues:o}}flush(){if(this.state==="loneValue")this.appendInt32(-1),this.appendRawValue(this.lastValue);else if(this.state==="repetition")this.appendInt53(this.count),this.appendRawValue(this.lastValue);else if(this.state==="literal"){this.appendInt53(-this.literal.length);for(let e of this.literal)this.appendRawValue(e)}else this.state==="nulls"&&(this.appendInt32(0),this.appendUint53(this.count));this.state="empty"}appendRawValue(e){if(this.type==="int")this.appendInt53(e);else if(this.type==="uint")this.appendUint53(e);else if(this.type==="utf8")this.appendPrefixedString(e);else throw new RangeError(`Unknown RLEEncoder datatype: ${this.type}`)}finish(){this.state==="literal"&&this.literal.push(this.lastValue),(this.state!=="nulls"||this.offset>0)&&this.flush()}}class ts extends es{constructor(e,n){super(n);this.type=e,this.lastValue=void 0,this.count=0,this.state=void 0}get done(){return this.count===0&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0}readValue(){if(this.done)return null;if(this.count===0&&this.readRecord(),this.count-=1,this.state==="literal"){const e=this.readRawValue();if(e===this.lastValue)throw new RangeError("Repetition of values is not allowed in literal");return this.lastValue=e,e}else return this.lastValue}skipValues(e){for(;e>0&&!this.done;){this.count===0&&(this.count=this.readInt53(),this.count>0?(this.lastValue=this.count<=e?this.skipRawValues(1):this.readRawValue(),this.state="repetition"):this.count<0?(this.count=-this.count,this.state="literal"):(this.count=this.readUint53(),this.lastValue=null,this.state="nulls"));const n=Math.min(e,this.count);this.state==="literal"&&this.skipRawValues(n),e-=n,this.count-=n}}readRecord(){if(this.count=this.readInt53(),this.count>1){const e=this.readRawValue();if((this.state==="repetition"||this.state==="literal")&&this.lastValue===e)throw new RangeError("Successive repetitions with the same value are not allowed");this.state="repetition",this.lastValue=e}else{if(this.count===1)throw new RangeError("Repetition count of 1 is not allowed, use a literal instead");if(this.count<0){if(this.count=-this.count,this.state==="literal")throw new RangeError("Successive literals are not allowed");this.state="literal"}else{if(this.state==="nulls")throw new RangeError("Successive null runs are not allowed");if(this.count=this.readUint53(),this.count===0)throw new RangeError("Zero-length null runs are not allowed");this.lastValue=null,this.state="nulls"}}}readRawValue(){if(this.type==="int")return this.readInt53();if(this.type==="uint")return this.readUint53();if(this.type==="utf8")return this.readPrefixedString();throw new RangeError(`Unknown RLEDecoder datatype: ${this.type}`)}skipRawValues(e){if(this.type==="utf8")for(let n=0;n<e;n++)this.skip(this.readUint53());else{for(;e>0&&this.offset<this.buf.byteLength;)(this.buf[this.offset]&128)==0&&e--,this.offset++;if(e>0)throw new RangeError("cannot skip beyond end of buffer")}}}class $p extends ul{constructor(){super("int");this.absoluteValue=0}appendValue(e,n=1){n<=0||(typeof e=="number"?(super.appendValue(e-this.absoluteValue,1),this.absoluteValue=e,n>1&&super.appendValue(0,n-1)):super.appendValue(e,n))}copyFrom(e,n={}){if(n.sumValues)throw new RangeError("unsupported options for DeltaEncoder.copyFrom()");if(!(e instanceof hl))throw new TypeError("incompatible type of decoder");let r=n.count;if(r>0&&e.done)throw new RangeError(`cannot copy ${r} values`);if(r===0||e.done)return;let i=e.readValue(),s=0;if(this.appendValue(i),i===null){if(s=e.count+1,r!==void 0&&r<s&&(s=r),e.count-=s-1,this.count+=s-1,r>s&&e.done)throw new RangeError(`cannot copy ${r} values`);if(r===s||e.done)return;e.count===0&&this.appendValue(e.readValue())}r!==void 0&&(r-=s+1);const{nonNullValues:a,sum:o}=super.copyFrom(e,{count:r,sumValues:!0});a>0&&(this.absoluteValue=o,e.absoluteValue=o)}}class hl extends ts{constructor(e){super("int",e);this.absoluteValue=0}reset(){this.offset=0,this.lastValue=void 0,this.count=0,this.state=void 0,this.absoluteValue=0}readValue(){const e=super.readValue();return e===null?null:(this.absoluteValue+=e,this.absoluteValue)}skipValues(e){for(;e>0&&!this.done;){this.count===0&&this.readRecord();const n=Math.min(e,this.count);if(this.state==="literal")for(let r=0;r<n;r++)this.lastValue=this.readRawValue(),this.absoluteValue+=this.lastValue;else this.state==="repetition"&&(this.absoluteValue+=n*this.lastValue);e-=n,this.count-=n}}}class Dp extends Qi{constructor(){super();this.lastValue=!1,this.count=0}appendValue(e,n=1){if(e!==!1&&e!==!0)throw new RangeError(`Unsupported value for BooleanEncoder: ${e}`);n<=0||(this.lastValue===e?this.count+=n:(this.appendUint53(this.count),this.lastValue=e,this.count=n))}copyFrom(e,n={}){if(!(e instanceof dl))throw new TypeError("incompatible type of decoder");const{count:r}=n;let i=typeof r=="number"?r:Number.MAX_SAFE_INTEGER;if(r&&i>0&&e.done)throw new RangeError(`cannot copy ${r} values`);if(i===0||e.done)return;this.appendValue(e.readValue()),i--;const s=Math.min(e.count,i);for(this.count+=s,e.count-=s,i-=s;i>0&&!e.done;){if(e.count=e.readUint53(),e.count===0)throw new RangeError("Zero-length runs are not allowed");e.lastValue=!e.lastValue,this.appendUint53(this.count);const a=Math.min(e.count,i);this.count=a,this.lastValue=e.lastValue,e.count-=a,i-=a}if(r&&i>0&&e.done)throw new RangeError(`cannot copy ${r} values`)}finish(){this.count>0&&(this.appendUint53(this.count),this.count=0)}}class dl extends es{constructor(e){super(e);this.lastValue=!0,this.firstRun=!0,this.count=0}get done(){return this.count===0&&this.offset===this.buf.byteLength}reset(){this.offset=0,this.lastValue=!0,this.firstRun=!0,this.count=0}readValue(){if(this.done)return!1;for(;this.count===0;){if(this.count=this.readUint53(),this.lastValue=!this.lastValue,this.count===0&&!this.firstRun)throw new RangeError("Zero-length runs are not allowed");this.firstRun=!1}return this.count-=1,this.lastValue}skipValues(e){for(;e>0&&!this.done;){if(this.count===0&&(this.count=this.readUint53(),this.lastValue=!this.lastValue,this.count===0))throw new RangeError("Zero-length runs are not allowed");this.count<e?(e-=this.count,this.count=0):(this.count-=e,e=0)}}}var pl={stringToUtf8:Ji,utf8ToString:Xi,hexStringToBytes:al,bytesToHexString:fl,Encoder:Qi,Decoder:es,RLEEncoder:ul,RLEDecoder:ts,DeltaEncoder:$p,DeltaDecoder:hl,BooleanEncoder:Dp,BooleanDecoder:dl},gl={exports:{}};(function(t){(function(e,n){var r={};n(r);var i=r.default;for(var s in r)i[s]=r[s];t.exports=i})(dn,function(e){e.__esModule=!0,e.digestLength=32,e.blockSize=64;var n=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function r(p,u,b,O,E){for(var v,k,A,I,y,S,C,N,$,j,R,M,P;E>=64;){for(v=u[0],k=u[1],A=u[2],I=u[3],y=u[4],S=u[5],C=u[6],N=u[7],j=0;j<16;j++)R=O+j*4,p[j]=(b[R]&255)<<24|(b[R+1]&255)<<16|(b[R+2]&255)<<8|b[R+3]&255;for(j=16;j<64;j++)$=p[j-2],M=($>>>17|$<<32-17)^($>>>19|$<<32-19)^$>>>10,$=p[j-15],P=($>>>7|$<<32-7)^($>>>18|$<<32-18)^$>>>3,p[j]=(M+p[j-7]|0)+(P+p[j-16]|0);for(j=0;j<64;j++)M=(((y>>>6|y<<32-6)^(y>>>11|y<<32-11)^(y>>>25|y<<32-25))+(y&S^~y&C)|0)+(N+(n[j]+p[j]|0)|0)|0,P=((v>>>2|v<<32-2)^(v>>>13|v<<32-13)^(v>>>22|v<<32-22))+(v&k^v&A^k&A)|0,N=C,C=S,S=y,y=I+M|0,I=A,A=k,k=v,v=M+P|0;u[0]+=v,u[1]+=k,u[2]+=A,u[3]+=I,u[4]+=y,u[5]+=S,u[6]+=C,u[7]+=N,O+=64,E-=64}return O}var i=function(){function p(){this.digestLength=e.digestLength,this.blockSize=e.blockSize,this.state=new Int32Array(8),this.temp=new Int32Array(64),this.buffer=new Uint8Array(128),this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this.reset()}return p.prototype.reset=function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.bufferLength=0,this.bytesHashed=0,this.finished=!1,this},p.prototype.clean=function(){for(var u=0;u<this.buffer.length;u++)this.buffer[u]=0;for(var u=0;u<this.temp.length;u++)this.temp[u]=0;this.reset()},p.prototype.update=function(u,b){if(b===void 0&&(b=u.length),this.finished)throw new Error("SHA256: can't update because hash was finished.");var O=0;if(this.bytesHashed+=b,this.bufferLength>0){for(;this.bufferLength<64&&b>0;)this.buffer[this.bufferLength++]=u[O++],b--;this.bufferLength===64&&(r(this.temp,this.state,this.buffer,0,64),this.bufferLength=0)}for(b>=64&&(O=r(this.temp,this.state,u,O,b),b%=64);b>0;)this.buffer[this.bufferLength++]=u[O++],b--;return this},p.prototype.finish=function(u){if(!this.finished){var b=this.bytesHashed,O=this.bufferLength,E=b/536870912|0,v=b<<3,k=b%64<56?64:128;this.buffer[O]=128;for(var A=O+1;A<k-8;A++)this.buffer[A]=0;this.buffer[k-8]=E>>>24&255,this.buffer[k-7]=E>>>16&255,this.buffer[k-6]=E>>>8&255,this.buffer[k-5]=E>>>0&255,this.buffer[k-4]=v>>>24&255,this.buffer[k-3]=v>>>16&255,this.buffer[k-2]=v>>>8&255,this.buffer[k-1]=v>>>0&255,r(this.temp,this.state,this.buffer,0,k),this.finished=!0}for(var A=0;A<8;A++)u[A*4+0]=this.state[A]>>>24&255,u[A*4+1]=this.state[A]>>>16&255,u[A*4+2]=this.state[A]>>>8&255,u[A*4+3]=this.state[A]>>>0&255;return this},p.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},p.prototype._saveState=function(u){for(var b=0;b<this.state.length;b++)u[b]=this.state[b]},p.prototype._restoreState=function(u,b){for(var O=0;O<this.state.length;O++)this.state[O]=u[O];this.bytesHashed=b,this.finished=!1,this.bufferLength=0},p}();e.Hash=i;var s=function(){function p(u){this.inner=new i,this.outer=new i,this.blockSize=this.inner.blockSize,this.digestLength=this.inner.digestLength;var b=new Uint8Array(this.blockSize);if(u.length>this.blockSize)new i().update(u).finish(b).clean();else for(var O=0;O<u.length;O++)b[O]=u[O];for(var O=0;O<b.length;O++)b[O]^=54;this.inner.update(b);for(var O=0;O<b.length;O++)b[O]^=54^92;this.outer.update(b),this.istate=new Uint32Array(8),this.ostate=new Uint32Array(8),this.inner._saveState(this.istate),this.outer._saveState(this.ostate);for(var O=0;O<b.length;O++)b[O]=0}return p.prototype.reset=function(){return this.inner._restoreState(this.istate,this.inner.blockSize),this.outer._restoreState(this.ostate,this.outer.blockSize),this},p.prototype.clean=function(){for(var u=0;u<this.istate.length;u++)this.ostate[u]=this.istate[u]=0;this.inner.clean(),this.outer.clean()},p.prototype.update=function(u){return this.inner.update(u),this},p.prototype.finish=function(u){return this.outer.finished?this.outer.finish(u):(this.inner.finish(u),this.outer.update(u,this.digestLength).finish(u)),this},p.prototype.digest=function(){var u=new Uint8Array(this.digestLength);return this.finish(u),u},p}();e.HMAC=s;function a(p){var u=new i().update(p),b=u.digest();return u.clean(),b}e.hash=a,e.default=a;function o(p,u){var b=new s(p).update(u),O=b.digest();return b.clean(),O}e.hmac=o;function c(p,u,b,O){var E=O[0];if(E===0)throw new Error("hkdf: cannot expand more");u.reset(),E>1&&u.update(p),b&&u.update(b),u.update(O),u.finish(p),O[0]++}var l=new Uint8Array(e.digestLength);function f(p,u,b,O){u===void 0&&(u=l),O===void 0&&(O=32);for(var E=new Uint8Array([1]),v=o(u,p),k=new s(v),A=new Uint8Array(k.digestLength),I=A.length,y=new Uint8Array(O),S=0;S<O;S++)I===A.length&&(c(A,k,b,E),I=0),y[S]=A[I++];return k.clean(),A.fill(0),E.fill(0),y}e.hkdf=f;function d(p,u,b,O){for(var E=new s(p),v=E.digestLength,k=new Uint8Array(4),A=new Uint8Array(v),I=new Uint8Array(v),y=new Uint8Array(O),S=0;S*v<O;S++){var C=S+1;k[0]=C>>>24&255,k[1]=C>>>16&255,k[2]=C>>>8&255,k[3]=C>>>0&255,E.reset(),E.update(u),E.update(k),E.finish(I);for(var N=0;N<v;N++)A[N]=I[N];for(var N=2;N<=b;N++){E.reset(),E.update(I).finish(I);for(var $=0;$<v;$++)A[$]^=I[$]}for(var N=0;N<v&&S*v+N<O;N++)y[S*v+N]=A[N]}for(var S=0;S<v;S++)A[S]=I[S]=0;for(var S=0;S<4;S++)k[S]=0;return E.clean(),y}e.pbkdf2=d})})(gl);const Or=Me,{copyObject:ml,parseOpId:Xe,equalBytes:bl}=Be,{utf8ToString:jp,hexStringToBytes:_l,bytesToHexString:Ar,Encoder:Wt,Decoder:Ee,RLEEncoder:Oe,RLEDecoder:yl,DeltaEncoder:Jt,DeltaDecoder:Bp,BooleanEncoder:wl,BooleanDecoder:Lp}=pl,{Hash:vl}=gl.exports,Xt=new Uint8Array([133,111,74,131]),ns=0,Qt=1,Vn=2,xl=256,Z={GROUP_CARD:0,ACTOR_ID:1,INT_RLE:2,INT_DELTA:3,BOOLEAN:4,STRING_RLE:5,VALUE_LEN:6,VALUE_RAW:7},Un=8,re={NULL:0,FALSE:1,TRUE:2,LEB128_UINT:3,LEB128_INT:4,IEEE754:5,UTF8:6,BYTES:7,COUNTER:8,TIMESTAMP:9,MIN_UNKNOWN:10,MAX_UNKNOWN:15},Mn=["makeMap","set","makeList","del","makeText","inc","makeTable","link"],Vp={makeMap:"map",makeList:"list",makeText:"text",makeTable:"table"},Il=[{columnName:"objActor",columnId:0<<4|Z.ACTOR_ID},{columnName:"objCtr",columnId:0<<4|Z.INT_RLE},{columnName:"keyActor",columnId:1<<4|Z.ACTOR_ID},{columnName:"keyCtr",columnId:1<<4|Z.INT_DELTA},{columnName:"keyStr",columnId:1<<4|Z.STRING_RLE},{columnName:"idActor",columnId:2<<4|Z.ACTOR_ID},{columnName:"idCtr",columnId:2<<4|Z.INT_DELTA},{columnName:"insert",columnId:3<<4|Z.BOOLEAN},{columnName:"action",columnId:4<<4|Z.INT_RLE},{columnName:"valLen",columnId:5<<4|Z.VALUE_LEN},{columnName:"valRaw",columnId:5<<4|Z.VALUE_RAW},{columnName:"chldActor",columnId:6<<4|Z.ACTOR_ID},{columnName:"chldCtr",columnId:6<<4|Z.INT_DELTA}],rs=Il.concat([{columnName:"predNum",columnId:7<<4|Z.GROUP_CARD},{columnName:"predActor",columnId:7<<4|Z.ACTOR_ID},{columnName:"predCtr",columnId:7<<4|Z.INT_DELTA}]),is=Il.concat([{columnName:"succNum",columnId:8<<4|Z.GROUP_CARD},{columnName:"succActor",columnId:8<<4|Z.ACTOR_ID},{columnName:"succCtr",columnId:8<<4|Z.INT_DELTA}]),El=[{columnName:"actor",columnId:0<<4|Z.ACTOR_ID},{columnName:"seq",columnId:0<<4|Z.INT_DELTA},{columnName:"maxOp",columnId:1<<4|Z.INT_DELTA},{columnName:"time",columnId:2<<4|Z.INT_DELTA},{columnName:"message",columnId:3<<4|Z.STRING_RLE},{columnName:"depsNum",columnId:4<<4|Z.GROUP_CARD},{columnName:"depsIndex",columnId:4<<4|Z.INT_DELTA},{columnName:"extraLen",columnId:5<<4|Z.VALUE_LEN},{columnName:"extraRaw",columnId:5<<4|Z.VALUE_RAW}];function Cr(t,e){if(!t||!t.actorId)return t;const n=t.counter,r=e.indexOf(t.actorId);if(r<0)throw new RangeError("missing actorId");return{counter:n,actorNum:r,actorId:t.actorId}}function ss(t,e){return t.counter<e.counter?-1:t.counter>e.counter?1:t.actorId<e.actorId?-1:t.actorId>e.actorId?1:0}function Up(t,e){const n={},r=[];for(let s of t)s=ml(s),n[s.actor]=!0,s.ops=Gp(s.ops,s.startOp,s.actor),s.ops=s.ops.map(a=>{a=ml(a),a.obj!=="_root"&&(a.obj=Xe(a.obj)),a.elemId&&a.elemId!=="_head"&&(a.elemId=Xe(a.elemId)),a.child&&(a.child=Xe(a.child)),a.pred&&(a.pred=a.pred.map(Xe)),a.obj.actorId&&(n[a.obj.actorId]=!0),a.elemId&&a.elemId.actorId&&(n[a.elemId.actorId]=!0),a.child&&a.child.actorId&&(n[a.child.actorId]=!0);for(let o of a.pred)n[o.actorId]=!0;return a}),r.push(s);let i=Object.keys(n).sort();e&&(i=[t[0].actor].concat(i.filter(s=>s!==t[0].actor)));for(let s of r){s.actorNum=i.indexOf(s.actor);for(let a=0;a<s.ops.length;a++){let o=s.ops[a];o.id={counter:s.startOp+a,actorNum:s.actorNum,actorId:s.actor},o.obj=Cr(o.obj,i),o.elemId=Cr(o.elemId,i),o.child=Cr(o.child,i),o.pred=o.pred.map(c=>Cr(c,i))}}return{changes:r,actorIds:i}}function Mp(t,e){if(t.obj==="_root")e.objActor.appendValue(null),e.objCtr.appendValue(null);else if(t.obj.actorNum>=0&&t.obj.counter>0)e.objActor.appendValue(t.obj.actorNum),e.objCtr.appendValue(t.obj.counter);else throw new RangeError(`Unexpected objectId reference: ${JSON.stringify(t.obj)}`)}function Pp(t,e){if(t.key)e.keyActor.appendValue(null),e.keyCtr.appendValue(null),e.keyStr.appendValue(t.key);else if(t.elemId==="_head"&&t.insert)e.keyActor.appendValue(null),e.keyCtr.appendValue(0),e.keyStr.appendValue(null);else if(t.elemId&&t.elemId.actorNum>=0&&t.elemId.counter>0)e.keyActor.appendValue(t.elemId.actorNum),e.keyCtr.appendValue(t.elemId.counter),e.keyStr.appendValue(null);else throw new RangeError(`Unexpected operation key: ${JSON.stringify(t)}`)}function Hp(t,e){const n=Mn.indexOf(t.action);if(n>=0)e.action.appendValue(n);else if(typeof t.action=="number")e.action.appendValue(t.action);else throw new RangeError(`Unexpected operation action: ${t.action}`)}function Fp(t){switch(t.datatype){case"counter":return[re.COUNTER,t.value];case"timestamp":return[re.TIMESTAMP,t.value];case"uint":return[re.LEB128_UINT,t.value];case"int":return[re.LEB128_INT,t.value];case"float64":{const e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,t.value,!0),[re.IEEE754,new Uint8Array(e)]}default:if(Number.isInteger(t.value)&&t.value<=Number.MAX_SAFE_INTEGER&&t.value>=Number.MIN_SAFE_INTEGER)return[re.LEB128_INT,t.value];{const e=new ArrayBuffer(8);return new DataView(e).setFloat64(0,t.value,!0),[re.IEEE754,new Uint8Array(e)]}}}function zp(t,e){if(t.action!=="set"&&t.action!=="inc"||t.value===null)e.valLen.appendValue(re.NULL);else if(t.value===!1)e.valLen.appendValue(re.FALSE);else if(t.value===!0)e.valLen.appendValue(re.TRUE);else if(typeof t.value=="string"){const n=e.valRaw.appendRawString(t.value);e.valLen.appendValue(n<<4|re.UTF8)}else if(ArrayBuffer.isView(t.value)){const n=e.valRaw.appendRawBytes(new Uint8Array(t.value.buffer));e.valLen.appendValue(n<<4|re.BYTES)}else if(typeof t.value=="number"){let[n,r]=Fp(t),i;n===re.LEB128_UINT?i=e.valRaw.appendUint53(r):n===re.IEEE754?i=e.valRaw.appendRawBytes(r):i=e.valRaw.appendInt53(r),e.valLen.appendValue(i<<4|n)}else if(typeof t.datatype=="number"&&t.datatype>=re.MIN_UNKNOWN&&t.datatype<=re.MAX_UNKNOWN&&t.value instanceof Uint8Array){const n=e.valRaw.appendRawBytes(t.value);e.valLen.appendValue(n<<4|t.datatype)}else throw t.datatype?new RangeError(`Unknown datatype ${t.datatype} for value ${t.value}`):new RangeError(`Unsupported value in operation: ${t.value}`)}function Ol(t,e){if(t===re.NULL)return{value:null};if(t===re.FALSE)return{value:!1};if(t===re.TRUE)return{value:!0};if(t%16===re.UTF8)return{value:jp(e)};if(t%16===re.LEB128_UINT)return{value:new Ee(e).readUint53(),datatype:"uint"};if(t%16===re.LEB128_INT)return{value:new Ee(e).readInt53(),datatype:"int"};if(t%16===re.IEEE754){const n=new DataView(e.buffer,e.byteOffset,e.byteLength);if(e.byteLength===8)return{value:n.getFloat64(0,!0),datatype:"float64"};throw new RangeError(`Invalid length for floating point number: ${e.byteLength}`)}else return t%16===re.COUNTER?{value:new Ee(e).readInt53(),datatype:"counter"}:t%16===re.TIMESTAMP?{value:new Ee(e).readInt53(),datatype:"timestamp"}:{value:e,datatype:t%16}}function Al(t,e,n,r){const{columnId:i,columnName:s,decoder:a}=t[e];if(i%8===Z.VALUE_LEN&&e+1<t.length&&t[e+1].columnId===i+1){const o=a.readValue(),c=t[e+1].decoder.readRawBytes(o>>4),{value:l,datatype:f}=Ol(o,c);return r[s]=l,f&&(r[s+"_datatype"]=f),2}else if(i%8===Z.ACTOR_ID){const o=a.readValue();if(o===null)r[s]=null;else{if(!n[o])throw new RangeError(`No actor index ${o}`);r[s]=n[o]}}else r[s]=a.readValue();return 1}function Zp(t,e){const n={objActor:new Oe("uint"),objCtr:new Oe("uint"),keyActor:new Oe("uint"),keyCtr:new Jt,keyStr:new Oe("utf8"),insert:new wl,action:new Oe("uint"),valLen:new Oe("uint"),valRaw:new Wt,chldActor:new Oe("uint"),chldCtr:new Jt};e?(n.idActor=new Oe("uint"),n.idCtr=new Jt,n.succNum=new Oe("uint"),n.succActor=new Oe("uint"),n.succCtr=new Jt):(n.predNum=new Oe("uint"),n.predCtr=new Jt,n.predActor=new Oe("uint"));for(let i of t)if(Mp(i,n),Pp(i,n),n.insert.appendValue(!!i.insert),Hp(i,n),zp(i,n),i.child&&i.child.counter?(n.chldActor.appendValue(i.child.actorNum),n.chldCtr.appendValue(i.child.counter)):(n.chldActor.appendValue(null),n.chldCtr.appendValue(null)),e){n.idActor.appendValue(i.id.actorNum),n.idCtr.appendValue(i.id.counter),n.succNum.appendValue(i.succ.length),i.succ.sort(ss);for(let s=0;s<i.succ.length;s++)n.succActor.appendValue(i.succ[s].actorNum),n.succCtr.appendValue(i.succ[s].counter)}else{n.predNum.appendValue(i.pred.length),i.pred.sort(ss);for(let s=0;s<i.pred.length;s++)n.predActor.appendValue(i.pred[s].actorNum),n.predCtr.appendValue(i.pred[s].counter)}let r=[];for(let{columnName:i,columnId:s}of e?is:rs)n[i]&&r.push({columnId:s,columnName:i,encoder:n[i]});return r.sort((i,s)=>i.columnId-s.columnId)}function qp(t,e){return e===void 0?typeof t=="string"||typeof t=="boolean"||t===null:typeof t=="number"}function Gp(t,e,n){let r=e,i=[];for(const s of t)if(s.action==="set"&&s.values&&s.insert){if(s.pred.length!==0)throw new RangeError("multi-insert pred must be empty");let a=s.elemId;const o=s.datatype;for(const c of s.values){if(!qp(c,o))throw new RangeError(`Decode failed: bad value/datatype association (${c},${o})`);i.push({action:"set",obj:s.obj,elemId:a,datatype:o,value:c,pred:[],insert:!0}),a=`${r}@${n}`,r+=1}}else if(s.action==="del"&&s.multiOp>1){if(s.pred.length!==1)throw new RangeError("multiOp deletion must have exactly one pred");const a=Xe(s.elemId),o=Xe(s.pred[0]);for(let c=0;c<s.multiOp;c++){const l=`${a.counter+c}@${a.actorId}`,f=[`${o.counter+c}@${o.actorId}`];i.push({action:"del",obj:s.obj,elemId:l,pred:f}),r+=1}}else i.push(s),r+=1;return i}function Cl(t,e){const n=[];for(let r of t){const i=r.objCtr===null?"_root":`${r.objCtr}@${r.objActor}`,s=r.keyStr?void 0:r.keyCtr===0?"_head":`${r.keyCtr}@${r.keyActor}`,a=Mn[r.action]||r.action,o=s?{obj:i,elemId:s,action:a}:{obj:i,key:r.keyStr,action:a};if(o.insert=!!r.insert,(Mn[r.action]==="set"||Mn[r.action]==="inc")&&(o.value=r.valLen,r.valLen_datatype&&(o.datatype=r.valLen_datatype)),!!r.chldCtr!=!!r.chldActor)throw new RangeError(`Mismatched child columns: ${r.chldCtr} and ${r.chldActor}`);r.chldCtr!==null&&(o.child=`${r.chldCtr}@${r.chldActor}`),e?(o.id=`${r.idCtr}@${r.idActor}`,o.succ=r.succNum.map(c=>`${c.succCtr}@${c.succActor}`),Rl(r.succNum.map(c=>({counter:c.succCtr,actorId:c.succActor})))):(o.pred=r.predNum.map(c=>`${c.predCtr}@${c.predActor}`),Rl(r.predNum.map(c=>({counter:c.predCtr,actorId:c.predActor})))),n.push(o)}return n}function Rl(t){let e=null;for(let n of t){if(e&&ss(e,n)!==-1)throw new RangeError("operation IDs are not in ascending order");e=n}}function Kp(t){return(t&7)===Z.INT_DELTA?new Jt:(t&7)===Z.BOOLEAN?new wl:(t&7)===Z.STRING_RLE?new Oe("utf8"):(t&7)===Z.VALUE_RAW?new Wt:new Oe("uint")}function Rr(t,e){return(t&7)===Z.INT_DELTA?new Bp(e):(t&7)===Z.BOOLEAN?new Lp(e):(t&7)===Z.STRING_RLE?new yl("utf8",e):(t&7)===Z.VALUE_RAW?new Ee(e):new yl("uint",e)}function Tl(t,e){const n=new Uint8Array(0);let r=[],i=0,s=0;for(;i<t.length||s<e.length;)if(i===t.length||s<e.length&&e[s].columnId<t[i].columnId){const{columnId:a,columnName:o}=e[s];r.push({columnId:a,columnName:o,decoder:Rr(a,n)}),s++}else if(s===e.length||t[i].columnId<e[s].columnId){const{columnId:a,buffer:o}=t[i];r.push({columnId:a,decoder:Rr(a,o)}),i++}else{const{columnId:a,buffer:o}=t[i],{columnName:c}=e[s];r.push({columnId:a,columnName:c,decoder:Rr(a,o)}),i++,s++}return r}function os(t,e,n){t=Tl(t,n);let r=[];for(;t.some(i=>!i.decoder.done);){let i={},s=0;for(;s<t.length;){const a=t[s].columnId;let o=a>>4,c=1;for(;s+c<t.length&&t[s+c].columnId>>4===o;)c++;if(a%8===Z.GROUP_CARD){const l=[],f=t[s].decoder.readValue();for(let d=0;d<f;d++){let p={};for(let u=1;u<c;u++)Al(t,s+u,e,p);l.push(p)}i[t[s].columnName]=l,s+=c}else s+=Al(t,s,e,i)}r.push(i)}return r}function as(t){const e=(-1^Un)>>>0;let n=-1,r=[],i=t.readUint53();for(let s=0;s<i;s++){const a=t.readUint53(),o=t.readUint53();if((a&e)<=(n&e))throw new RangeError("Columns must be in ascending order");n=a,r.push({columnId:a,bufferLen:o})}return r}function ls(t,e){const n=e.filter(r=>r.encoder.buffer.byteLength>0);t.appendUint53(n.length);for(let r of n)t.appendUint53(r.columnId),t.appendUint53(r.encoder.buffer.byteLength)}function kl(t){const e=t.readUint53(),n=[];for(let a=0;a<e;a++)n.push(Ar(t.readRawBytes(32)));let r={actor:t.readHexString(),seq:t.readUint53(),startOp:t.readUint53(),time:t.readInt53(),message:t.readPrefixedString(),deps:n};const i=[r.actor],s=t.readUint53();for(let a=0;a<s;a++)i.push(t.readHexString());return r.actorIds=i,r}function Sl(t,e){const n=4,r=Xt.byteLength+n+1+5,i=new Wt;i.appendRawBytes(new Uint8Array(r)),e(i);const s=i.buffer,a=new Wt;a.appendByte(t),a.appendUint53(s.byteLength-r);const o=a.buffer,c=new vl;c.update(o),c.update(s.subarray(r));const l=c.digest(),f=l.subarray(0,n);return s.set(Xt,r-o.byteLength-n-Xt.byteLength),s.set(f,r-o.byteLength-n),s.set(o,r-o.byteLength),{hash:l,bytes:s.subarray(r-o.byteLength-n-Xt.byteLength)}}function en(t,e){if(!bl(t.readRawBytes(Xt.byteLength),Xt))throw new RangeError("Data does not begin with magic bytes 85 6f 4a 83");const n=t.readRawBytes(4),r=t.offset,i=t.readByte(),s=t.readUint53(),a={chunkType:i,chunkLength:s,chunkData:t.readRawBytes(s)};if(e){const o=new vl;o.update(t.buf.subarray(r,t.offset));const c=o.digest();if(!bl(c.subarray(0,4),n))throw new RangeError("checksum does not match data");a.hash=Ar(c)}return a}function Nl(t){const{changes:e,actorIds:n}=Up([t],!0),r=e[0],{hash:i,bytes:s}=Sl(Qt,o=>{if(!Array.isArray(r.deps))throw new TypeError("deps is not an array");o.appendUint53(r.deps.length);for(let l of r.deps.slice().sort())o.appendRawBytes(_l(l));o.appendHexString(r.actor),o.appendUint53(r.seq),o.appendUint53(r.startOp),o.appendInt53(r.time),o.appendPrefixedString(r.message||""),o.appendUint53(n.length-1);for(let l of n.slice(1))o.appendHexString(l);const c=Zp(r.ops,!1);ls(o,c);for(let l of c)o.appendRawBytes(l.encoder.buffer);r.extraBytes&&o.appendRawBytes(r.extraBytes)}),a=Ar(i);if(t.hash&&t.hash!==a)throw new RangeError(`Change hash does not match encoding: ${t.hash} != ${a}`);return s.byteLength>=xl?Wp(s):s}function $l(t){t[8]===Vn&&(t=Dl(t));const e=new Ee(t),n=en(e,!0),r=new Ee(n.chunkData);if(!e.done)throw new RangeError("Encoded change has trailing data");if(n.chunkType!==Qt)throw new RangeError(`Unexpected chunk type: ${n.chunkType}`);const i=kl(r),s=as(r);for(let a=0;a<s.length;a++){if((s[a].columnId&Un)!=0)throw new RangeError("change must not contain deflated columns");s[a].buffer=r.readRawBytes(s[a].bufferLen)}if(!r.done){const a=r.buf.byteLength-r.offset;i.extraBytes=r.readRawBytes(a)}return i.columns=s,i.hash=n.hash,i}function cs(t){const e=$l(t);return e.ops=Cl(os(e.columns,e.actorIds,rs),!1),delete e.actorIds,delete e.columns,e}function Yp(t,e){t[8]===Vn&&(t=Dl(t));const n=en(new Ee(t),e);if(n.chunkType!==Qt)throw new RangeError("Buffer chunk type is not a change");const r=kl(new Ee(n.chunkData));return r.change=t,e&&(r.hash=n.hash),r}function Wp(t){const e=en(new Ee(t),!1);if(e.chunkType!==Qt)throw new RangeError(`Unexpected chunk type: ${e.chunkType}`);const n=Or.deflateRaw(e.chunkData),r=new Wt;return r.appendRawBytes(t.subarray(0,8)),r.appendByte(Vn),r.appendUint53(n.byteLength),r.appendRawBytes(n),r.buffer}function Dl(t){const e=en(new Ee(t),!1);if(e.chunkType!==Vn)throw new RangeError(`Unexpected chunk type: ${e.chunkType}`);const n=Or.inflateRaw(e.chunkData),r=new Wt;return r.appendRawBytes(t.subarray(0,8)),r.appendByte(Qt),r.appendUint53(n.byteLength),r.appendRawBytes(n),r.buffer}function jl(t){let e=new Ee(t),n=[],r=0;for(;!e.done;)en(e,!1),n.push(t.subarray(r,e.offset)),r=e.offset;return n}function Jp(t){let e=[];for(let n of t)for(let r of jl(n))r[8]===ns?e=e.concat(Ll(r)):(r[8]===Qt||r[8]===Vn)&&e.push(cs(r));return e}function Xp(t,e){if(t===e)return 0;if(t==="_root")return-1;if(e==="_root")return 1;const n=Xe(t),r=Xe(e);return n.counter<r.counter?-1:n.counter>r.counter?1:n.actorId<r.actorId?-1:n.actorId>r.actorId?1:0}function Qp(t,e){let n={};for(let i of t){if(i.ops=[],n[i.actor]||(n[i.actor]=[]),i.seq!==n[i.actor].length+1)throw new RangeError(`Expected seq = ${n[i.actor].length+1}, got ${i.seq}`);if(i.seq>1&&n[i.actor][i.seq-2].maxOp>i.maxOp)throw new RangeError("maxOp must increase monotonically per actor");n[i.actor].push(i)}let r={};for(let i of e){if(i.action==="del")throw new RangeError("document should not contain del operations");i.pred=r[i.id]?r[i.id].pred:[],r[i.id]=i;for(let s of i.succ){if(!r[s])if(i.elemId){const a=i.insert?i.id:i.elemId;r[s]={id:s,action:"del",obj:i.obj,elemId:a,pred:[]}}else r[s]={id:s,action:"del",obj:i.obj,key:i.key,pred:[]};r[s].pred.push(i.id)}delete i.succ}for(let i of Object.values(r))i.action==="del"&&e.push(i);for(let i of e){const{counter:s,actorId:a}=Xe(i.id),o=n[a];let c=0,l=o.length;for(;c<l;){const f=Math.floor((c+l)/2);o[f].maxOp<s?c=f+1:l=f}if(c>=o.length)throw new RangeError(`Operation ID ${i.id} outside of allowed range`);o[c].ops.push(i)}for(let i of t){i.ops.sort((s,a)=>Xp(s.id,a.id)),i.startOp=i.maxOp-i.ops.length+1,delete i.maxOp;for(let s=0;s<i.ops.length;s++){const a=i.ops[s],o=`${i.startOp+s}@${i.actor}`;if(a.id!==o)throw new RangeError(`Expected opId ${o}, got ${a.id}`);delete a.id}}}function e0(t,e){let n={};for(let a=0;a<t.length;a++){let o=t[a];o.deps=[];for(let c of o.depsNum.map(l=>l.depsIndex)){if(!t[c]||!t[c].hash)throw new RangeError(`No hash for index ${c} while processing index ${a}`);const l=t[c].hash;o.deps.push(l),n[l]&&delete n[l]}if(o.deps.sort(),delete o.depsNum,o.extraLen_datatype!==re.BYTES)throw new RangeError(`Bad datatype for extra bytes: ${re.BYTES}`);o.extraBytes=o.extraLen,delete o.extraLen_datatype,t[a]=cs(Nl(o)),n[t[a].hash]=!0}const r=Object.keys(n).sort();let i=r.length===e.length,s=0;for(;i&&s<r.length;)i=r[s]===e[s],s++;if(!i)throw new RangeError(`Mismatched heads hashes: expected ${e.join(", ")}, got ${r.join(", ")}`)}function t0(t){const{changesColumns:e,opsColumns:n,actorIds:r,heads:i,headsIndexes:s,extraBytes:a}=t;for(let o of e)Vl(o);for(let o of n)Vl(o);return Sl(ns,o=>{o.appendUint53(r.length);for(let c of r)o.appendHexString(c);o.appendUint53(i.length);for(let c of i.sort())o.appendRawBytes(_l(c));ls(o,e),ls(o,n);for(let c of e)o.appendRawBytes(c.encoder.buffer);for(let c of n)o.appendRawBytes(c.encoder.buffer);for(let c of s)o.appendUint53(c);a&&o.appendRawBytes(a)}).bytes}function Bl(t){const e=new Ee(t),n=en(e,!0),r=new Ee(n.chunkData);if(!e.done)throw new RangeError("Encoded document has trailing data");if(n.chunkType!==ns)throw new RangeError(`Unexpected chunk type: ${n.chunkType}`);const i=[],s=r.readUint53();for(let p=0;p<s;p++)i.push(r.readHexString());const a=[],o=[],c=r.readUint53();for(let p=0;p<c;p++)a.push(Ar(r.readRawBytes(32)));const l=as(r),f=as(r);for(let p=0;p<l.length;p++)l[p].buffer=r.readRawBytes(l[p].bufferLen),Ul(l[p]);for(let p=0;p<f.length;p++)f[p].buffer=r.readRawBytes(f[p].bufferLen),Ul(f[p]);if(!r.done)for(let p=0;p<c;p++)o.push(r.readUint53());const d=r.readRawBytes(r.buf.byteLength-r.offset);return{changesColumns:l,opsColumns:f,actorIds:i,heads:a,headsIndexes:o,extraBytes:d}}function Ll(t){const{changesColumns:e,opsColumns:n,actorIds:r,heads:i}=Bl(t),s=os(e,r,El),a=Cl(os(n,r,is),!0);return Qp(s,a),e0(s,i),s}function Vl(t){t.encoder.buffer.byteLength>=xl&&(t.encoder={buffer:Or.deflateRaw(t.encoder.buffer)},t.columnId|=Un)}function Ul(t){(t.columnId&Un)!=0&&(t.buffer=Or.inflateRaw(t.buffer),t.columnId^=Un)}var Tr={COLUMN_TYPE:Z,VALUE_TYPE:re,ACTIONS:Mn,OBJECT_TYPE:Vp,DOC_OPS_COLUMNS:is,CHANGE_COLUMNS:rs,DOCUMENT_COLUMNS:El,encoderByColumnId:Kp,decoderByColumnId:Rr,makeDecoders:Tl,decodeValue:Ol,splitContainers:jl,encodeChange:Nl,decodeChangeColumns:$l,decodeChange:cs,decodeChangeMeta:Yp,decodeChanges:Jp,encodeDocumentHeader:t0,decodeDocumentHeader:Bl,decodeDocument:Ll};const{parseOpId:kr,copyObject:tn}=Be,{COLUMN_TYPE:de,VALUE_TYPE:fs,ACTIONS:Qe,OBJECT_TYPE:Ml,DOC_OPS_COLUMNS:Pl,CHANGE_COLUMNS:te,DOCUMENT_COLUMNS:Ne,encoderByColumnId:nn,decoderByColumnId:us,makeDecoders:Pn,decodeValue:Sr,encodeChange:n0,decodeChangeColumns:r0,decodeChangeMeta:i0,decodeChanges:s0,decodeDocumentHeader:o0,encodeDocumentHeader:a0}=Tr,Hn=600,l0=10,Hl=7,Fl=Math.floor(l0*Hn/8),ue=0,ce=1,pe=2,ge=3,K=4,ye=5,ie=6,we=7,fe=8,mt=9,St=10,bt=13,rn=14,sn=15,$e=13,hs=14,on=15,zl=te.filter(t=>["predNum","predActor","predCtr"].includes(t.columnName)).map(t=>t.columnId);function ds(t,e,n){if(e.length===1)t[e[0]]=n;else{let r=Object.assign({},t[e[0]]);ds(r,e.slice(1),n),t[e[0]]=r}}function Zl(t,e,n,r){for(let U of e)U.decoder.reset();const{objActor:i,objCtr:s,keyActor:a,keyCtr:o,keyStr:c,idActor:l,idCtr:f,insert:d}=t,[p,u,,,b,O,E,v,k,,,,,A]=e.map(U=>U.decoder);let I=0,y=0,S=!1,C=null,N=null,$=null,j=null,R=null,M=null,P=0;if(s!==null&&!r)for(;(!u.done||!p.done||!k.done)&&(N=u.readValue(),C=n[p.readValue()],k.skipValues(1),N===null||!C||N<s||N===s&&C<i);)I+=1;if((N!==s||C!==i)&&!r)return{found:!0,skipCount:I,visibleCount:y};if(c!==null){for(b.skipValues(I);!b.done;){const U=p.readValue();if(C=U===null?null:n[U],N=u.readValue(),R=b.readValue(),R!==null&&R<c&&N===s&&C===i)I+=1;else break}return{found:!0,skipCount:I,visibleCount:y}}if(E.skipValues(I),O.skipValues(I),v.skipValues(I),A.skipValues(I),j=E.readValue(),$=n[O.readValue()],M=v.readValue(),P=A.readValue(),d){if(!r&&o!==null&&o>0&&a!==null){for(I+=1;!E.done&&!O.done&&(j!==o||$!==a)&&(M&&(S=!1),P===0&&!S&&(y+=1,S=!0),j=E.readValue(),$=n[O.readValue()],N=u.readValue(),C=n[p.readValue()],M=v.readValue(),P=A.readValue(),N===s&&C===i);)I+=1;if(N!==s||C!==i||j!==o||$!==a||!M)return{found:!1,skipCount:I,visibleCount:y};if(M&&(S=!1),P===0&&!S&&(y+=1,S=!0),E.done||O.done)return{found:!0,skipCount:I,visibleCount:y};j=E.readValue(),$=n[O.readValue()],N=u.readValue(),C=n[p.readValue()],M=v.readValue(),P=A.readValue()}for(;(!M||j>f||j===f&&$>l)&&N===s&&C===i&&(I+=1,M&&(S=!1),P===0&&!S&&(y+=1,S=!0),!E.done&&!O.done);)j=E.readValue(),$=n[O.readValue()],N=u.readValue(),C=n[p.readValue()],M=v.readValue(),P=A.readValue()}else if(o!==null&&o>0&&a!==null){for(;(!M||j!==o||$!==a)&&N===s&&C===i&&(I+=1,M&&(S=!1),P===0&&!S&&(y+=1,S=!0),!E.done&&!O.done);)j=E.readValue(),$=n[O.readValue()],N=u.readValue(),C=n[p.readValue()],M=v.readValue(),P=A.readValue();if(N!==s||C!==i||j!==o||$!==a||!M)return{found:!1,skipCount:I,visibleCount:y}}return{found:!0,skipCount:I,visibleCount:y}}function ql(t,e,n){const r=t.blocks[e],i=t.blocks[e+1];let s=r.numVisible[n];return s!==void 0?(r.lastVisibleActor===i.firstVisibleActor&&r.lastVisibleActor!==void 0&&r.lastVisibleCtr===i.firstVisibleCtr&&r.lastVisibleCtr!==void 0&&(s-=1),s):0}function Gl(t,e){const{objActor:n,objCtr:r,keyActor:i,keyCtr:s,keyStr:a}=e;let o=0,c=0;if(r!==null)for(;o<t.blocks.length-1;){const l=t.blocks[o].lastObjectActor===void 0?void 0:t.actorIds[t.blocks[o].lastObjectActor],f=t.blocks[o].lastObjectCtr;if(f===void 0||f<r||f===r&&l<n)o++;else break}if(a!==null){for(;o<t.blocks.length-1;){const f=t.blocks[o].lastKey[e.objId];if(f!==void 0&&f<a)o++;else break}const{skipCount:l}=Zl(e,t.blocks[o].columns,t.actorIds,!1);return{blockIndex:o,skipCount:l,visibleCount:0}}else{const l=s===null||s===0||i===null,f=i===null?null:t.actorIds.indexOf(i);let d=!1;for(;;){if(!l&&!d)for(;o<t.blocks.length-1&&!Yl(t.blocks[o].bloom,f,s);){if(t.blocks[o].lastObjectCtr>r)throw new RangeError(`Reference element not found: ${s}@${i}`);c+=ql(t,o,e.objId),o++}const{found:p,skipCount:u,visibleCount:b}=Zl(e,t.blocks[o].columns,t.actorIds,d);if(o===t.blocks.length-1){if(p)return{blockIndex:o,skipCount:u,visibleCount:c+b};throw new RangeError(`Reference element not found: ${s}@${i}`)}else if(p&&u<t.blocks[o].numOps)return{blockIndex:o,skipCount:u,visibleCount:c+b};d=p&&e.insert,c+=ql(t,o,e.objId),o++}}}function Kl(t,e,n){let r=8*t.byteLength,i=n%r,s=e%r,a=((n^e)*16777619>>>0)%r;for(let o=0;o<Hl;o++)t[i>>>3]|=1<<(i&7),i=(i+s)%r,s=(s+a)%r}function Yl(t,e,n){let r=8*t.byteLength,i=n%r,s=e%r,a=((n^e)*16777619>>>0)%r;for(let o=0;o<Hl;o++){if((t[i>>>3]&1<<(i&7))==0)return!1;i=(i+s)%r,s=(s+a)%r}return!0}function Wl(t,e){t.bloom=new Uint8Array(Fl),t.lastKey={},t.numVisible={},t.numOps=0,t.lastObjectActor=void 0,t.lastObjectCtr=void 0,t.firstVisibleActor=void 0,t.firstVisibleCtr=void 0,t.lastVisibleActor=void 0,t.lastVisibleCtr=void 0;for(let d of t.columns)d.decoder.reset();const[n,r,i,s,a,o,c,l,,,,,,f]=t.columns.map(d=>d.decoder);for(;!c.done;){t.numOps+=1;const d=n.readValue(),p=r.readValue(),u=i.readValue(),b=s.readValue(),O=a.readValue(),E=o.readValue(),v=c.readValue(),k=l.readValue(),A=f.readValue(),I=d===null?"_root":`${p}@${e[d]}`;if(d!==null&&p!==null&&(t.lastObjectActor=d,t.lastObjectCtr=p),O!==null)t.lastKey[I]=O;else if(k||b!==null){t.numVisible[I]===void 0&&(t.numVisible[I]=0);const y=k?E:u,S=k?v:b;Kl(t.bloom,y,S),A===0&&(t.firstVisibleActor===void 0&&(t.firstVisibleActor=y),t.firstVisibleCtr===void 0&&(t.firstVisibleCtr=S),(t.lastVisibleActor!==y||t.lastVisibleCtr!==S)&&(t.numVisible[I]+=1),t.lastVisibleActor=y,t.lastVisibleCtr=S)}}}function ps(t,e,n,r,i){if(e[ue]!==null&&e[ce]!==null&&(t.lastObjectCtr===void 0||t.lastObjectCtr<e[ce]||t.lastObjectCtr===e[ce]&&r[t.lastObjectActor]<r[e[ue]])&&(t.lastObjectActor=e[ue],t.lastObjectCtr=e[ce]),e[K]!==null)(t.lastKey[n]===void 0||t.lastKey[n]<e[K])&&(t.lastKey[n]=e[K]);else{const s=e[we]?e[ye]:e[pe],a=e[we]?e[ie]:e[ge];Kl(t.bloom,s,a),(e[$e]===0||i)&&(t.firstVisibleActor===void 0&&(t.firstVisibleActor=s),t.firstVisibleCtr===void 0&&(t.firstVisibleCtr=a),t.lastVisibleActor=s,t.lastVisibleCtr=a)}}function Jl(t,e){for(let s of t.columns)s.decoder.reset();const n=Math.ceil(t.numOps/(.8*Hn));let r=[],i=0;for(let s=1;s<=n;s++){const a=Math.ceil(s*t.numOps/n)-i,o=t.columns.map(f=>({columnId:f.columnId,encoder:nn(f.columnId)}));an(o,t.columns,a);const l={columns:o.map(f=>{const d=us(f.columnId,f.encoder.buffer);return{columnId:f.columnId,decoder:d}})};Wl(l,e),r.push(l),i+=a}return r}function c0(t){const e=t[0].columns.map(n=>({columnId:n.columnId,encoder:nn(n.columnId)}));for(let n of t){for(let r of n.columns)r.decoder.reset();an(e,n.columns,n.numOps)}return e}function an(t,e,n){if(n===0)return;let r=0,i=-1,s=0,a=-1,o=0;for(let c of t){for(;r<e.length&&e[r].columnId<c.columnId;)r++;let l=null;r<e.length&&e[r].columnId===c.columnId&&e[r].decoder.buf.byteLength>0&&(l=e[r].decoder);const f=c.columnId>>4===i?s:n;if(c.columnId%8===de.GROUP_CARD)i=c.columnId>>4,l?s=c.encoder.copyFrom(l,{count:n,sumValues:!0}).sum:(c.encoder.appendValue(0,n),s=0);else if(c.columnId%8===de.VALUE_LEN)if(l){if(r+1===e.length||e[r+1].columnId!==c.columnId+1)throw new RangeError("VALUE_LEN column without accompanying VALUE_RAW column");a=c.columnId+1,o=c.encoder.copyFrom(l,{count:f,sumValues:!0,sumShift:4}).sum}else c.encoder.appendValue(null,f),a=c.columnId+1,o=0;else if(c.columnId%8===de.VALUE_RAW){if(c.columnId!==a)throw new RangeError("VALUE_RAW column without accompanying VALUE_LEN column");o>0&&c.encoder.appendRawBytes(l.readRawBytes(o))}else if(l)c.encoder.copyFrom(l,{count:f});else{const d=c.columnId%8===de.BOOLEAN?!1:null;c.encoder.appendValue(d,f)}}}function gs(t,e){let n=[],r,i=-1,s=0,a=-1,o=0;for(let c of t){if(c.columnId%8===de.VALUE_RAW){if(c.columnId!==a)throw new RangeError("unexpected VALUE_RAW column");r=c.decoder.readRawBytes(o)}else if(c.columnId%8===de.GROUP_CARD)i=c.columnId>>4,s=c.decoder.readValue()||0,r=s;else if(c.columnId>>4===i){r=[],c.columnId%8===de.VALUE_LEN&&(a=c.columnId+1,o=0);for(let l=0;l<s;l++){let f=c.decoder.readValue();c.columnId%8===de.ACTOR_ID&&e&&typeof f=="number"&&(f=e[f]),c.columnId%8===de.VALUE_LEN&&(o+=r>>>4),r.push(f)}}else r=c.decoder.readValue(),c.columnId%8===de.ACTOR_ID&&e&&typeof r=="number"&&(r=e[r]),c.columnId%8===de.VALUE_LEN&&(a=c.columnId+1,o=r>>>4);n.push(r)}return n}function Nr(t,e,n){let r=0,i=-1,s=0;for(let a of t){for(;r<e.length&&e[r].columnId<a.columnId;)r++;if(r<e.length&&e[r].columnId===a.columnId){const o=n[r];if(a.columnId%8===de.GROUP_CARD)i=a.columnId>>4,s=o,a.encoder.appendValue(o);else if(a.columnId>>4===i){if(!Array.isArray(o)||o.length!==s)throw new RangeError("bad group value");for(let c of o)a.encoder.appendValue(c)}else a.columnId%8===de.VALUE_RAW?o&&a.encoder.appendRawBytes(o):a.encoder.appendValue(o)}else if(a.columnId%8===de.GROUP_CARD)i=a.columnId>>4,s=0,a.encoder.appendValue(0);else if(a.columnId%8!==de.VALUE_RAW){const o=a.columnId>>4===i?s:1;let c=null;a.columnId%8===de.BOOLEAN&&(c=!1),a.columnId%8===de.VALUE_LEN&&(c=0),a.encoder.appendValue(c,o)}}}function ms(t,e){let n=t.blocks[e];if(n.columns[fe].decoder.done){if(e===t.blocks.length-1)return{docOp:null,blockIndex:e};e+=1,n=t.blocks[e];for(let r of n.columns)r.decoder.reset();return{docOp:gs(n.columns),blockIndex:e}}else return{docOp:gs(n.columns),blockIndex:e}}function Xl(t,e){for(;e.changeIndex<e.changes.length-1&&(!e.columns||e.columns[fe].decoder.done);){e.changeIndex+=1;const r=e.changes[e.changeIndex];e.columns=Pn(r.columns,te),e.opCtr=r.startOp,d0(t,e.columns);const{actorIds:i,actorTable:s}=p0(t.actorIds,r);t.actorIds=i,e.actorTable=s,e.actorIndex=t.actorIds.indexOf(r.actorIds[0])}if(e.columns[fe].decoder.done){e.done=!0,e.nextOp=null;return}e.nextOp=gs(e.columns,e.actorTable),e.nextOp[ye]=e.actorIndex,e.nextOp[ie]=e.opCtr,e.changes[e.changeIndex].maxOp=e.opCtr,e.opCtr>t.maxOp&&(t.maxOp=e.opCtr),e.opCtr+=1;const n=e.nextOp;if(n[ce]===null&&n[ue]!==null||n[ce]!==null&&n[ue]===null)throw new RangeError(`Mismatched object reference: (${n[ce]}, ${n[ue]})`);if(n[ge]===null&&n[pe]!==null||n[ge]===0&&n[pe]!==null||n[ge]>0&&n[pe]===null)throw new RangeError(`Mismatched operation key: (${n[ge]}, ${n[pe]})`)}function ln(t,e){return e==="list"||e==="text"?{objectId:t,type:e,edits:[]}:{objectId:t,type:e,props:{}}}function Ql(t,e,n=1){const r=kr(t),i=kr(e);return r.actorId===i.actorId&&r.counter+n===i.counter}function Fn(t,e){if(t.length===0){t.push(e);return}let n=t[t.length-1];n.action==="insert"&&e.action==="insert"&&n.index===e.index-1&&n.value.type==="value"&&e.value.type==="value"&&n.elemId===n.opId&&e.elemId===e.opId&&Ql(n.elemId,e.elemId,1)&&n.value.datatype===e.value.datatype&&typeof n.value.value==typeof e.value.value?(n.action="multi-insert",e.value.datatype&&(n.datatype=e.value.datatype),n.values=[n.value.value,e.value.value],delete n.value,delete n.opId):n.action==="multi-insert"&&e.action==="insert"&&n.index+n.values.length===e.index&&e.value.type==="value"&&e.elemId===e.opId&&Ql(n.elemId,e.elemId,n.values.length)&&n.datatype===e.value.datatype&&typeof n.values[0]==typeof e.value.value?n.values.push(e.value.value):n.action==="remove"&&e.action==="remove"&&n.index===e.index?n.count+=e.count:t.push(e)}function bs(t,e,n,r,i,s){let a=!1;if(s)for(;!a&&t.length>0;){const o=t[t.length-1];if((o.action==="insert"||o.action==="update")&&o.index===e)t.pop(),a=o.action==="insert";else if(o.action==="multi-insert"&&o.index+o.values.length-1===e)o.values.pop(),a=!0;else break}a?Fn(t,{action:"insert",index:e,elemId:n,opId:r,value:i}):Fn(t,{action:"update",index:e,opId:r,value:i})}function f0(t,e,n){let r=[];for(;t.length>0;){let s=t[t.length-1];if(s.action==="insert"){if(s.index!==e)throw new RangeError("last edit has unexpected index");r.unshift(t.pop());break}else if(s.action==="update"){if(s.index!==e)throw new RangeError("last edit has unexpected index");r.unshift(t.pop())}else throw new RangeError("last edit has unexpected action")}let i=!0;for(let s of r)bs(t,e,n,s.opId,s.value,i),i=!1}function _s(t,e,n,r,i,s,a,o){const c=!e,l=r[fe]<Qe.length?Ml[Qe[r[fe]]]:null,f=`${r[ie]}@${i.actorIds[r[ye]]}`,d=r[we]?r[ye]:r[pe],p=r[we]?r[ie]:r[ge],u=r[K]?r[K]:`${p}@${i.actorIds[d]}`;r[fe]%2==0&&!i.objectMeta[f]&&(i.objectMeta[f]={parentObj:n,parentKey:u,opId:f,type:l,children:{}},ds(i.objectMeta,[n,"children",u,f],{objectId:f,type:l,props:{}}));const b=!s[u];s[u]||(s[u]={visibleOps:[],hasChild:!1});const O=o!==void 0&&r[$e]>0;O||(s[u].visibleOps.push(r),s[u].hasChild=s[u].hasChild||r[fe]%2==0);const E=i.objectMeta[n].children[u];if(s[u].hasChild||E&&Object.keys(E).length>0){let I={};for(let y of s[u].visibleOps){const S=`${y[ie]}@${i.actorIds[y[ye]]}`;if(Qe[y[fe]]==="set")I[S]=Object.assign({type:"value"},Sr(y[mt],y[St]));else if(y[fe]%2==0){const C=y[fe]<Qe.length?Ml[Qe[y[fe]]]:null;I[S]=ln(S,C)}}ds(i.objectMeta,[n,"children",u],I)}let v,k;if(O&&Qe[r[fe]]==="set"&&(r[mt]&15)===fs.COUNTER){s[u]||(s[u]={visibleOps:[],hasChild:!1}),s[u].counterStates||(s[u].counterStates={});let I=s[u].counterStates,y={opId:f,value:Sr(r[mt],r[St]).value,succs:{}};for(let S=0;S<r[$e];S++){const C=`${r[on][S]}@${i.actorIds[r[hs][S]]}`;I[C]=y,y.succs[C]=!0}}else if(Qe[r[fe]]==="inc"){if(!s[u]||!s[u].counterStates||!s[u].counterStates[f])throw new RangeError(`increment operation ${f} for unknown counter`);let I=s[u].counterStates[f];I.value+=Sr(r[mt],r[St]).value,delete I.succs[f],Object.keys(I.succs).length===0&&(v=I.opId,k={type:"value",datatype:"counter",value:I.value})}else O||(Qe[r[fe]]==="set"?(v=f,k=Object.assign({type:"value"},Sr(r[mt],r[St]))):r[fe]%2==0&&(t[f]||(t[f]=ln(f,l)),v=f,k=t[f]));t[n]||(t[n]=ln(n,i.objectMeta[n].type));const A=t[n];if(r[K]===null)if(o===0&&!c&&s[u].action==="insert"&&(s[u].action="update",f0(A.edits,a,u),e&&(e.numVisible[n]-=1)),k)if(!s[u].action&&(o===void 0||c))s[u].action="insert",Fn(A.edits,{action:"insert",index:a,elemId:u,opId:v,value:k}),e&&(e.numVisible[n]===void 0&&(e.numVisible[n]=0),e.numVisible[n]+=1);else if(s[u].action==="remove"){let I=A.edits[A.edits.length-1];if(I.action!=="remove")throw new RangeError("last edit has unexpected type");I.count>1?I.count-=1:A.edits.pop(),s[u].action="update",bs(A.edits,a,u,v,k,!0),e&&(e.numVisible[n]+=1)}else bs(A.edits,a,u,v,k,!s[u].action),s[u].action||(s[u].action="update");else o===0&&!s[u].action&&(s[u].action="remove",Fn(A.edits,{action:"remove",index:a,count:1}),e&&(e.numVisible[n]-=1));else(k||!c)&&((b||!A.props[r[K]])&&(A.props[r[K]]={}),k&&(A.props[r[K]][v]=k))}function u0(t,e,n,r,i,s,a){const o=r.nextOp,c=o[we],l=o[ue],f=o[ce],d=l===null?"_root":`${f}@${i.actorIds[l]}`,p=r.actorIndex,u=i.actorIds[p];let b=!1,O=!1,E={},v;({docOp:v,blockIndex:a}=ms(i,a));let k=v===null?0:1,A=v===null?0:v[$e],I=null,y=[],S=[],C=[],N=null;for(r.objectIds.add(d);;){if(y.length===0){b=!1;let U=r.nextOp;for(;!r.done&&U[ye]===p&&U[we]===c&&U[ue]===o[ue]&&U[ce]===o[ce];){const F=y.length>0?y[y.length-1]:null;let z=!1;for(let J=0;J<U[bt];J++)for(let tt of y)U[rn][J]===tt[ye]&&U[sn][J]===tt[ie]&&(z=!0);if(U!==o){if(!(c&&F!==null&&U[K]===null&&U[pe]===F[ye]&&U[ge]===F[ie])){if(!(!c&&F!==null&&U[K]!==null&&U[K]===F[K]&&!z)){if(!(!c&&F!==null&&U[K]===null&&F[K]===null&&U[pe]===F[pe]&&U[ge]===F[ge]&&!z)){if(!(!c&&F===null&&U[K]===null&&v&&v[we]&&v[K]===null&&v[ye]===U[pe]&&v[ie]===U[ge])){if(!(!c&&F===null&&U[K]!==null&&N!==null&&N<U[K]))break}}}}}N=U!==null?U[K]:null,y.push(r.nextOp),S.push(r.columns),C.push(new Array(r.nextOp[bt])),Xl(i,r),U=r.nextOp}}y.length>0&&(I=y[0]);const $=v&&v[ue]===I[ue]&&v[ce]===I[ce],j=v&&v[K]!==null&&v[K]===I[K],R=v&&v[K]===null&&I[K]===null&&(!v[we]&&v[pe]===I[pe]&&v[ge]===I[ge]||v[we]&&v[ye]===I[pe]&&v[ie]===I[ge]);if(y.length===0&&!($&&(j||R)))break;let M=!1,P=0;if(c||!$||v[K]===null&&I[K]!==null||v[K]!==null&&I[K]!==null&&I[K]<v[K]){if(P=y.length,!$&&!b&&I[K]===null&&!I[we])throw new RangeError(`could not find list element with ID: ${I[ge]}@${i.actorIds[I[pe]]}`)}else if(j||R||b){for(let U=0;U<y.length;U++){const F=y[U];for(let z=0;z<F[bt];z++)if(F[rn][z]===v[ye]&&F[sn][z]===v[ie]){let J=0;for(;J<v[$e]&&(v[on][J]<F[ie]||v[on][J]===F[ie]&&i.actorIds[v[hs][J]]<u);)J++;v[on].splice(J,0,F[ie]),v[hs].splice(J,0,p),v[$e]++,C[U][z]=!0;break}}if(R&&(b=!0),b&&!R)P=y.length;else if(y.length===0||v[ie]<I[ie]||v[ie]===I[ie]&&i.actorIds[v[ye]]<u){M=!0,_s(t,e,d,v,i,E,s,A);for(let U=y.length-1;U>=0;U--){let F=!0;for(let z=0;z<y[U][bt];z++)C[U][z]||(F=!1);Qe[y[U][fe]]==="del"&&F&&(y.splice(U,1),S.splice(U,1),C.splice(U,1))}}else{if(v[ie]===I[ie]&&i.actorIds[v[ye]]===u)throw new RangeError(`duplicate operation ID: ${I[ie]}@${u}`);P=1}}else M=!0;if(M&&(Nr(n,i.blocks[a].columns,v),ps(e,v,d,i.actorIds,!1),v[we]&&O&&(O=!1,s++),v[$e]===0&&(O=!0),e.numOps++,{docOp:v,blockIndex:a}=ms(i,a),v!==null&&(k++,A=v[$e])),P>0){for(let U=0;U<P;U++){let F=y[U];for(let z=0;z<F[bt];z++)if(!C[U][z])throw new RangeError(`no matching operation for pred: ${F[sn][z]}@${i.actorIds[F[rn][z]]}`);_s(t,e,d,F,i,E,s),Nr(n,S[U],F),ps(e,F,d,i.actorIds,!0),F[we]?(O=!1,s++):O=!0}P===y.length?(y.length=0,S.length=0,C.length=0):(y.splice(0,P),S.splice(0,P),C.splice(0,P)),e.numOps+=P}}return v&&(Nr(n,i.blocks[a].columns,v),e.numOps++,v[ue]===l&&v[ce]===f&&ps(e,v,d,i.actorIds,!1)),{docOpsConsumed:k,blockIndex:a}}function h0(t,e,n){const[r,i,s,a,o,c,l,f]=e.nextOp,d=r===null?null:n.actorIds[r],p=s===null?null:n.actorIds[s],u={objActor:d,objCtr:i,keyActor:p,keyCtr:a,keyStr:o,idActor:n.actorIds[c],idCtr:l,insert:f,objId:d===null?"_root":`${i}@${d}`},{blockIndex:b,skipCount:O,visibleCount:E}=Gl(n,u),v=n.blocks[b];for(let $ of v.columns)$.decoder.reset();const k=O===0||v.firstVisibleActor===void 0||!f&&v.firstVisibleActor===s&&v.firstVisibleCtr===a,A={columns:void 0,bloom:new Uint8Array(v.bloom),lastKey:tn(v.lastKey),numVisible:tn(v.numVisible),numOps:O,lastObjectActor:v.lastObjectActor,lastObjectCtr:v.lastObjectCtr,firstVisibleActor:k?void 0:v.firstVisibleActor,firstVisibleCtr:k?void 0:v.firstVisibleCtr,lastVisibleActor:void 0,lastVisibleCtr:void 0},I=v.columns.map($=>({columnId:$.columnId,encoder:nn($.columnId)}));an(I,v.columns,O);const{blockIndex:y,docOpsConsumed:S}=u0(t,A,I,e,n,E,b),C=n.blocks[y];let N=-O-S;for(let $=b;$<=y;$++)N+=n.blocks[$].numOps;an(I,C.columns,N),A.numOps+=N;for(let $ of C.columns)if(!$.decoder.done)throw new RangeError(`excess ops in column ${$.columnId}`);if(A.columns=I.map($=>{const j=us($.columnId,$.encoder.buffer);return{columnId:$.columnId,decoder:j}}),b===y&&A.numOps<=Hn)N>0&&v.lastVisibleActor!==void 0&&v.lastVisibleCtr!==void 0&&(A.lastVisibleActor=v.lastVisibleActor,A.lastVisibleCtr=v.lastVisibleCtr),n.blocks[b]=A;else{const $=Jl(A,n.actorIds);n.blocks.splice(b,y-b+1,...$)}}function d0(t,e){if(e[ue].columnId!==te[ue].columnId||te[ue].columnName!=="objActor"||e[ce].columnId!==te[ce].columnId||te[ce].columnName!=="objCtr"||e[pe].columnId!==te[pe].columnId||te[pe].columnName!=="keyActor"||e[ge].columnId!==te[ge].columnId||te[ge].columnName!=="keyCtr"||e[K].columnId!==te[K].columnId||te[K].columnName!=="keyStr"||e[ye].columnId!==te[ye].columnId||te[ye].columnName!=="idActor"||e[ie].columnId!==te[ie].columnId||te[ie].columnName!=="idCtr"||e[we].columnId!==te[we].columnId||te[we].columnName!=="insert"||e[fe].columnId!==te[fe].columnId||te[fe].columnName!=="action"||e[mt].columnId!==te[mt].columnId||te[mt].columnName!=="valLen"||e[St].columnId!==te[St].columnId||te[St].columnName!=="valRaw"||e[bt].columnId!==te[bt].columnId||te[bt].columnName!=="predNum"||e[rn].columnId!==te[rn].columnId||te[rn].columnName!=="predActor"||e[sn].columnId!==te[sn].columnId||te[sn].columnName!=="predCtr")throw new RangeError("unexpected columnId");const n=t.blocks[0].columns;if(!e.every(r=>zl.includes(r.columnId)||n.find(i=>i.columnId===r.columnId))){let r=n.map(i=>({columnId:i.columnId}));for(let i of e){const{columnId:s}=i;!zl.includes(s)&&!n.find(a=>a.columnId===s)&&r.push({columnId:s})}r.sort((i,s)=>i.columnId-s.columnId);for(let i=0;i<t.blocks.length;i++){let s=tn(t.blocks[i]);s.columns=Pn(s.columns.map(a=>({columnId:a.columnId,buffer:a.decoder.buf})),r),t.blocks[i]=s}}}function p0(t,e){if(t.indexOf(e.actorIds[0])<0){if(e.seq!==1)throw new RangeError(`Seq ${e.seq} is the first change for actor ${e.actorIds[0]}`);t=t.concat([e.actorIds[0]])}const n=[];for(let r of e.actorIds){const i=t.indexOf(r);if(i<0)throw new RangeError(`actorId ${r} is not known to document`);n.push(i)}return{actorIds:t,actorTable:n}}function g0(t,e,n){for(let r of e){let i=n.objectMeta[r],s=null,a=!1;for(;;){const o=s&&Object.keys(i.children[s.parentKey]).length>0;if(t[r]||(t[r]=ln(r,i.type)),s&&o)if(i.type==="list"||i.type==="text"){for(let c of t[r].edits)c.opId&&i.children[s.parentKey][c.opId]&&(a=!0);if(!a){const c=kr(r),l=kr(s.parentKey),f={objActor:c.actorId,objCtr:c.counter,keyActor:l.actorId,keyCtr:l.counter,keyStr:null,insert:!1,objId:r},{visibleCount:d}=Gl(n,f);for(let[p,u]of Object.entries(i.children[s.parentKey])){let b=u;u.objectId&&(t[u.objectId]||(t[u.objectId]=ln(u.objectId,u.type)),b=t[u.objectId]);const O={action:"update",index:d,opId:p,value:b};Fn(t[r].edits,O)}}}else{t[r].props[s.parentKey]||(t[r].props[s.parentKey]={});let c=t[r].props[s.parentKey];for(let[l,f]of Object.entries(i.children[s.parentKey]))c[l]?a=!0:f.objectId?(t[f.objectId]||(t[f.objectId]=ln(f.objectId,f.type)),c[l]=t[f.objectId]):c[l]=f}if(a||!i.parentObj||s&&!o)break;s=i,r=i.parentObj,i=n.objectMeta[r]}}return t}function m0(t,e,n,r){let i=new Set(n.heads),s=new Set,a=tn(n.clock),o=[],c=[];for(let l of e){if(n.changeIndexByHash[l.hash]!==void 0||s.has(l.hash))continue;let f=!0;for(let d of l.deps){const p=n.changeIndexByHash[d];(p===void 0||p===-1)&&!s.has(d)&&(f=!1)}if(f){const d=(a[l.actor]||0)+1;if(l.seq!==d)throw new RangeError(`Expected seq ${d}, got seq ${l.seq} from actor ${l.actor}`);a[l.actor]=l.seq,s.add(l.hash);for(let p of l.deps)i.delete(p);i.add(l.hash),o.push(l)}else c.push(l)}if(o.length>0){let l={changes:o,changeIndex:-1,objectIds:r};for(Xl(n,l);!l.done;)h0(t,l,n);n.heads=[...i].sort(),n.clock=a}return[o,c]}function ec(t){for(let f of t.blocks[0].columns)f.decoder.reset();let e={},n=null,r=0,i={_root:{objectId:"_root",type:"map",props:{}}},s=null,a=null,o="_root",c=!1,l=0;for(;{docOp:n,blockIndex:r}=ms(t,r),n!==null;){(n[ue]!==s||n[ce]!==a)&&(o=`${n[ce]}@${t.actorIds[n[ue]]}`,s=n[ue],a=n[ce],e={},l=0,c=!1),n[we]&&c&&(c=!1,l++),n[$e]===0&&(c=!0),n[ie]>t.maxOp&&(t.maxOp=n[ie]);for(let f=0;f<n[$e];f++)n[on][f]>t.maxOp&&(t.maxOp=n[on][f]);_s(i,null,o,n,t,e,l,n[$e])}return i._root}function b0(t){const e=Pn(t.changesColumns,Ne),n=e[0].decoder,r=e[1].decoder,i=e[5].decoder,s=e[6].decoder;if(e[0].columnId!==Ne[0].columnId||Ne[0].columnName!=="actor"||e[1].columnId!==Ne[1].columnId||Ne[1].columnName!=="seq"||e[5].columnId!==Ne[5].columnId||Ne[5].columnName!=="depsNum"||e[6].columnId!==Ne[6].columnId||Ne[6].columnName!=="depsIndex")throw new RangeError("unexpected columnId");let a=0,o={},c=[],l=new Set;for(;!n.done;){const p=n.readValue(),u=r.readValue(),b=i.readValue(),O=t.actorIds[p];if(u!==1&&u!==o[O]+1)throw new RangeError(`Expected seq ${o[O]+1}, got ${u} for actor ${O}`);c.push(p),o[O]=u,l.add(a);for(let E=0;E<b;E++)l.delete(s.readValue());a++}const f=[...l].map(p=>t.actorIds[c[p]]).sort();for(let p of e)p.decoder.reset();const d=e.map(p=>({columnId:p.columnId,encoder:nn(p.columnId)}));return an(d,e,a),{clock:o,headActors:f,encoders:d,numChanges:a}}function _0(t,e,n,r){Nr(t,Ne,[n.indexOf(e.actor),e.seq,e.maxOp,e.time,e.message,e.deps.length,e.deps.map(i=>r[i]),e.extraBytes?e.extraBytes.byteLength<<4|fs.BYTES:fs.BYTES,e.extraBytes])}class ys{constructor(e){if(this.maxOp=0,this.haveHashGraph=!1,this.changes=[],this.changeIndexByHash={},this.dependenciesByHash={},this.dependentsByHash={},this.hashesByActor={},this.actorIds=[],this.heads=[],this.clock={},this.queue=[],this.objectMeta={_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}},e){const n=o0(e),{clock:r,headActors:i,encoders:s,numChanges:a}=b0(n);if(this.binaryDoc=e,this.changes=new Array(a),this.actorIds=n.actorIds,this.heads=n.heads,this.clock=r,this.changesEncoders=s,this.extraBytes=n.extraBytes,n.heads.length===1&&i.length===1&&(this.hashesByActor[i[0]]=[],this.hashesByActor[i[0]][r[i[0]]-1]=n.heads[0]),n.heads.length===n.headsIndexes.length)for(let c=0;c<n.heads.length;c++)this.changeIndexByHash[n.heads[c]]=n.headsIndexes[c];else if(n.heads.length===1)this.changeIndexByHash[n.heads[0]]=a-1;else for(let c of n.heads)this.changeIndexByHash[c]=-1;this.blocks=[{columns:Pn(n.opsColumns,Pl)}],Wl(this.blocks[0],this.actorIds),this.blocks[0].numOps>Hn&&(this.blocks=Jl(this.blocks[0],this.actorIds));let o={blocks:this.blocks,actorIds:this.actorIds,objectMeta:this.objectMeta,maxOp:0};this.initPatch=ec(o),this.maxOp=o.maxOp}else this.haveHashGraph=!0,this.changesEncoders=Ne.map(n=>({columnId:n.columnId,encoder:nn(n.columnId)})),this.blocks=[{columns:Pn([],Pl),bloom:new Uint8Array(Fl),lastKey:{},numVisible:{},numOps:0,lastObjectActor:void 0,lastObjectCtr:void 0,firstVisibleActor:void 0,firstVisibleCtr:void 0,lastVisibleActor:void 0,lastVisibleCtr:void 0}]}clone(){let e=new ys;return e.maxOp=this.maxOp,e.haveHashGraph=this.haveHashGraph,e.changes=this.changes.slice(),e.changeIndexByHash=tn(this.changeIndexByHash),e.dependenciesByHash=tn(this.dependenciesByHash),e.dependentsByHash=Object.entries(this.dependentsByHash).reduce((n,[r,i])=>(n[r]=i.slice(),n),{}),e.hashesByActor=Object.entries(this.hashesByActor).reduce((n,[r,i])=>(n[r]=i.slice(),n),{}),e.actorIds=this.actorIds,e.heads=this.heads,e.clock=this.clock,e.blocks=this.blocks,e.objectMeta=this.objectMeta,e.queue=this.queue,e}applyChanges(e,n=!1){let r=e.map(f=>{const d=r0(f);return d.buffer=f,d}),i={_root:{objectId:"_root",type:"map",props:{}}},s={maxOp:this.maxOp,changeIndexByHash:this.changeIndexByHash,actorIds:this.actorIds,heads:this.heads,clock:this.clock,blocks:this.blocks.slice(),objectMeta:Object.assign({},this.objectMeta)},a=this.queue.length===0?r:r.concat(this.queue),o=[],c=new Set;for(;;){const[f,d]=m0(i,a,s,c);if(a=d,f.length>0&&(o=o.concat(f)),a.length===0)break;if(f.length===0)if(!this.haveHashGraph)this.computeHashGraph();else break}g0(i,c,s);for(let f of o){this.changes.push(f.buffer),this.hashesByActor[f.actor]||(this.hashesByActor[f.actor]=[]),this.hashesByActor[f.actor][f.seq-1]=f.hash,this.changeIndexByHash[f.hash]=this.changes.length-1,this.dependenciesByHash[f.hash]=f.deps,this.dependentsByHash[f.hash]=[];for(let d of f.deps)this.dependentsByHash[d]||(this.dependentsByHash[d]=[]),this.dependentsByHash[d].push(f.hash);_0(this.changesEncoders,f,s.actorIds,this.changeIndexByHash)}this.maxOp=s.maxOp,this.actorIds=s.actorIds,this.heads=s.heads,this.clock=s.clock,this.blocks=s.blocks,this.objectMeta=s.objectMeta,this.queue=a,this.binaryDoc=null,this.initPatch=null;let l={maxOp:this.maxOp,clock:this.clock,deps:this.heads,pendingChanges:this.queue.length,diffs:i._root};return n&&r.length===1&&(l.actor=r[0].actor,l.seq=r[0].seq),l}computeHashGraph(){const e=this.save();this.haveHashGraph=!0,this.changes=[],this.changeIndexByHash={},this.dependenciesByHash={},this.dependentsByHash={},this.hashesByActor={},this.clock={};for(let n of s0([e])){const r=n0(n);this.changes.push(r),this.changeIndexByHash[n.hash]=this.changes.length-1,this.dependenciesByHash[n.hash]=n.deps,this.dependentsByHash[n.hash]=[];for(let s of n.deps)this.dependentsByHash[s].push(n.hash);n.seq===1&&(this.hashesByActor[n.actor]=[]),this.hashesByActor[n.actor].push(n.hash);const i=(this.clock[n.actor]||0)+1;if(n.seq!==i)throw new RangeError(`Expected seq ${i}, got seq ${n.seq} from actor ${n.actor}`);this.clock[n.actor]=n.seq}}getChanges(e){if(this.haveHashGraph||this.computeHashGraph(),e.length===0)return this.changes.slice();let n=[],r={},i=[];for(let s of e){r[s]=!0;const a=this.dependentsByHash[s];if(!a)throw new RangeError(`hash not found: ${s}`);n.push(...a)}for(;n.length>0;){const s=n.pop();if(r[s]=!0,i.push(s),!this.dependenciesByHash[s].every(a=>r[a]))break;n.push(...this.dependentsByHash[s])}if(n.length===0&&this.heads.every(s=>r[s]))return i.map(s=>this.changes[this.changeIndexByHash[s]]);for(n=e.slice(),r={};n.length>0;){const s=n.pop();if(!r[s]){const a=this.dependenciesByHash[s];if(!a)throw new RangeError(`hash not found: ${s}`);n.push(...a),r[s]=!0}}return this.changes.filter(s=>!r[i0(s,!0).hash])}getChangesAdded(e){this.haveHashGraph||this.computeHashGraph();let n=this.heads.slice(),r={},i=[];for(;n.length>0;){const s=n.pop();!r[s]&&e.changeIndexByHash[s]===void 0&&(r[s]=!0,i.push(s),n.push(...this.dependenciesByHash[s]))}return i.reverse().map(s=>this.changes[this.changeIndexByHash[s]])}getChangeByHash(e){return this.haveHashGraph||this.computeHashGraph(),this.changes[this.changeIndexByHash[e]]}getMissingDeps(e=[]){this.haveHashGraph||this.computeHashGraph();let n=new Set(e),r=new Set;for(let s of this.queue){r.add(s.hash);for(let a of s.deps)n.add(a)}let i=[];for(let s of n)this.changeIndexByHash[s]===void 0&&!r.has(s)&&i.push(s);return i.sort()}save(){if(this.binaryDoc)return this.binaryDoc;const e=this.changesEncoders.map(r=>({columnId:r.columnId,encoder:nn(r.columnId)})),n=this.changesEncoders.map(r=>{const i=us(r.columnId,r.encoder.buffer);return{columnId:r.columnId,decoder:i}});return an(e,n,this.changes.length),this.binaryDoc=a0({changesColumns:this.changesEncoders,opsColumns:c0(this.blocks),actorIds:this.actorIds,heads:this.heads,headsIndexes:this.heads.map(r=>this.changeIndexByHash[r]),extraBytes:this.extraBytes}),this.changesEncoders=e,this.binaryDoc}getPatch(){const e={_root:{parentObj:null,parentKey:null,opId:null,type:"map",children:{}}},n={blocks:this.blocks,actorIds:this.actorIds,objectMeta:e,maxOp:0},r=this.initPatch?this.initPatch:ec(n);return{maxOp:this.maxOp,clock:this.clock,deps:this.heads,pendingChanges:this.queue.length,diffs:r}}}var y0={MAX_BLOCK_SIZE:Hn,BackendDoc:ys,bloomFilterContains:Yl};function w0(t){if(t.frozen)throw new Error("Attempting to use an outdated Automerge document that has already been updated. Please use the latest document state, or call Automerge.clone() if you really need to use this old document state.");return t.state}var v0={backendState:w0};const{encodeChange:x0}=Tr,{BackendDoc:tc}=y0,{backendState:De}=v0;function I0(){return{state:new tc,heads:[]}}function E0(t){return{state:De(t).clone(),heads:t.heads}}function O0(t){t.state=null,t.frozen=!0}function A0(t,e){const n=De(t),r=n.applyChanges(e);return t.frozen=!0,[{state:n,heads:n.heads},r]}function nc(t,e,n){if(t.hashesByActor[e]&&t.hashesByActor[e][n]||!t.haveHashGraph&&(t.computeHashGraph(),t.hashesByActor[e]&&t.hashesByActor[e][n]))return t.hashesByActor[e][n];throw new RangeError(`Unknown change: actorId = ${e}, seq = ${n+1}`)}function C0(t,e){const n=De(t);if(e.seq<=n.clock[e.actor])throw new RangeError("Change request has already been applied");if(e.seq>1){const a=nc(n,e.actor,e.seq-2);if(!a)throw new RangeError(`Cannot find hash of localChange before seq=${e.seq}`);let o={[a]:!0};for(let c of e.deps)o[c]=!0;e.deps=Object.keys(o).sort()}const r=x0(e),i=n.applyChanges([r],!0);t.frozen=!0;const s=nc(n,e.actor,e.seq-1);return i.deps=i.deps.filter(a=>a!==s),[{state:n,heads:n.heads},i,r]}function R0(t){return De(t).save()}function T0(t){const e=new tc(t);return{state:e,heads:e.heads}}function k0(t,e){const n=De(t);return n.applyChanges(e),t.frozen=!0,{state:n,heads:n.heads}}function S0(t){return De(t).getPatch()}function N0(t){return t.heads}function $0(t){return rc(t,[])}function rc(t,e){if(!Array.isArray(e))throw new TypeError("Pass an array of hashes to Backend.getChanges()");return De(t).getChanges(e)}function D0(t,e){return De(e).getChangesAdded(De(t))}function j0(t,e){return De(t).getChangeByHash(e)}function B0(t,e=[]){return De(t).getMissingDeps(e)}var ic={init:I0,clone:E0,free:O0,applyChanges:A0,applyLocalChange:C0,save:R0,load:T0,loadChanges:k0,getPatch:S0,getHeads:N0,getAllChanges:$0,getChanges:rc,getChangesAdded:D0,getChangeByHash:j0,getMissingDeps:B0};const je=ic,{hexStringToBytes:sc,bytesToHexString:L0,Encoder:ws,Decoder:vs}=pl,{decodeChangeMeta:$r}=Tr,{copyObject:V0}=Be,oc=32,ac=66,lc=67,U0=10,M0=7;class xs{constructor(e){if(Array.isArray(e)){this.numEntries=e.length,this.numBitsPerEntry=U0,this.numProbes=M0,this.bits=new Uint8Array(Math.ceil(this.numEntries*this.numBitsPerEntry/8));for(let n of e)this.addHash(n)}else if(e instanceof Uint8Array)if(e.byteLength===0)this.numEntries=0,this.numBitsPerEntry=0,this.numProbes=0,this.bits=e;else{const n=new vs(e);this.numEntries=n.readUint32(),this.numBitsPerEntry=n.readUint32(),this.numProbes=n.readUint32(),this.bits=n.readRawBytes(Math.ceil(this.numEntries*this.numBitsPerEntry/8))}else throw new TypeError("invalid argument")}get bytes(){if(this.numEntries===0)return new Uint8Array(0);const e=new ws;return e.appendUint32(this.numEntries),e.appendUint32(this.numBitsPerEntry),e.appendUint32(this.numProbes),e.appendRawBytes(this.bits),e.buffer}getProbes(e){const n=sc(e),r=8*this.bits.byteLength;if(n.byteLength!==32)throw new RangeError(`Not a 256-bit hash: ${e}`);let i=((n[0]|n[1]<<8|n[2]<<16|n[3]<<24)>>>0)%r,s=((n[4]|n[5]<<8|n[6]<<16|n[7]<<24)>>>0)%r,a=((n[8]|n[9]<<8|n[10]<<16|n[11]<<24)>>>0)%r;const o=[i];for(let c=1;c<this.numProbes;c++)i=(i+s)%r,s=(s+a)%r,o.push(i);return o}addHash(e){for(let n of this.getProbes(e))this.bits[n>>>3]|=1<<(n&7)}containsHash(e){if(this.numEntries===0)return!1;for(let n of this.getProbes(e))if((this.bits[n>>>3]&1<<(n&7))==0)return!1;return!0}}function Dr(t,e){if(!Array.isArray(e))throw new TypeError("hashes must be an array");t.appendUint32(e.length);for(let n=0;n<e.length;n++){if(n>0&&e[n-1]>=e[n])throw new RangeError("hashes must be sorted");const r=sc(e[n]);if(r.byteLength!==oc)throw new TypeError("heads hashes must be 256 bits");t.appendRawBytes(r)}}function jr(t){let e=t.readUint32(),n=[];for(let r=0;r<e;r++)n.push(L0(t.readRawBytes(oc)));return n}function Is(t){const e=new ws;e.appendByte(ac),Dr(e,t.heads),Dr(e,t.need),e.appendUint32(t.have.length);for(let n of t.have)Dr(e,n.lastSync),e.appendPrefixedBytes(n.bloom);e.appendUint32(t.changes.length);for(let n of t.changes)e.appendPrefixedBytes(n);return e.buffer}function cc(t){const e=new vs(t),n=e.readByte();if(n!==ac)throw new RangeError(`Unexpected message type: ${n}`);const r=jr(e),i=jr(e),s=e.readUint32();let a={heads:r,need:i,have:[],changes:[]};for(let c=0;c<s;c++){const l=jr(e),f=e.readPrefixedBytes(e);a.have.push({lastSync:l,bloom:f})}const o=e.readUint32();for(let c=0;c<o;c++){const l=e.readPrefixedBytes();a.changes.push(l)}return a}function P0(t){const e=new ws;return e.appendByte(lc),Dr(e,t.sharedHeads),e.buffer}function H0(t){const e=new vs(t),n=e.readByte();if(n!==lc)throw new RangeError(`Unexpected record type: ${n}`);const r=jr(e);return Object.assign(fc(),{sharedHeads:r})}function F0(t,e){const r=je.getChanges(t,e).map(i=>$r(i,!0).hash);return{lastSync:e,bloom:new xs(r).bytes}}function z0(t,e,n){if(e.length===0)return n.map(d=>je.getChangeByHash(t,d)).filter(d=>d!==void 0);let r={},i=[];for(let d of e){for(let p of d.lastSync)r[p]=!0;i.push(new xs(d.bloom))}const s=je.getChanges(t,Object.keys(r)).map(d=>$r(d,!0));let a={},o={},c={};for(let d of s){a[d.hash]=!0;for(let p of d.deps)o[p]||(o[p]=[]),o[p].push(d.hash);i.every(p=>!p.containsHash(d.hash))&&(c[d.hash]=!0)}let l=Object.keys(c);for(;l.length>0;){const d=l.pop();if(o[d])for(let p of o[d])c[p]||(c[p]=!0,l.push(p))}let f=[];for(let d of n)if(c[d]=!0,!a[d]){const p=je.getChangeByHash(t,d);p&&f.push(p)}for(let d of s)c[d.hash]&&f.push(d.change);return f}function fc(){return{sharedHeads:[],lastSentHeads:[],theirHeads:null,theirNeed:null,theirHave:null,sentHashes:{}}}function Es(t,e){return t.length===e.length&&t.every((n,r)=>n===e[r])}function Z0(t,e){if(!t)throw new Error("generateSyncMessage called with no Automerge document");if(!e)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:n,lastSentHeads:r,theirHeads:i,theirNeed:s,theirHave:a,sentHashes:o}=e;const c=je.getHeads(t),l=je.getMissingDeps(t,i||[]);let f=[];if((!i||l.every(O=>i.includes(O)))&&(f=[F0(t,n)]),a&&a.length>0&&!a[0].lastSync.every(E=>je.getChangeByHash(t,E))){const E={heads:c,need:[],have:[{lastSync:[],bloom:new Uint8Array(0)}],changes:[]};return[e,Is(E)]}let d=Array.isArray(a)&&Array.isArray(s)?z0(t,a,s):[];const p=Array.isArray(r)&&Es(c,r),u=Array.isArray(i)&&Es(c,i);if(p&&u&&d.length===0)return[e,null];d=d.filter(O=>!o[$r(O,!0).hash]);const b={heads:c,have:f,need:l,changes:d};if(d.length>0){o=V0(o);for(const O of d)o[$r(O,!0).hash]=!0}return e=Object.assign({},e,{lastSentHeads:c,sentHashes:o}),[e,Is(b)]}function q0(t,e,n){const r=e.filter(a=>!t.includes(a)),i=n.filter(a=>e.includes(a));return[...new Set([...r,...i])].sort()}function G0(t,e,n){if(!t)throw new Error("generateSyncMessage called with no Automerge document");if(!e)throw new Error("generateSyncMessage requires a syncState, which can be created with initSyncState()");let{sharedHeads:r,lastSentHeads:i,sentHashes:s}=e,a=null;const o=cc(n),c=je.getHeads(t);o.changes.length>0&&([t,a]=je.applyChanges(t,o.changes),r=q0(c,je.getHeads(t),r)),o.changes.length===0&&Es(o.heads,c)&&(i=o.heads);const l=o.heads.filter(d=>je.getChangeByHash(t,d));l.length===o.heads.length?(r=o.heads,o.heads.length===0&&(i=[],s=[])):r=[...new Set(l.concat(r))].sort();const f={sharedHeads:r,lastSentHeads:i,theirHave:o.have,theirHeads:o.heads,theirNeed:o.need,sentHashes:s};return[t,f,a]}var K0={receiveSyncMessage:G0,generateSyncMessage:Z0,encodeSyncMessage:Is,decodeSyncMessage:cc,initSyncState:fc,encodeSyncState:P0,decodeSyncState:H0,BloomFilter:xs};const{init:Y0,clone:W0,free:J0,applyChanges:X0,applyLocalChange:Q0,save:eg,load:tg,loadChanges:ng,getPatch:rg,getHeads:ig,getAllChanges:sg,getChanges:og,getChangesAdded:ag,getChangeByHash:lg,getMissingDeps:cg}=ic,{receiveSyncMessage:fg,generateSyncMessage:ug,encodeSyncMessage:hg,decodeSyncMessage:dg,encodeSyncState:pg,decodeSyncState:gg,initSyncState:mg}=K0;var bg={init:Y0,clone:W0,free:J0,applyChanges:X0,applyLocalChange:Q0,save:eg,load:tg,loadChanges:ng,getPatch:rg,getHeads:ig,getAllChanges:sg,getChanges:og,getChangesAdded:ag,getChangeByHash:lg,getMissingDeps:cg,receiveSyncMessage:fg,generateSyncMessage:ug,encodeSyncMessage:hg,decodeSyncMessage:dg,encodeSyncState:pg,decodeSyncState:gg,initSyncState:mg};(function(t){const e=fi,n=yh,{OPTIONS:r}=ot,{encodeChange:i,decodeChange:s}=Tr,{isObject:a}=Be;let o=bg;function c(R){if(typeof R=="string")R={actorId:R};else if(typeof R=="undefined")R={};else if(!a(R))throw new TypeError(`Unsupported options for init(): ${R}`);return n.init(Object.assign({backend:o},R))}function l(R,M){const P={message:"Initialization"};return f(c(M),P,U=>Object.assign(U,R))}function f(R,M,P){const[U]=n.change(R,M,P);return U}function d(R,M){const[P]=n.emptyChange(R,M);return P}function p(R,M={}){const P=o.clone(n.getBackendState(R,"clone"));return A(c(M),o.getPatch(P),P,[],M)}function u(R){o.free(n.getBackendState(R,"free"))}function b(R,M={}){const P=o.load(R);return A(c(M),o.getPatch(P),P,[R],M)}function O(R){return o.save(n.getBackendState(R,"save"))}function E(R,M){const P=n.getBackendState(R,"merge"),U=n.getBackendState(M,"merge","second");if(n.getActorId(R)===n.getActorId(M))throw new RangeError("Cannot merge an actor with itself");const F=o.getChangesAdded(P,U),[z]=I(R,F);return z}function v(R,M){const P=n.getBackendState(R,"getChanges"),U=n.getBackendState(M,"getChanges","second");return o.getChanges(U,o.getHeads(P))}function k(R){return o.getAllChanges(n.getBackendState(R,"getAllChanges"))}function A(R,M,P,U,F){const z=n.applyPatch(R,M,P),J=F.patchCallback||R[r].patchCallback;return J&&J(M,R,z,!1,U),z}function I(R,M,P={}){const U=n.getBackendState(R,"applyChanges"),[F,z]=o.applyChanges(U,M);return[A(R,z,F,M,P),z]}function y(R,M){if(!a(R)||!a(M))return R===M;const P=Object.keys(R).sort(),U=Object.keys(M).sort();if(P.length!==U.length)return!1;for(let F=0;F<P.length;F++)if(P[F]!==U[F]||!y(R[P[F]],M[U[F]]))return!1;return!0}function S(R){const M=n.getActorId(R),P=k(R);return P.map((U,F)=>({get change(){return s(U)},get snapshot(){const z=o.loadChanges(o.init(),P.slice(0,F+1));return n.applyPatch(c(M),o.getPatch(z),z)}}))}function C(R,M){const P=n.getBackendState(R,"generateSyncMessage");return o.generateSyncMessage(P,M)}function N(R,M,P){const U=n.getBackendState(R,"receiveSyncMessage"),[F,z,J]=o.receiveSyncMessage(U,M,P);if(!J)return[R,z,J];let tt=null;return R[r].patchCallback&&(tt=o.decodeSyncMessage(P).changes),[A(R,J,F,tt,{}),z,J]}function $(){return o.initSyncState()}function j(R){o=R}t.exports={init:c,from:l,change:f,emptyChange:d,clone:p,free:u,load:b,save:O,merge:E,getChanges:v,getAllChanges:k,applyChanges:I,encodeChange:i,decodeChange:s,equals:y,getHistory:S,uuid:e,Frontend:n,setDefaultBackend:j,generateSyncMessage:C,receiveSyncMessage:N,initSyncState:$,get Backend(){return o}};for(let R of["getObjectId","getObjectById","getActorId","setActorId","getConflicts","getLastLocalChange","Text","Table","Counter","Observable","Int","Uint","Float64"])t.exports[R]=n[R]})(oo);var et=oo.exports,qe;(function(t){t.Init="init",t.Get="get",t.Changes="changes"})(qe||(qe={}));class Nm extends Bt.exports.EventEmitter{constructor(e,n,r){super();Y(this,"name");Y(this,"state");Y(this,"room");Y(this,"opened",!1);Y(this,"initted",!1);Y(this,"changeFns",[]);Y(this,"changes",[]);Y(this,"onOpen",()=>{this.opened||(this.opened=!0,this.initted=!1,this.room.on(Q.Message,this.onData),this.room.on(Q.Close,this.onClose),this.room.isServer()?this.room.broadcast(qe.Init,{name:this.name,raw:Br(et.save(this.state))}):this.room.broadcast(qe.Get,{name:this.name}))});Y(this,"onClose",()=>{this.opened&&(this.opened=!1,this.room.off(Q.Message,this.onData),this.room.off(Q.Close,this.onClose))});Y(this,"onData",(e,n)=>{if(Ce(n,qe.Changes)&&n.payload.name===this.name)if(this.initted){const[r]=et.applyChanges(this.state,this.changes.concat(n.payload.changes.map(uc)));this.changes.length=0,this.state=r,this.emit("update",r)}else this.changes.push(...n.payload.changes.map(uc));else if(Ce(n,qe.Init)&&n.payload.name===this.name){const r=et.load(_g(n.payload.raw));let i=r;this.changeFns.length&&(i=[...this.changeFns].reduce((a,o)=>et.change(a,o),i),this.changeFns.length=0),this.initted=!0,this.state=i,this.emit("update",i);const s=et.getChanges(r,i).map(Br);s.length&&this.room.broadcast(qe.Changes,{name:this.name,changes:s})}else this.room.isServer()&&e!==this.room.getPeer().getId()&&Ce(n,qe.Get)&&n.payload.name===this.name&&this.room.send(e,qe.Init,{name:this.name,raw:Br(et.save(this.state))})});this.name=e,this.room=n,this.state=et.from(r),n.isOpen()?this.onOpen():this.room.on(Q.Open,this.onOpen)}get(){return this.state}change(e){if(this.initted){const n=this.state,r=et.change(n,e),i=et.getChanges(n,r).map(Br);this.state=r,i.length&&this.room.broadcast(qe.Changes,{name:this.name,changes:i})}else this.changeFns.push(e);return this}}function Br(t){const e=new Array(t.length);for(let n=0,r=t.length;n<r;n++)e[n]=t[n];return e}function uc(t){const e=new Uint8Array(t);return e.__binaryChange=!0,e}function _g(t){const e=new Uint8Array(t);return e.__binaryDocument=!0,e}const Nt=Math.pow(2,31)-1|0;function yg(t){return t!=null&&typeof t.toJS=="function"?t.toJS():t}function wg(t){return t!=null&&typeof t.toJSON=="function"?t.toJSON():t}const Os={},Lr={};class Vr{constructor(e,n){if(e!==Os)throw new TypeError("Options can only be created with the some or none functions");this._value=n}static some(e){return me(e)}static none(){return be()}static from(e){return e!=null?me(e):be()}static fromResult(e){return e.isOk()?me(e.unwrap()):be()}isNone(){return this._value===Lr}isSome(){return!this.isNone()}expect(e){if(this.isSome())return this._value;throw new Error(typeof e=="function"?e():e)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(e){return this.isSome()?this._value:e}unwrapOrElse(e){return this.isSome()?this._value:e()}map(e){return this.isSome()?me(e(this._value)):be()}mapOr(e,n){return this.isSome()?me(e(this._value)):me(n)}mapOrElse(e,n){return this.isSome()?me(e(this._value)):me(n())}flatMap(e){return this.isSome()?e(this._value):be()}flatMapOr(e,n){return this.isSome()?e(this._value):n}flatMapOrElse(e,n){return this.isSome()?e(this._value):n()}and(e){return this.isSome()?e:be()}andThen(e){return this.isSome()?e(this._value):be()}or(e){return this.isNone()?e:this}orElse(e){return this.isNone()?e():this}xor(e){const n=this.isSome(),r=e.isSome();return n&&!r?this:!n&&r?e:be()}filter(e){return this.isSome()&&e(this._value)?this:be()}getOrInsert(e){return this.isNone()&&(this._value=e),this}getOrInsertWith(e){return this.isNone()&&(this._value=e()),this}take(){if(this.isSome()){const e=this._value;return this._value=Lr,me(e)}else return be()}from(e){return e!=null?this._value=e:this.clear(),this}replace(e){return this._value=e,this}clear(){return this._value=Lr,this}fromResult(e){return e.isOk()?me(e.unwrap()):be()}ifSome(e,n){return this.isSome()?e(this._value):n&&n(),this}ifNone(e,n){return this.isNone()?e():n&&n(this._value),this}fromJSON(e){return Vr.from(e)}toJSON(){return this.map(wg).unwrapOr(null)}toJS(){return this.map(yg).unwrapOr(null)}}const me=t=>new Vr(Os,t),be=()=>new Vr(Os,Lr);class W{constructor(e){this._index=0,this._iter=e}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){const e=this._iter.next();return e.done?e:{value:[e.value,this._index++]}}enumerate(){throw new Error("iter/Enumerate was not imported!")}peekable(){throw new Error("iter/Peekable was not imported!")}forEach(e){throw new Error("iter/ForEach was not imported!")}map(e){throw new Error("iter/Map was not imported!")}merge(e){throw new Error("iter/Merge was not imported!")}concat(e){return this.merge(e)}filter(e){throw new Error("iter/Filter was not imported!")}step(e){throw new Error("iter/Step was not imported!")}skip(e){throw new Error("iter/Skip was not imported!")}take(e){throw new Error("iter/Take was not imported!")}toMap(e,n){throw new Error("iter/ToMap was not imported!")}count(){return this.reduce(0,e=>e+1)}consume(){let e=this.next();for(;!e.done;)e=this.next();return this}toArray(){return this.reduce([],(e,n)=>(e.push(n),e))}join(e){return this.toArray().join(e)}indexOf(e){let n=this.next(),r=0;for(;!n.done;){if(n.value===e)return r;r++,n=this.next()}return-1}findIndex(e){let n=this.nextWithIndex();for(;!n.done;){const[r,i]=n.value;if(e(r,i))return i;n=this.nextWithIndex()}return-1}find(e){let n=this.nextWithIndex();for(;!n.done;){const[r,i]=n.value;if(e(r,i))return me(r);n=this.nextWithIndex()}return be()}findAll(e){return this.filter(e)}nth(e=0){let n=this.next();for(e<0&&(e=0);!n.done;){if(e--<=0)return me(n.value);n=this.next()}return be()}first(){return this.nth(0)}last(){let e=this.next();for(;!e.done;){const n=this.next();if(n.done)return me(e.value);e=n}return be()}any(e){return this.findIndex(e)!==-1}some(e){return this.any(e)}none(e){return this.findIndex(e)===-1}all(e){let n=this.nextWithIndex();for(;!n.done;){const[r,i]=n.value;if(!e(r,i))return!1;n=this.nextWithIndex()}return!0}unflatten(e){throw new Error("iter/Unflatten was not imported!")}reduce(e,n){let r=this.next();for(;!r.done;){const i=r.value;e=n(e,i,this._index-1),r=this.next()}return e}reverse(){return Ur(this.toArray().reverse())}}function Ur(t){return t!=null?typeof t[Symbol.iterator]=="function"?new W(t[Symbol.iterator]()):typeof t.next=="function"?t instanceof W?t:new W(t):Ur(typeof t=="object"?Object.entries(t):[t]):Ur([])}class vg extends W{constructor(e){super(e)}next(){const e=super.nextWithIndex();return e.done?e:{value:xg(e.value)}}}W.prototype.enumerate=function(){return new vg(this)};function xg(t){const e=t[0],n=t;return n[0]=t[1],n[1]=e,n}class Ig extends W{constructor(e,n){super(e);this._fn=n}next(){let e=super.nextWithIndex();for(;!e.done;){const[n,r]=e.value;if(this._fn(n,r))return{done:!1,value:n};e=super.nextWithIndex()}return{done:!0,value:void 0}}}W.prototype.filter=function(e){return new Ig(this,e)};class Eg extends W{constructor(e,n){super(e);this._fn=([r,i])=>(n(r,i),r)}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._fn(e.value)}}}W.prototype.forEach=function(e){return new Eg(this,e)};class Og extends W{constructor(e,n){super(e);this._fn=([r,i])=>n(r,i)}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._fn(e.value)}}}W.prototype.map=function(e){return new Og(this,e)};class Ag extends W{constructor(e,n){super(e);this._other=n}next(){const e=super.next();return e.done?this._other.next():e}}W.prototype.merge=function(e){return new Ag(this,e)};class Cg extends W{constructor(){super(...arguments);this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?me(this.peeked.shift()):be()}peek(e=0){if(e<this.peeked.length)return me(this.peeked[e]);{let n=this.peeked.length-e-1,r=super.next();for(;!r.done&&(this.peeked.push(r.value),!(--n<=0));)r=super.next();return r.done?be():me(r.value)}}next(){const e=this.unpeek();if(e.isSome())return{done:!1,value:e.unwrap()};const n=super.next();return n.done?n:{done:!1,value:n.value}}}W.prototype.peekable=function(){return new Cg(this)};class Rg extends W{constructor(e,n){super(e);this._skipped=0,this._skip=(n<=0?0:n)|0}next(){let e=super.next();for(;!e.done;)if(this._skipped<=this._skip)this._skipped+=1,e=super.next();else return e;return{done:!0,value:void 0}}}W.prototype.skip=function t(t){return new Rg(this,t)};class Tg extends W{constructor(e,n){super(e);this._stepped=0,this._step=n<=0?1:n|0}next(){let e=super.next();for(;!e.done;)if(this._stepped<this._step)this._stepped+=1,e=super.next();else return this._stepped=0,e;return{done:!0,value:void 0}}}W.prototype.step=function t(t){return new Tg(this,t)};class kg extends W{constructor(e,n){super(e);this._taken=0,this._count=(n<=0?0:n)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}W.prototype.take=function(e){return new kg(this,e)};const Sg=t=>t,Ng=t=>t;class $g extends W{constructor(e,n=Sg,r=Ng){super(e);this._map=([i,s])=>[n(i,s),r(i,s)]}toObject(){return this.reduce({},(e,n)=>(e[n[0]]=n[1],e))}next(){const e=super.nextWithIndex();return e.done?e:{done:!1,value:this._map(e.value)}}}W.prototype.toMap=function(e,n){return new $g(this,e,n)};class Dg extends W{constructor(e,n){super(e);this._fn=n}next(){return this._fn(this._iter)}}W.prototype.unflatten=function(e){return new Dg(this,e)};var cn;(function(t){t[t.Forward=0]="Forward",t[t.Backward=1]="Backward"})(cn||(cn={}));class As{constructor(e,n,r=1){this.start=e,this.end=n,this.step=Math.abs(r),this.direction=e>n?cn.Backward:cn.Forward}static from(e,n,r=1){return new As(e,n,r)}getStart(){return this.start}getEnd(){return this.end}getStep(){return this.step}getDirection(){return this.direction}contains(e){return this.start<=e&&e<=this.end}isEmpty(){return this.direction===cn.Forward?this.start>this.end:this.start<this.end}iter(){return new W(this)}[Symbol.iterator](){return this}next(){if(this.isEmpty())return{done:!0,value:void 0};{const e=this.start;return this.direction===cn.Forward?this.start+=this.step:this.start-=this.step,{done:!1,value:e}}}}const $m=As.from;class jg extends W{constructor(e){super(e);this.rng=e}[Symbol.iterator](){return this}iter(){return new W(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class Bg extends W{constructor(e,n=0,r=1){super(e);this.rng=e,this.min=n,this.max=r}[Symbol.iterator](){return this}iter(){return new W(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class Lg extends W{constructor(e,n=0,r=Nt){super(e);this.rng=e,this.min=n|0,this.max=r|0}[Symbol.iterator](){return this}iter(){return new W(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const Vg=new Uint8Array(4);class Cs{nextFloat(){return this.nextInt()/Nt}nextFloatInRange(e=0,n=1){return e+this.nextFloat()*(n-e)}nextIntInRange(e=0,n=Nt){return Math.round(this.nextFloatInRange(e,n))}shuffle(e){const n=e.length;for(let r=0;r<n;r++){const i=r+this.nextIntInRange(0,n-r-1),s=e[r];e[r]=e[i],e[i]=s}return e}fromArray(e){return e.length?me(e[this.nextIntInRange(0,e.length-1)]):be()}keyFromObject(e){return this.fromArray(Object.keys(e))}valueFromObject(e){return this.fromArray(Object.values(e))}fillBytes(e){const n=Vg;for(let r=0,i=e.length;r<i;r++){const s=r%4;s===0&&Ug(n,this.nextInt()),e[r]=n[s]}return e}[Symbol.iterator](){return this}iter(){return new W(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new jg(this)}uniformFloat(e=0,n=1){return new Bg(this,e,n)}uniformInt(e=0,n=Nt){return new Lg(this,e,n)}}function Ug(t,e){return t[0]=(e&4278190080)>>24,t[1]=(e&16711680)>>16,t[2]=(e&65280)>>8,t[3]=e&255,t}class Mg extends Cs{nextInt(){return Math.random()*Nt|0}nextFloat(){return Math.random()}}class hc extends Cs{constructor(e=423257940){super();this.seed=e}setSeed(e=423257940){return this.seed=e,this}nextInt(){return this.seed=Math.imul(48271,this.seed)|0%Nt,this.seed&Nt}}const Pg=new hc;class Rs extends Cs{constructor(e,n,r,i){super();this.x=423257940,this.y=2829571177,this.z=2541948421,this.w=289122235,this.set(e,n,r,i)}static fromSeed(e){return new Rs().setSeed(e)}setSeed(e){const n=Pg.setSeed(e);return this.set(n.nextInt(),n.nextInt(),n.nextInt(),n.nextInt())}set(e=423257940,n=2829571177,r=2541948421,i=289122235){return this.x=e|0,this.y=n|0,this.z=r|0,this.w=i|0,this}nextInt(){const e=this.x,n=e^e<<11;this.x=this.y,this.y=this.z,this.z=this.w;const r=this.w;return this.w=r^r>>19^(n^n>>8),this.w}}new hc;new Rs;const Hg=new Mg;let Fg=Hg;function Dm(){return Fg.nextFloat()}var zg={exports:{}};/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/(function(t,e){(function(n){t.exports=n()})(function(){return function n(r,i,s){function a(l,f){if(!i[l]){if(!r[l]){var d=typeof Jn=="function"&&Jn;if(!f&&d)return d(l,!0);if(o)return o(l,!0);var p=new Error("Cannot find module '"+l+"'");throw p.code="MODULE_NOT_FOUND",p}var u=i[l]={exports:{}};r[l][0].call(u.exports,function(b){var O=r[l][1][b];return a(O||b)},u,u.exports,n,r,i,s)}return i[l].exports}for(var o=typeof Jn=="function"&&Jn,c=0;c<s.length;c++)a(s[c]);return a}({1:[function(n,r,i){(function(s){var a=s.MutationObserver||s.WebKitMutationObserver,o;if(a){var c=0,l=new a(b),f=s.document.createTextNode("");l.observe(f,{characterData:!0}),o=function(){f.data=c=++c%2}}else if(!s.setImmediate&&typeof s.MessageChannel!="undefined"){var d=new s.MessageChannel;d.port1.onmessage=b,o=function(){d.port2.postMessage(0)}}else"document"in s&&"onreadystatechange"in s.document.createElement("script")?o=function(){var E=s.document.createElement("script");E.onreadystatechange=function(){b(),E.onreadystatechange=null,E.parentNode.removeChild(E),E=null},s.document.documentElement.appendChild(E)}:o=function(){setTimeout(b,0)};var p,u=[];function b(){p=!0;for(var E,v,k=u.length;k;){for(v=u,u=[],E=-1;++E<k;)v[E]();k=u.length}p=!1}r.exports=O;function O(E){u.push(E)===1&&!p&&o()}}).call(this,typeof dn!="undefined"?dn:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],2:[function(n,r,i){var s=n(1);function a(){}var o={},c=["REJECTED"],l=["FULFILLED"],f=["PENDING"];r.exports=d;function d(y){if(typeof y!="function")throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,y!==a&&O(this,y)}d.prototype.catch=function(y){return this.then(null,y)},d.prototype.then=function(y,S){if(typeof y!="function"&&this.state===l||typeof S!="function"&&this.state===c)return this;var C=new this.constructor(a);if(this.state!==f){var N=this.state===l?y:S;u(C,N,this.outcome)}else this.queue.push(new p(C,y,S));return C};function p(y,S,C){this.promise=y,typeof S=="function"&&(this.onFulfilled=S,this.callFulfilled=this.otherCallFulfilled),typeof C=="function"&&(this.onRejected=C,this.callRejected=this.otherCallRejected)}p.prototype.callFulfilled=function(y){o.resolve(this.promise,y)},p.prototype.otherCallFulfilled=function(y){u(this.promise,this.onFulfilled,y)},p.prototype.callRejected=function(y){o.reject(this.promise,y)},p.prototype.otherCallRejected=function(y){u(this.promise,this.onRejected,y)};function u(y,S,C){s(function(){var N;try{N=S(C)}catch($){return o.reject(y,$)}N===y?o.reject(y,new TypeError("Cannot resolve promise with itself")):o.resolve(y,N)})}o.resolve=function(y,S){var C=E(b,S);if(C.status==="error")return o.reject(y,C.value);var N=C.value;if(N)O(y,N);else{y.state=l,y.outcome=S;for(var $=-1,j=y.queue.length;++$<j;)y.queue[$].callFulfilled(S)}return y},o.reject=function(y,S){y.state=c,y.outcome=S;for(var C=-1,N=y.queue.length;++C<N;)y.queue[C].callRejected(S);return y};function b(y){var S=y&&y.then;if(y&&(typeof y=="object"||typeof y=="function")&&typeof S=="function")return function(){S.apply(y,arguments)}}function O(y,S){var C=!1;function N(M){C||(C=!0,o.reject(y,M))}function $(M){C||(C=!0,o.resolve(y,M))}function j(){S($,N)}var R=E(j);R.status==="error"&&N(R.value)}function E(y,S){var C={};try{C.value=y(S),C.status="success"}catch(N){C.status="error",C.value=N}return C}d.resolve=v;function v(y){return y instanceof this?y:o.resolve(new this(a),y)}d.reject=k;function k(y){var S=new this(a);return o.reject(S,y)}d.all=A;function A(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,N=!1;if(!C)return this.resolve([]);for(var $=new Array(C),j=0,R=-1,M=new this(a);++R<C;)P(y[R],R);return M;function P(U,F){S.resolve(U).then(z,function(J){N||(N=!0,o.reject(M,J))});function z(J){$[F]=J,++j===C&&!N&&(N=!0,o.resolve(M,$))}}}d.race=I;function I(y){var S=this;if(Object.prototype.toString.call(y)!=="[object Array]")return this.reject(new TypeError("must be an array"));var C=y.length,N=!1;if(!C)return this.resolve([]);for(var $=-1,j=new this(a);++$<C;)R(y[$]);return j;function R(M){S.resolve(M).then(function(P){N||(N=!0,o.resolve(j,P))},function(P){N||(N=!0,o.reject(j,P))})}}},{"1":1}],3:[function(n,r,i){(function(s){typeof s.Promise!="function"&&(s.Promise=n(2))}).call(this,typeof dn!="undefined"?dn:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"2":2}],4:[function(n,r,i){var s=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h};function a(h,m){if(!(h instanceof m))throw new TypeError("Cannot call a class as a function")}function o(){try{if(typeof indexedDB!="undefined")return indexedDB;if(typeof webkitIndexedDB!="undefined")return webkitIndexedDB;if(typeof mozIndexedDB!="undefined")return mozIndexedDB;if(typeof OIndexedDB!="undefined")return OIndexedDB;if(typeof msIndexedDB!="undefined")return msIndexedDB}catch(h){return}}var c=o();function l(){try{if(!c||!c.open)return!1;var h=typeof openDatabase!="undefined"&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),m=typeof fetch=="function"&&fetch.toString().indexOf("[native code")!==-1;return(!h||m)&&typeof indexedDB!="undefined"&&typeof IDBKeyRange!="undefined"}catch(g){return!1}}function f(h,m){h=h||[],m=m||{};try{return new Blob(h,m)}catch(_){if(_.name!=="TypeError")throw _;for(var g=typeof BlobBuilder!="undefined"?BlobBuilder:typeof MSBlobBuilder!="undefined"?MSBlobBuilder:typeof MozBlobBuilder!="undefined"?MozBlobBuilder:WebKitBlobBuilder,w=new g,x=0;x<h.length;x+=1)w.append(h[x]);return w.getBlob(m.type)}}typeof Promise=="undefined"&&n(3);var d=Promise;function p(h,m){m&&h.then(function(g){m(null,g)},function(g){m(g)})}function u(h,m,g){typeof m=="function"&&h.then(m),typeof g=="function"&&h.catch(g)}function b(h){return typeof h!="string"&&(console.warn(h+" used as a key, but it is not a string."),h=String(h)),h}function O(){if(arguments.length&&typeof arguments[arguments.length-1]=="function")return arguments[arguments.length-1]}var E="local-forage-detect-blob-support",v=void 0,k={},A=Object.prototype.toString,I="readonly",y="readwrite";function S(h){for(var m=h.length,g=new ArrayBuffer(m),w=new Uint8Array(g),x=0;x<m;x++)w[x]=h.charCodeAt(x);return g}function C(h){return new d(function(m){var g=h.transaction(E,y),w=f([""]);g.objectStore(E).put(w,"key"),g.onabort=function(x){x.preventDefault(),x.stopPropagation(),m(!1)},g.oncomplete=function(){var x=navigator.userAgent.match(/Chrome\/(\d+)/),_=navigator.userAgent.match(/Edge\//);m(_||!x||parseInt(x[1],10)>=43)}}).catch(function(){return!1})}function N(h){return typeof v=="boolean"?d.resolve(v):C(h).then(function(m){return v=m,v})}function $(h){var m=k[h.name],g={};g.promise=new d(function(w,x){g.resolve=w,g.reject=x}),m.deferredOperations.push(g),m.dbReady?m.dbReady=m.dbReady.then(function(){return g.promise}):m.dbReady=g.promise}function j(h){var m=k[h.name],g=m.deferredOperations.pop();if(g)return g.resolve(),g.promise}function R(h,m){var g=k[h.name],w=g.deferredOperations.pop();if(w)return w.reject(m),w.promise}function M(h,m){return new d(function(g,w){if(k[h.name]=k[h.name]||ks(),h.db)if(m)$(h),h.db.close();else return g(h.db);var x=[h.name];m&&x.push(h.version);var _=c.open.apply(c,x);m&&(_.onupgradeneeded=function(T){var D=_.result;try{D.createObjectStore(h.storeName),T.oldVersion<=1&&D.createObjectStore(E)}catch(B){if(B.name==="ConstraintError")console.warn('The database "'+h.name+'" has been upgraded from version '+T.oldVersion+" to version "+T.newVersion+', but the storage "'+h.storeName+'" already exists.');else throw B}}),_.onerror=function(T){T.preventDefault(),w(_.error)},_.onsuccess=function(){var T=_.result;T.onversionchange=function(D){D.target.close()},g(T),j(h)}})}function P(h){return M(h,!1)}function U(h){return M(h,!0)}function F(h,m){if(!h.db)return!0;var g=!h.db.objectStoreNames.contains(h.storeName),w=h.version<h.db.version,x=h.version>h.db.version;if(w&&(h.version!==m&&console.warn('The database "'+h.name+`" can't be downgraded from version `+h.db.version+" to version "+h.version+"."),h.version=h.db.version),x||g){if(g){var _=h.db.version+1;_>h.version&&(h.version=_)}return!0}return!1}function z(h){return new d(function(m,g){var w=new FileReader;w.onerror=g,w.onloadend=function(x){var _=btoa(x.target.result||"");m({__local_forage_encoded_blob:!0,data:_,type:h.type})},w.readAsBinaryString(h)})}function J(h){var m=S(atob(h.data));return f([m],{type:h.type})}function tt(h){return h&&h.__local_forage_encoded_blob}function dc(h){var m=this,g=m._initReady().then(function(){var w=k[m._dbInfo.name];if(w&&w.dbReady)return w.dbReady});return u(g,h,h),g}function pc(h){$(h);for(var m=k[h.name],g=m.forages,w=0;w<g.length;w++){var x=g[w];x._dbInfo.db&&(x._dbInfo.db.close(),x._dbInfo.db=null)}return h.db=null,P(h).then(function(_){return h.db=_,F(h)?U(h):_}).then(function(_){h.db=m.db=_;for(var T=0;T<g.length;T++)g[T]._dbInfo.db=_}).catch(function(_){throw R(h,_),_})}function Ge(h,m,g,w){w===void 0&&(w=1);try{var x=h.db.transaction(h.storeName,m);g(null,x)}catch(_){if(w>0&&(!h.db||_.name==="InvalidStateError"||_.name==="NotFoundError"))return d.resolve().then(function(){if(!h.db||_.name==="NotFoundError"&&!h.db.objectStoreNames.contains(h.storeName)&&h.version<=h.db.version)return h.db&&(h.version=h.db.version+1),U(h)}).then(function(){return pc(h).then(function(){Ge(h,m,g,w-1)})}).catch(g);g(_)}}function ks(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function gc(h){var m=this,g={db:null};if(h)for(var w in h)g[w]=h[w];var x=k[g.name];x||(x=ks(),k[g.name]=x),x.forages.push(m),m._initReady||(m._initReady=m.ready,m.ready=dc);var _=[];function T(){return d.resolve()}for(var D=0;D<x.forages.length;D++){var B=x.forages[D];B!==m&&_.push(B._initReady().catch(T))}var L=x.forages.slice(0);return d.all(_).then(function(){return g.db=x.db,P(g)}).then(function(V){return g.db=V,F(g,m._defaultConfig.version)?U(g):V}).then(function(V){g.db=x.db=V,m._dbInfo=g;for(var H=0;H<L.length;H++){var q=L[H];q!==m&&(q._dbInfo.db=g.db,q._dbInfo.version=g.version)}})}function mc(h,m){var g=this;h=b(h);var w=new d(function(x,_){g.ready().then(function(){Ge(g._dbInfo,I,function(T,D){if(T)return _(T);try{var B=D.objectStore(g._dbInfo.storeName),L=B.get(h);L.onsuccess=function(){var V=L.result;V===void 0&&(V=null),tt(V)&&(V=J(V)),x(V)},L.onerror=function(){_(L.error)}}catch(V){_(V)}})}).catch(_)});return p(w,m),w}function bc(h,m){var g=this,w=new d(function(x,_){g.ready().then(function(){Ge(g._dbInfo,I,function(T,D){if(T)return _(T);try{var B=D.objectStore(g._dbInfo.storeName),L=B.openCursor(),V=1;L.onsuccess=function(){var H=L.result;if(H){var q=H.value;tt(q)&&(q=J(q));var ee=h(q,H.key,V++);ee!==void 0?x(ee):H.continue()}else x()},L.onerror=function(){_(L.error)}}catch(H){_(H)}})}).catch(_)});return p(w,m),w}function _c(h,m,g){var w=this;h=b(h);var x=new d(function(_,T){var D;w.ready().then(function(){return D=w._dbInfo,A.call(m)==="[object Blob]"?N(D.db).then(function(B){return B?m:z(m)}):m}).then(function(B){Ge(w._dbInfo,y,function(L,V){if(L)return T(L);try{var H=V.objectStore(w._dbInfo.storeName);B===null&&(B=void 0);var q=H.put(B,h);V.oncomplete=function(){B===void 0&&(B=null),_(B)},V.onabort=V.onerror=function(){var ee=q.error?q.error:q.transaction.error;T(ee)}}catch(ee){T(ee)}})}).catch(T)});return p(x,g),x}function yc(h,m){var g=this;h=b(h);var w=new d(function(x,_){g.ready().then(function(){Ge(g._dbInfo,y,function(T,D){if(T)return _(T);try{var B=D.objectStore(g._dbInfo.storeName),L=B.delete(h);D.oncomplete=function(){x()},D.onerror=function(){_(L.error)},D.onabort=function(){var V=L.error?L.error:L.transaction.error;_(V)}}catch(V){_(V)}})}).catch(_)});return p(w,m),w}function wc(h){var m=this,g=new d(function(w,x){m.ready().then(function(){Ge(m._dbInfo,y,function(_,T){if(_)return x(_);try{var D=T.objectStore(m._dbInfo.storeName),B=D.clear();T.oncomplete=function(){w()},T.onabort=T.onerror=function(){var L=B.error?B.error:B.transaction.error;x(L)}}catch(L){x(L)}})}).catch(x)});return p(g,h),g}function vc(h){var m=this,g=new d(function(w,x){m.ready().then(function(){Ge(m._dbInfo,I,function(_,T){if(_)return x(_);try{var D=T.objectStore(m._dbInfo.storeName),B=D.count();B.onsuccess=function(){w(B.result)},B.onerror=function(){x(B.error)}}catch(L){x(L)}})}).catch(x)});return p(g,h),g}function xc(h,m){var g=this,w=new d(function(x,_){if(h<0){x(null);return}g.ready().then(function(){Ge(g._dbInfo,I,function(T,D){if(T)return _(T);try{var B=D.objectStore(g._dbInfo.storeName),L=!1,V=B.openKeyCursor();V.onsuccess=function(){var H=V.result;if(!H){x(null);return}h===0||L?x(H.key):(L=!0,H.advance(h))},V.onerror=function(){_(V.error)}}catch(H){_(H)}})}).catch(_)});return p(w,m),w}function Ic(h){var m=this,g=new d(function(w,x){m.ready().then(function(){Ge(m._dbInfo,I,function(_,T){if(_)return x(_);try{var D=T.objectStore(m._dbInfo.storeName),B=D.openKeyCursor(),L=[];B.onsuccess=function(){var V=B.result;if(!V){w(L);return}L.push(V.key),V.continue()},B.onerror=function(){x(B.error)}}catch(V){x(V)}})}).catch(x)});return p(g,h),g}function Ec(h,m){m=O.apply(this,arguments);var g=this.config();h=typeof h!="function"&&h||{},h.name||(h.name=h.name||g.name,h.storeName=h.storeName||g.storeName);var w=this,x;if(!h.name)x=d.reject("Invalid arguments");else{var _=h.name===g.name&&w._dbInfo.db,T=_?d.resolve(w._dbInfo.db):P(h).then(function(D){var B=k[h.name],L=B.forages;B.db=D;for(var V=0;V<L.length;V++)L[V]._dbInfo.db=D;return D});h.storeName?x=T.then(function(D){if(!!D.objectStoreNames.contains(h.storeName)){var B=D.version+1;$(h);var L=k[h.name],V=L.forages;D.close();for(var H=0;H<V.length;H++){var q=V[H];q._dbInfo.db=null,q._dbInfo.version=B}var ee=new d(function(ne,ae){var oe=c.open(h.name,B);oe.onerror=function(Ae){var un=oe.result;un.close(),ae(Ae)},oe.onupgradeneeded=function(){var Ae=oe.result;Ae.deleteObjectStore(h.storeName)},oe.onsuccess=function(){var Ae=oe.result;Ae.close(),ne(Ae)}});return ee.then(function(ne){L.db=ne;for(var ae=0;ae<V.length;ae++){var oe=V[ae];oe._dbInfo.db=ne,j(oe._dbInfo)}}).catch(function(ne){throw(R(h,ne)||d.resolve()).catch(function(){}),ne})}}):x=T.then(function(D){$(h);var B=k[h.name],L=B.forages;D.close();for(var V=0;V<L.length;V++){var H=L[V];H._dbInfo.db=null}var q=new d(function(ee,ne){var ae=c.deleteDatabase(h.name);ae.onerror=function(){var oe=ae.result;oe&&oe.close(),ne(ae.error)},ae.onblocked=function(){console.warn('dropInstance blocked for database "'+h.name+'" until all open connections are closed')},ae.onsuccess=function(){var oe=ae.result;oe&&oe.close(),ee(oe)}});return q.then(function(ee){B.db=ee;for(var ne=0;ne<L.length;ne++){var ae=L[ne];j(ae._dbInfo)}}).catch(function(ee){throw(R(h,ee)||d.resolve()).catch(function(){}),ee})})}return p(x,m),x}var Oc={_driver:"asyncStorage",_initStorage:gc,_support:l(),iterate:bc,getItem:mc,setItem:_c,removeItem:yc,clear:wc,length:vc,key:xc,keys:Ic,dropInstance:Ec};function Ac(){return typeof openDatabase=="function"}var nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Cc="~~local_forage_type~",Ss=/^~~local_forage_type~([^~]+)~/,zn="__lfsc__:",Pr=zn.length,Hr="arbf",Fr="blob",Ns="si08",$s="ui08",Ds="uic8",js="si16",Bs="si32",Ls="ur16",Vs="ui32",Us="fl32",Ms="fl64",Ps=Pr+Hr.length,Hs=Object.prototype.toString;function Fs(h){var m=h.length*.75,g=h.length,w,x=0,_,T,D,B;h[h.length-1]==="="&&(m--,h[h.length-2]==="="&&m--);var L=new ArrayBuffer(m),V=new Uint8Array(L);for(w=0;w<g;w+=4)_=nt.indexOf(h[w]),T=nt.indexOf(h[w+1]),D=nt.indexOf(h[w+2]),B=nt.indexOf(h[w+3]),V[x++]=_<<2|T>>4,V[x++]=(T&15)<<4|D>>2,V[x++]=(D&3)<<6|B&63;return L}function zr(h){var m=new Uint8Array(h),g="",w;for(w=0;w<m.length;w+=3)g+=nt[m[w]>>2],g+=nt[(m[w]&3)<<4|m[w+1]>>4],g+=nt[(m[w+1]&15)<<2|m[w+2]>>6],g+=nt[m[w+2]&63];return m.length%3==2?g=g.substring(0,g.length-1)+"=":m.length%3==1&&(g=g.substring(0,g.length-2)+"=="),g}function Rc(h,m){var g="";if(h&&(g=Hs.call(h)),h&&(g==="[object ArrayBuffer]"||h.buffer&&Hs.call(h.buffer)==="[object ArrayBuffer]")){var w,x=zn;h instanceof ArrayBuffer?(w=h,x+=Hr):(w=h.buffer,g==="[object Int8Array]"?x+=Ns:g==="[object Uint8Array]"?x+=$s:g==="[object Uint8ClampedArray]"?x+=Ds:g==="[object Int16Array]"?x+=js:g==="[object Uint16Array]"?x+=Ls:g==="[object Int32Array]"?x+=Bs:g==="[object Uint32Array]"?x+=Vs:g==="[object Float32Array]"?x+=Us:g==="[object Float64Array]"?x+=Ms:m(new Error("Failed to get type for BinaryArray"))),m(x+zr(w))}else if(g==="[object Blob]"){var _=new FileReader;_.onload=function(){var T=Cc+h.type+"~"+zr(this.result);m(zn+Fr+T)},_.readAsArrayBuffer(h)}else try{m(JSON.stringify(h))}catch(T){console.error("Couldn't convert value into a JSON string: ",h),m(null,T)}}function Tc(h){if(h.substring(0,Pr)!==zn)return JSON.parse(h);var m=h.substring(Ps),g=h.substring(Pr,Ps),w;if(g===Fr&&Ss.test(m)){var x=m.match(Ss);w=x[1],m=m.substring(x[0].length)}var _=Fs(m);switch(g){case Hr:return _;case Fr:return f([_],{type:w});case Ns:return new Int8Array(_);case $s:return new Uint8Array(_);case Ds:return new Uint8ClampedArray(_);case js:return new Int16Array(_);case Ls:return new Uint16Array(_);case Bs:return new Int32Array(_);case Vs:return new Uint32Array(_);case Us:return new Float32Array(_);case Ms:return new Float64Array(_);default:throw new Error("Unkown type: "+g)}}var Zr={serialize:Rc,deserialize:Tc,stringToBuffer:Fs,bufferToString:zr};function zs(h,m,g,w){h.executeSql("CREATE TABLE IF NOT EXISTS "+m.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],g,w)}function kc(h){var m=this,g={db:null};if(h)for(var w in h)g[w]=typeof h[w]!="string"?h[w].toString():h[w];var x=new d(function(_,T){try{g.db=openDatabase(g.name,String(g.version),g.description,g.size)}catch(D){return T(D)}g.db.transaction(function(D){zs(D,g,function(){m._dbInfo=g,_()},function(B,L){T(L)})},T)});return g.serializer=Zr,x}function rt(h,m,g,w,x,_){h.executeSql(g,w,x,function(T,D){D.code===D.SYNTAX_ERR?T.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[m.storeName],function(B,L){L.rows.length?_(B,D):zs(B,m,function(){B.executeSql(g,w,x,_)},_)},_):_(T,D)},_)}function Sc(h,m){var g=this;h=b(h);var w=new d(function(x,_){g.ready().then(function(){var T=g._dbInfo;T.db.transaction(function(D){rt(D,T,"SELECT * FROM "+T.storeName+" WHERE key = ? LIMIT 1",[h],function(B,L){var V=L.rows.length?L.rows.item(0).value:null;V&&(V=T.serializer.deserialize(V)),x(V)},function(B,L){_(L)})})}).catch(_)});return p(w,m),w}function Nc(h,m){var g=this,w=new d(function(x,_){g.ready().then(function(){var T=g._dbInfo;T.db.transaction(function(D){rt(D,T,"SELECT * FROM "+T.storeName,[],function(B,L){for(var V=L.rows,H=V.length,q=0;q<H;q++){var ee=V.item(q),ne=ee.value;if(ne&&(ne=T.serializer.deserialize(ne)),ne=h(ne,ee.key,q+1),ne!==void 0){x(ne);return}}x()},function(B,L){_(L)})})}).catch(_)});return p(w,m),w}function Zs(h,m,g,w){var x=this;h=b(h);var _=new d(function(T,D){x.ready().then(function(){m===void 0&&(m=null);var B=m,L=x._dbInfo;L.serializer.serialize(m,function(V,H){H?D(H):L.db.transaction(function(q){rt(q,L,"INSERT OR REPLACE INTO "+L.storeName+" (key, value) VALUES (?, ?)",[h,V],function(){T(B)},function(ee,ne){D(ne)})},function(q){if(q.code===q.QUOTA_ERR){if(w>0){T(Zs.apply(x,[h,B,g,w-1]));return}D(q)}})})}).catch(D)});return p(_,g),_}function $c(h,m,g){return Zs.apply(this,[h,m,g,1])}function Dc(h,m){var g=this;h=b(h);var w=new d(function(x,_){g.ready().then(function(){var T=g._dbInfo;T.db.transaction(function(D){rt(D,T,"DELETE FROM "+T.storeName+" WHERE key = ?",[h],function(){x()},function(B,L){_(L)})})}).catch(_)});return p(w,m),w}function jc(h){var m=this,g=new d(function(w,x){m.ready().then(function(){var _=m._dbInfo;_.db.transaction(function(T){rt(T,_,"DELETE FROM "+_.storeName,[],function(){w()},function(D,B){x(B)})})}).catch(x)});return p(g,h),g}function Bc(h){var m=this,g=new d(function(w,x){m.ready().then(function(){var _=m._dbInfo;_.db.transaction(function(T){rt(T,_,"SELECT COUNT(key) as c FROM "+_.storeName,[],function(D,B){var L=B.rows.item(0).c;w(L)},function(D,B){x(B)})})}).catch(x)});return p(g,h),g}function Lc(h,m){var g=this,w=new d(function(x,_){g.ready().then(function(){var T=g._dbInfo;T.db.transaction(function(D){rt(D,T,"SELECT key FROM "+T.storeName+" WHERE id = ? LIMIT 1",[h+1],function(B,L){var V=L.rows.length?L.rows.item(0).key:null;x(V)},function(B,L){_(L)})})}).catch(_)});return p(w,m),w}function Vc(h){var m=this,g=new d(function(w,x){m.ready().then(function(){var _=m._dbInfo;_.db.transaction(function(T){rt(T,_,"SELECT key FROM "+_.storeName,[],function(D,B){for(var L=[],V=0;V<B.rows.length;V++)L.push(B.rows.item(V).key);w(L)},function(D,B){x(B)})})}).catch(x)});return p(g,h),g}function Uc(h){return new d(function(m,g){h.transaction(function(w){w.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(x,_){for(var T=[],D=0;D<_.rows.length;D++)T.push(_.rows.item(D).name);m({db:h,storeNames:T})},function(x,_){g(_)})},function(w){g(w)})})}function Mc(h,m){m=O.apply(this,arguments);var g=this.config();h=typeof h!="function"&&h||{},h.name||(h.name=h.name||g.name,h.storeName=h.storeName||g.storeName);var w=this,x;return h.name?x=new d(function(_){var T;h.name===g.name?T=w._dbInfo.db:T=openDatabase(h.name,"","",0),h.storeName?_({db:T,storeNames:[h.storeName]}):_(Uc(T))}).then(function(_){return new d(function(T,D){_.db.transaction(function(B){function L(ee){return new d(function(ne,ae){B.executeSql("DROP TABLE IF EXISTS "+ee,[],function(){ne()},function(oe,Ae){ae(Ae)})})}for(var V=[],H=0,q=_.storeNames.length;H<q;H++)V.push(L(_.storeNames[H]));d.all(V).then(function(){T()}).catch(function(ee){D(ee)})},function(B){D(B)})})}):x=d.reject("Invalid arguments"),p(x,m),x}var Pc={_driver:"webSQLStorage",_initStorage:kc,_support:Ac(),iterate:Nc,getItem:Sc,setItem:$c,removeItem:Dc,clear:jc,length:Bc,key:Lc,keys:Vc,dropInstance:Mc};function Hc(){try{return typeof localStorage!="undefined"&&"setItem"in localStorage&&!!localStorage.setItem}catch(h){return!1}}function qs(h,m){var g=h.name+"/";return h.storeName!==m.storeName&&(g+=h.storeName+"/"),g}function Fc(){var h="_localforage_support_test";try{return localStorage.setItem(h,!0),localStorage.removeItem(h),!1}catch(m){return!0}}function zc(){return!Fc()||localStorage.length>0}function Zc(h){var m=this,g={};if(h)for(var w in h)g[w]=h[w];return g.keyPrefix=qs(h,m._defaultConfig),zc()?(m._dbInfo=g,g.serializer=Zr,d.resolve()):d.reject()}function qc(h){var m=this,g=m.ready().then(function(){for(var w=m._dbInfo.keyPrefix,x=localStorage.length-1;x>=0;x--){var _=localStorage.key(x);_.indexOf(w)===0&&localStorage.removeItem(_)}});return p(g,h),g}function Gc(h,m){var g=this;h=b(h);var w=g.ready().then(function(){var x=g._dbInfo,_=localStorage.getItem(x.keyPrefix+h);return _&&(_=x.serializer.deserialize(_)),_});return p(w,m),w}function Kc(h,m){var g=this,w=g.ready().then(function(){for(var x=g._dbInfo,_=x.keyPrefix,T=_.length,D=localStorage.length,B=1,L=0;L<D;L++){var V=localStorage.key(L);if(V.indexOf(_)===0){var H=localStorage.getItem(V);if(H&&(H=x.serializer.deserialize(H)),H=h(H,V.substring(T),B++),H!==void 0)return H}}});return p(w,m),w}function Yc(h,m){var g=this,w=g.ready().then(function(){var x=g._dbInfo,_;try{_=localStorage.key(h)}catch(T){_=null}return _&&(_=_.substring(x.keyPrefix.length)),_});return p(w,m),w}function Wc(h){var m=this,g=m.ready().then(function(){for(var w=m._dbInfo,x=localStorage.length,_=[],T=0;T<x;T++){var D=localStorage.key(T);D.indexOf(w.keyPrefix)===0&&_.push(D.substring(w.keyPrefix.length))}return _});return p(g,h),g}function Jc(h){var m=this,g=m.keys().then(function(w){return w.length});return p(g,h),g}function Xc(h,m){var g=this;h=b(h);var w=g.ready().then(function(){var x=g._dbInfo;localStorage.removeItem(x.keyPrefix+h)});return p(w,m),w}function Qc(h,m,g){var w=this;h=b(h);var x=w.ready().then(function(){m===void 0&&(m=null);var _=m;return new d(function(T,D){var B=w._dbInfo;B.serializer.serialize(m,function(L,V){if(V)D(V);else try{localStorage.setItem(B.keyPrefix+h,L),T(_)}catch(H){(H.name==="QuotaExceededError"||H.name==="NS_ERROR_DOM_QUOTA_REACHED")&&D(H),D(H)}})})});return p(x,g),x}function ef(h,m){if(m=O.apply(this,arguments),h=typeof h!="function"&&h||{},!h.name){var g=this.config();h.name=h.name||g.name,h.storeName=h.storeName||g.storeName}var w=this,x;return h.name?x=new d(function(_){h.storeName?_(qs(h,w._defaultConfig)):_(h.name+"/")}).then(function(_){for(var T=localStorage.length-1;T>=0;T--){var D=localStorage.key(T);D.indexOf(_)===0&&localStorage.removeItem(D)}}):x=d.reject("Invalid arguments"),p(x,m),x}var tf={_driver:"localStorageWrapper",_initStorage:Zc,_support:Hc(),iterate:Kc,getItem:Gc,setItem:Qc,removeItem:Xc,clear:qc,length:Jc,key:Yc,keys:Wc,dropInstance:ef},nf=function(m,g){return m===g||typeof m=="number"&&typeof g=="number"&&isNaN(m)&&isNaN(g)},rf=function(m,g){for(var w=m.length,x=0;x<w;){if(nf(m[x],g))return!0;x++}return!1},Gs=Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"},fn={},Ks={},$t={INDEXEDDB:Oc,WEBSQL:Pc,LOCALSTORAGE:tf},sf=[$t.INDEXEDDB._driver,$t.WEBSQL._driver,$t.LOCALSTORAGE._driver],Zn=["dropInstance"],qr=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Zn),of={description:"",driver:sf.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function af(h,m){h[m]=function(){var g=arguments;return h.ready().then(function(){return h[m].apply(h,g)})}}function Gr(){for(var h=1;h<arguments.length;h++){var m=arguments[h];if(m)for(var g in m)m.hasOwnProperty(g)&&(Gs(m[g])?arguments[0][g]=m[g].slice():arguments[0][g]=m[g])}return arguments[0]}var lf=function(){function h(m){a(this,h);for(var g in $t)if($t.hasOwnProperty(g)){var w=$t[g],x=w._driver;this[g]=x,fn[x]||this.defineDriver(w)}this._defaultConfig=Gr({},of),this._config=Gr({},this._defaultConfig,m),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return h.prototype.config=function(g){if((typeof g=="undefined"?"undefined":s(g))==="object"){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var w in g){if(w==="storeName"&&(g[w]=g[w].replace(/\W/g,"_")),w==="version"&&typeof g[w]!="number")return new Error("Database version must be a number.");this._config[w]=g[w]}return"driver"in g&&g.driver?this.setDriver(this._config.driver):!0}else return typeof g=="string"?this._config[g]:this._config},h.prototype.defineDriver=function(g,w,x){var _=new d(function(T,D){try{var B=g._driver,L=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!g._driver){D(L);return}for(var V=qr.concat("_initStorage"),H=0,q=V.length;H<q;H++){var ee=V[H],ne=!rf(Zn,ee);if((ne||g[ee])&&typeof g[ee]!="function"){D(L);return}}var ae=function(){for(var un=function(uf){return function(){var hf=new Error("Method "+uf+" is not implemented by the current driver"),Ys=d.reject(hf);return p(Ys,arguments[arguments.length-1]),Ys}},Kr=0,ff=Zn.length;Kr<ff;Kr++){var Yr=Zn[Kr];g[Yr]||(g[Yr]=un(Yr))}};ae();var oe=function(un){fn[B]&&console.info("Redefining LocalForage driver: "+B),fn[B]=g,Ks[B]=un,T()};"_support"in g?g._support&&typeof g._support=="function"?g._support().then(oe,D):oe(!!g._support):oe(!0)}catch(Ae){D(Ae)}});return u(_,w,x),_},h.prototype.driver=function(){return this._driver||null},h.prototype.getDriver=function(g,w,x){var _=fn[g]?d.resolve(fn[g]):d.reject(new Error("Driver not found."));return u(_,w,x),_},h.prototype.getSerializer=function(g){var w=d.resolve(Zr);return u(w,g),w},h.prototype.ready=function(g){var w=this,x=w._driverSet.then(function(){return w._ready===null&&(w._ready=w._initDriver()),w._ready});return u(x,g,g),x},h.prototype.setDriver=function(g,w,x){var _=this;Gs(g)||(g=[g]);var T=this._getSupportedDrivers(g);function D(){_._config.driver=_.driver()}function B(H){return _._extend(H),D(),_._ready=_._initStorage(_._config),_._ready}function L(H){return function(){var q=0;function ee(){for(;q<H.length;){var ne=H[q];return q++,_._dbInfo=null,_._ready=null,_.getDriver(ne).then(B).catch(ee)}D();var ae=new Error("No available storage method found.");return _._driverSet=d.reject(ae),_._driverSet}return ee()}}var V=this._driverSet!==null?this._driverSet.catch(function(){return d.resolve()}):d.resolve();return this._driverSet=V.then(function(){var H=T[0];return _._dbInfo=null,_._ready=null,_.getDriver(H).then(function(q){_._driver=q._driver,D(),_._wrapLibraryMethodsWithReady(),_._initDriver=L(T)})}).catch(function(){D();var H=new Error("No available storage method found.");return _._driverSet=d.reject(H),_._driverSet}),u(this._driverSet,w,x),this._driverSet},h.prototype.supports=function(g){return!!Ks[g]},h.prototype._extend=function(g){Gr(this,g)},h.prototype._getSupportedDrivers=function(g){for(var w=[],x=0,_=g.length;x<_;x++){var T=g[x];this.supports(T)&&w.push(T)}return w},h.prototype._wrapLibraryMethodsWithReady=function(){for(var g=0,w=qr.length;g<w;g++)af(this,qr[g])},h.prototype.createInstance=function(g){return new h(g)},h}(),cf=new lf;r.exports=cf},{"3":3}]},{},[4])(4)})})(zg);var Mr,Zg=new Uint8Array(16);function qg(){if(!Mr&&(Mr=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!Mr))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mr(Zg)}var Gg=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Kg(t){return typeof t=="string"&&Gg.test(t)}var _e=[];for(var Ts=0;Ts<256;++Ts)_e.push((Ts+256).toString(16).substr(1));function Yg(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(_e[t[e+0]]+_e[t[e+1]]+_e[t[e+2]]+_e[t[e+3]]+"-"+_e[t[e+4]]+_e[t[e+5]]+"-"+_e[t[e+6]]+_e[t[e+7]]+"-"+_e[t[e+8]]+_e[t[e+9]]+"-"+_e[t[e+10]]+_e[t[e+11]]+_e[t[e+12]]+_e[t[e+13]]+_e[t[e+14]]+_e[t[e+15]]).toLowerCase();if(!Kg(n))throw TypeError("Stringified UUID is invalid");return n}function jm(t,e,n){t=t||{};var r=t.random||(t.rng||qg)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i];return e}return Yg(r)}export{wm as $,bm as A,gf as B,Lf as C,em as D,nm as E,rm as F,tm as G,xf as H,it as I,pm as J,lm as K,Sm as L,zg as M,jm as N,Xg as O,so as P,$m as Q,Dm as R,Tm as S,Q as T,Qg as U,mm as V,cm as W,Xs as X,Dt as Y,gm as Z,sm as _,Of as a,to as a0,km as a1,Nm as a2,Rs as a3,fm as b,um as c,If as d,Ef as e,im as f,Rf as g,dm as h,Rm as i,Am as j,om as k,am as l,Cm as m,hm as n,$f as o,Em as p,Om as q,vm as r,mf as s,Jr as t,Im as u,Df as v,xm as w,Nf as x,ym as y,_m as z};
