import{L as e,a1 as t,a2 as n,C as a,O as s,a3 as r}from"./vendor-30d0dc21.js";import{p as o,a as c}from"./p2p-ac9564ed.js";import{_ as i,r as d}from"./singletons-e82519e2.js";const u=a(null);function m(e){return{id:e,name:"Unknown",team:1}}const l=new e.EventEmitter,w=t(u,(e=>e?e.get():{byId:{}})),f=t(w,(e=>e.byId[c()]));function g(){const e=s(u);return e?Promise.resolve(e):new Promise((e=>l.once("state",e)))}o.on("room",(e=>{const t=new n("users",e,{byId:{}});t.on("update",(()=>u.set(t))),l.emit("state",t),u.set(t);const a=e.getPeer().getId();t.change((e=>{e.byId[a]||(e.byId[a]=m(a))}))}));const y=i((()=>import("./easy-d1c5d374.js")),[]),I=i((()=>import("./medium-73eb433f.js")),[]),h=i((()=>import("./hard-ac810e77.js")),[]);async function _(e,t){return e.fromArray(await async function(e){switch(e){case b.Easy:return y.then((({default:e})=>e));case b.Medium:return I.then((({default:e})=>e));case b.Hard:return h.then((({default:e})=>e));default:return Promise.all([y,I,h]).then((([{default:e},{default:t},{default:n}])=>e.concat(t,n)))}}(t)).unwrapOr("unknown")}const p=a(null);var b,E;function P(){return{seed:Date.now(),started:!1,words:b.Medium,turn:"",word:"",timer:0,team1:0,team2:0}}(E=b||(b={})).Easy="easy",E.Medium="medium",E.Hard="hard",E.All="all";const v=new e.EventEmitter,O=t(p,(e=>(null==e?void 0:e.get())||P()));function j(){const e=s(p);return e?Promise.resolve(e):new Promise((e=>v.once("state",e)))}async function x(){const[e,t]=await Promise.all([j(),g()]),n=e.get(),a=t.get(),s=new r(n.seed),o=await _(s,n.words);e.change((e=>{e.started=!0,e.turn=s.fromArray(Object.keys(a.byId)).unwrapOr(c()),e.word=o,e.seed=s.nextInt()}))}async function A(){const[e,t]=await Promise.all([j(),g()]),n=e.get(),a=t.get(),s=new r(n.seed),o=await _(s,n.words),c=Object.keys(a.byId).sort(),i=c.indexOf(n.turn),d=i===c.length-1?c[0]:c[i+1];e.change((e=>{e.word=o,e.seed=s.nextInt(),e.turn=d}))}async function k(){const e=await j(),t=e.get(),n=new r(t.seed),a=await _(n,t.words);e.change((e=>{e.word=a,e.seed=n.nextInt()})),M()}async function D(){const e=await j(),t=e.get(),n=new r(t.seed),a=await _(n,t.words);e.change((e=>{e.word=a,e.seed=n.nextInt()}))}let L;async function M(){if(null!=L)return;const e=await j();e.change((e=>{e.timer=5})),L=setInterval((()=>{e.change((e=>{e.timer>0?e.timer--:async function(){if(null==L)return;const[e,t]=await Promise.all([j(),g()]),n=e.get(),a=t.get().byId[n.turn];e.change((e=>{1===a.team?e.team2++:e.team1++,e.timer=0})),clearInterval(L),L=null}()}))}),1e3)}o.on("room",(e=>{const t=new n("game",e,P());t.on("update",(()=>p.set(t))),v.emit("state",t),p.set(t)}));const R=async function(e,t){return d.goto(e,t,[])};export{b as W,O as a,f as b,g as c,R as d,m as e,M as f,j as g,D as h,k as i,A as n,x as s,w as u};
